var Validator={rules:{pair:/^[a-z]+_[a-z]+$/i,para:/^[a-z]+_[a-z]+$/i,period:/^[\w]+$/,type:/^[\w]+$/,lang:/^[a-z]+$/i,ref:/^[\d]+$/},isValid:function(name,value){if(void 0===this.rules[name])throw new Error('Validator: param "'+name+'" does not have validate rule');var isValid=this.rules[name].test(value);return isValid||"function"!=typeof console.error||console.error('Validator: Invalid param "'+name+'", value "'+value+'", rule "'+this.rules[name]+'"'),isValid},getOrDefault:function(name,data,defaultValue){var value="object"==typeof data?data[name]:data;return value&&this.isValid(name,value)?value:defaultValue},getFromUrl:function(name,defaultValue){var value,results=new RegExp("[\\?&]"+name+"=([^&#]*)").exec(window.location.href);return results&&(value=results[1]),this.getOrDefault(name,value,defaultValue)}};!function($){"use strict";$.fn.counterUp=function(options){var settings=$.extend({time:400,delay:10},options);return this.each(function(){var $this=$(this),$settings=settings,counterUpper=function(){var nums=[],divisions=$settings.time/$settings.delay,num=$this.text(),isComma=/[0-9]+,[0-9]+/.test(num);num=num.replace(/,/g,"");for(var isFloat=(/^[0-9]+$/.test(num),/^[0-9]+\.[0-9]+$/.test(num)),decimalPlaces=isFloat?(num.split(".")[1]||[]).length:0,i=divisions;i>=1;i--){var newNum=parseInt(num/divisions*i);if(isFloat&&(newNum=parseFloat(num/divisions*i).toFixed(decimalPlaces)),isComma)for(;/(\d+)(\d{3})/.test(newNum.toString());)newNum=newNum.toString().replace(/(\d+)(\d{3})/,"$1,$2");nums.unshift(newNum)}$this.data("counterup-nums",nums),$this.text("0");var f=function(){$this.text($this.data("counterup-nums").shift()),$this.data("counterup-nums").length?setTimeout($this.data("counterup-func"),$settings.delay):($this.data("counterup-nums"),$this.data("counterup-nums",null),$this.data("counterup-func",null))};$this.data("counterup-func",f),setTimeout($this.data("counterup-func"),$settings.delay)};$this.waypoint(counterUpper,{offset:"100%",triggerOnce:!0})})}}(jQuery),function(window,document){"use strict";function extend(out){out=out||{};for(var i=1;i<arguments.length;i++){var obj=arguments[i];if(obj)for(var key in obj)obj.hasOwnProperty(key)&&("object"==typeof obj[key]?deepExtend(out[key],obj[key]):out[key]=obj[key])}return out}function Plugin(element,options){function styleCanvas(){canvas.width=element.offsetWidth,canvas.height=element.offsetHeight,ctx.fillStyle=options.dotColor,ctx.strokeStyle=options.lineColor,ctx.lineWidth=options.lineWidth}function draw(){if(canvasSupport){winW=window.innerWidth,winH=window.innerHeight,ctx.clearRect(0,0,canvas.width,canvas.height);for(var i=0;i<particles.length;i++)particles[i].updatePosition();for(var i=0;i<particles.length;i++)particles[i].draw();paused||(raf=requestAnimationFrame(draw))}}function resizeHandler(){styleCanvas();for(var elWidth=element.offsetWidth,elHeight=element.offsetHeight,i=particles.length-1;i>=0;i--)(particles[i].position.x>elWidth||particles[i].position.y>elHeight)&&particles.splice(i,1);var numParticles=Math.round(canvas.width*canvas.height/options.density);if(numParticles>particles.length)for(;numParticles>particles.length;){var p=new Particle;particles.push(p)}else numParticles<particles.length&&particles.splice(numParticles);for(i=particles.length-1;i>=0;i--)particles[i].setStackPos(i)}function pause(){paused=!0}function start(){paused=!1,draw()}function Particle(){switch(this.stackPos,this.active=!0,this.layer=Math.ceil(3*Math.random()),this.parallaxOffsetX=0,this.parallaxOffsetY=0,this.position={x:Math.ceil(Math.random()*canvas.width),y:Math.ceil(Math.random()*canvas.height)},this.speed={},options.directionX){case"left":this.speed.x=+(-options.maxSpeedX+Math.random()*options.maxSpeedX-options.minSpeedX).toFixed(2);break;case"right":this.speed.x=+(Math.random()*options.maxSpeedX+options.minSpeedX).toFixed(2);break;default:this.speed.x=+(-options.maxSpeedX/2+Math.random()*options.maxSpeedX).toFixed(2),this.speed.x+=this.speed.x>0?options.minSpeedX:-options.minSpeedX}switch(options.directionY){case"up":this.speed.y=+(-options.maxSpeedY+Math.random()*options.maxSpeedY-options.minSpeedY).toFixed(2);break;case"down":this.speed.y=+(Math.random()*options.maxSpeedY+options.minSpeedY).toFixed(2);break;default:this.speed.y=+(-options.maxSpeedY/2+Math.random()*options.maxSpeedY).toFixed(2),this.speed.x+=this.speed.y>0?options.minSpeedY:-options.minSpeedY}}function option(key,val){if(!val)return options[key];options[key]=val}function destroy(){console.log("destroy"),canvas.parentNode.removeChild(canvas),hook("onDestroy"),$&&$(element).removeData("plugin_"+pluginName)}function hook(hookName){void 0!==options[hookName]&&options[hookName].call(element)}var canvas,ctx,raf,winW,winH,pointerX,pointerY,canvasSupport=!!document.createElement("canvas").getContext,particles=[],mouseX=0,mouseY=0,desktop=!navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry|BB10|mobi|tablet|opera mini|nexus 7)/i),orientationSupport=!!window.DeviceOrientationEvent,tiltX=0,tiltY=0,paused=!1;options=extend({},window[pluginName].defaults,options);var proximityS2=options.proximity*options.proximity;return Particle.prototype.draw=function(){ctx.beginPath(),ctx.arc(this.position.x+this.parallaxOffsetX,this.position.y+this.parallaxOffsetY,options.particleRadius/2,0,2*Math.PI,!0),ctx.closePath(),ctx.fill(),ctx.beginPath();for(var i=particles.length-1;i>this.stackPos;i--){var p2=particles[i],a=this.position.x-p2.position.x,b=this.position.y-p2.position.y;a*a+b*b<proximityS2&&(ctx.moveTo(this.position.x+this.parallaxOffsetX,this.position.y+this.parallaxOffsetY),options.curvedLines?ctx.quadraticCurveTo(Math.max(p2.position.x,p2.position.x),Math.min(p2.position.y,p2.position.y),p2.position.x+p2.parallaxOffsetX,p2.position.y+p2.parallaxOffsetY):ctx.lineTo(p2.position.x+p2.parallaxOffsetX,p2.position.y+p2.parallaxOffsetY))}ctx.stroke(),ctx.closePath()},Particle.prototype.updatePosition=function(){if(options.parallax){if(orientationSupport&&!desktop){pointerX=(tiltX+30)*(winW/60);pointerY=(tiltY+30)*(winH/60)}else pointerX=mouseX,pointerY=mouseY;this.parallaxTargX=(pointerX-winW/2)/(options.parallaxMultiplier*this.layer),this.parallaxOffsetX+=(this.parallaxTargX-this.parallaxOffsetX)/10,this.parallaxTargY=(pointerY-winH/2)/(options.parallaxMultiplier*this.layer),this.parallaxOffsetY+=(this.parallaxTargY-this.parallaxOffsetY)/10}var elWidth=element.offsetWidth,elHeight=element.offsetHeight;switch(options.directionX){case"left":this.position.x+this.speed.x+this.parallaxOffsetX<0&&(this.position.x=elWidth-this.parallaxOffsetX);break;case"right":this.position.x+this.speed.x+this.parallaxOffsetX>elWidth&&(this.position.x=0-this.parallaxOffsetX);break;default:(this.position.x+this.speed.x+this.parallaxOffsetX>elWidth||this.position.x+this.speed.x+this.parallaxOffsetX<0)&&(this.speed.x=-this.speed.x)}switch(options.directionY){case"up":this.position.y+this.speed.y+this.parallaxOffsetY<0&&(this.position.y=elHeight-this.parallaxOffsetY);break;case"down":this.position.y+this.speed.y+this.parallaxOffsetY>elHeight&&(this.position.y=0-this.parallaxOffsetY);break;default:(this.position.y+this.speed.y+this.parallaxOffsetY>elHeight||this.position.y+this.speed.y+this.parallaxOffsetY<0)&&(this.speed.y=-this.speed.y)}this.position.x+=this.speed.x,this.position.y+=this.speed.y},Particle.prototype.setStackPos=function(i){this.stackPos=i},function(){if(canvasSupport){canvas=document.createElement("canvas"),canvas.className="pg-canvas",canvas.style.display="block",element.insertBefore(canvas,element.firstChild),ctx=canvas.getContext("2d"),styleCanvas();for(var numParticles=Math.round(canvas.width*canvas.height/options.density),i=0;i<numParticles;i++){var p=new Particle;p.setStackPos(i),particles.push(p)}window.addEventListener("resize",function(){resizeHandler()},!1),document.addEventListener("mousemove",function(e){mouseX=e.pageX,mouseY=e.pageY},!1),orientationSupport&&!desktop&&window.addEventListener("deviceorientation",function(){tiltY=Math.min(Math.max(-event.beta,-30),30),tiltX=Math.min(Math.max(-event.gamma,-30),30)},!0),draw(),hook("onInit")}}(),{option:option,destroy:destroy,start:start,pause:pause}}var pluginName="particleground",$=window.jQuery;window[pluginName]=function(elem,options){return new Plugin(elem,options)},window[pluginName].defaults={minSpeedX:.1,maxSpeedX:.7,minSpeedY:.1,maxSpeedY:.7,directionX:"center",directionY:"center",density:1e4,dotColor:"#666666",lineColor:"#666666",particleRadius:7,lineWidth:1,curvedLines:!1,proximity:100,parallax:!0,parallaxMultiplier:5,onInit:function(){},onDestroy:function(){}},$&&($.fn[pluginName]=function(options){if("string"==typeof arguments[0]){var returnVal,methodName=arguments[0],args=Array.prototype.slice.call(arguments,1);return this.each(function(){$.data(this,"plugin_"+pluginName)&&"function"==typeof $.data(this,"plugin_"+pluginName)[methodName]&&(returnVal=$.data(this,"plugin_"+pluginName)[methodName].apply(this,args))}),void 0!==returnVal?returnVal:this}if("object"==typeof options||!options)return this.each(function(){$.data(this,"plugin_"+pluginName)||$.data(this,"plugin_"+pluginName,new Plugin(this,options))})})}(window,document),function(){for(var lastTime=0,vendors=["ms","moz","webkit","o"],x=0;x<vendors.length&&!window.requestAnimationFrame;++x)window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(callback,element){var currTime=(new Date).getTime(),timeToCall=Math.max(0,16-(currTime-lastTime)),id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);return lastTime=currTime+timeToCall,id}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(id){clearTimeout(id)})}();var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};!function(a,b,c,d){function e(b,c){this.settings=null,this.options=a.extend({},e.Defaults,c),this.$element=a(b),this._handlers={},this._plugins={},this._supress={},this._current=null,this._speed=null,this._coordinates=[],this._breakpoint=null,this._width=null,this._items=[],this._clones=[],this._mergers=[],this._widths=[],this._invalidated={},this._pipe=[],this._drag={time:null,target:null,pointer:null,stage:{start:null,current:null},direction:null},this._states={current:{},tags:{initializing:["busy"],animating:["busy"],dragging:["interacting"]}},a.each(["onResize","onThrottledResize"],a.proxy(function(b,c){this._handlers[c]=a.proxy(this[c],this)},this)),a.each(e.Plugins,a.proxy(function(a,b){this._plugins[a.charAt(0).toLowerCase()+a.slice(1)]=new b(this)},this)),a.each(e.Workers,a.proxy(function(b,c){this._pipe.push({filter:c.filter,run:a.proxy(c.run,this)})},this)),this.setup(),this.initialize()}e.Defaults={items:3,loop:!1,center:!1,rewind:!1,mouseDrag:!0,touchDrag:!0,pullDrag:!0,freeDrag:!1,margin:0,stagePadding:0,merge:!1,mergeFit:!0,autoWidth:!1,startPosition:0,rtl:!1,smartSpeed:250,fluidSpeed:!1,dragEndSpeed:!1,responsive:{},responsiveRefreshRate:200,responsiveBaseElement:b,fallbackEasing:"swing",info:!1,nestedItemSelector:!1,itemElement:"div",stageElement:"div",refreshClass:"owl-refresh",loadedClass:"owl-loaded",loadingClass:"owl-loading",rtlClass:"owl-rtl",responsiveClass:"owl-responsive",dragClass:"owl-drag",itemClass:"owl-item",stageClass:"owl-stage",stageOuterClass:"owl-stage-outer",grabClass:"owl-grab"},e.Width={Default:"default",Inner:"inner",Outer:"outer"},e.Type={Event:"event",State:"state"},e.Plugins={},e.Workers=[{filter:["width","settings"],run:function(){this._width=this.$element.width()}},{filter:["width","items","settings"],run:function(a){a.current=this._items&&this._items[this.relative(this._current)]}},{filter:["items","settings"],run:function(){this.$stage.children(".cloned").remove()}},{filter:["width","items","settings"],run:function(a){var b=this.settings.margin||"",c=!this.settings.autoWidth,d=this.settings.rtl,e={width:"auto","margin-left":d?b:"","margin-right":d?"":b};!c&&this.$stage.children().css(e),a.css=e}},{filter:["width","items","settings"],run:function(a){var b=(this.width()/this.settings.items).toFixed(3)-this.settings.margin,c=null,d=this._items.length,e=!this.settings.autoWidth,f=[];for(a.items={merge:!1,width:b};d--;)c=this._mergers[d],c=this.settings.mergeFit&&Math.min(c,this.settings.items)||c,a.items.merge=c>1||a.items.merge,f[d]=e?b*c:this._items[d].width();this._widths=f}},{filter:["items","settings"],run:function(){var b=[],c=this._items,d=this.settings,e=Math.max(2*d.items,4),f=2*Math.ceil(c.length/2),g=d.loop&&c.length?d.rewind?e:Math.max(e,f):0,h="",i="";for(g/=2;g--;)b.push(this.normalize(b.length/2,!0)),h+=c[b[b.length-1]][0].outerHTML,b.push(this.normalize(c.length-1-(b.length-1)/2,!0)),i=c[b[b.length-1]][0].outerHTML+i;this._clones=b,a(h).addClass("cloned").appendTo(this.$stage),a(i).addClass("cloned").prependTo(this.$stage)}},{filter:["width","items","settings"],run:function(){for(var a=this.settings.rtl?1:-1,b=this._clones.length+this._items.length,c=-1,d=0,e=0,f=[];++c<b;)d=f[c-1]||0,e=this._widths[this.relative(c)]+this.settings.margin,f.push(d+e*a);this._coordinates=f}},{filter:["width","items","settings"],run:function(){var a=this.settings.stagePadding,b=this._coordinates,c={width:Math.ceil(Math.abs(b[b.length-1]))+2*a,"padding-left":a||"","padding-right":a||""};this.$stage.css(c)}},{filter:["width","items","settings"],run:function(a){var b=this._coordinates.length,c=!this.settings.autoWidth,d=this.$stage.children();if(c&&a.items.merge)for(;b--;)a.css.width=this._widths[this.relative(b)],d.eq(b).css(a.css);else c&&(a.css.width=a.items.width,d.css(a.css))}},{filter:["items"],run:function(){this._coordinates.length<1&&this.$stage.removeAttr("style")}},{filter:["width","items","settings"],run:function(a){a.current=a.current?this.$stage.children().index(a.current):0,a.current=Math.max(this.minimum(),Math.min(this.maximum(),a.current)),this.reset(a.current)}},{filter:["position"],run:function(){this.animate(this.coordinates(this._current))}},{filter:["width","position","items","settings"],run:function(){var a,b,c,d,e=this.settings.rtl?1:-1,f=2*this.settings.stagePadding,g=this.coordinates(this.current())+f,h=g+this.width()*e,i=[];for(c=0,d=this._coordinates.length;c<d;c++)a=this._coordinates[c-1]||0,b=Math.abs(this._coordinates[c])+f*e,(this.op(a,"<=",g)&&this.op(a,">",h)||this.op(b,"<",g)&&this.op(b,">",h))&&i.push(c);this.$stage.children(".active").removeClass("active"),this.$stage.children(":eq("+i.join("), :eq(")+")").addClass("active"),this.settings.center&&(this.$stage.children(".center").removeClass("center"),this.$stage.children().eq(this.current()).addClass("center"))}}],e.prototype.initialize=function(){if(this.enter("initializing"),this.trigger("initialize"),this.$element.toggleClass(this.settings.rtlClass,this.settings.rtl),this.settings.autoWidth&&!this.is("pre-loading")){var b,c,e;b=this.$element.find("img"),c=this.settings.nestedItemSelector?"."+this.settings.nestedItemSelector:d,e=this.$element.children(c).width(),b.length&&e<=0&&this.preloadAutoWidthImages(b)}this.$element.addClass(this.options.loadingClass),this.$stage=a("<"+this.settings.stageElement+' class="'+this.settings.stageClass+'"/>').wrap('<div class="'+this.settings.stageOuterClass+'"/>'),this.$element.append(this.$stage.parent()),this.replace(this.$element.children().not(this.$stage.parent())),this.$element.is(":visible")?this.refresh():this.invalidate("width"),this.$element.removeClass(this.options.loadingClass).addClass(this.options.loadedClass),this.registerEventHandlers(),this.leave("initializing"),this.trigger("initialized")},e.prototype.setup=function(){var b=this.viewport(),c=this.options.responsive,d=-1,e=null;c?(a.each(c,function(a){a<=b&&a>d&&(d=Number(a))}),e=a.extend({},this.options,c[d]),"function"==typeof e.stagePadding&&(e.stagePadding=e.stagePadding()),delete e.responsive,e.responsiveClass&&this.$element.attr("class",this.$element.attr("class").replace(new RegExp("("+this.options.responsiveClass+"-)\\S+\\s","g"),"$1"+d))):e=a.extend({},this.options),this.trigger("change",{property:{name:"settings",value:e}}),this._breakpoint=d,this.settings=e,this.invalidate("settings"),this.trigger("changed",{property:{name:"settings",value:this.settings}})},e.prototype.optionsLogic=function(){this.settings.autoWidth&&(this.settings.stagePadding=!1,this.settings.merge=!1)},e.prototype.prepare=function(b){var c=this.trigger("prepare",{content:b});return c.data||(c.data=a("<"+this.settings.itemElement+"/>").addClass(this.options.itemClass).append(b)),this.trigger("prepared",{content:c.data}),c.data},e.prototype.update=function(){for(var b=0,c=this._pipe.length,d=a.proxy(function(a){return this[a]},this._invalidated),e={};b<c;)(this._invalidated.all||a.grep(this._pipe[b].filter,d).length>0)&&this._pipe[b].run(e),b++;this._invalidated={},!this.is("valid")&&this.enter("valid")},e.prototype.width=function(a){switch(a=a||e.Width.Default){case e.Width.Inner:case e.Width.Outer:return this._width;default:return this._width-2*this.settings.stagePadding+this.settings.margin}},e.prototype.refresh=function(){this.enter("refreshing"),this.trigger("refresh"),this.setup(),this.optionsLogic(),this.$element.addClass(this.options.refreshClass),this.update(),this.$element.removeClass(this.options.refreshClass),this.leave("refreshing"),this.trigger("refreshed")},e.prototype.onThrottledResize=function(){b.clearTimeout(this.resizeTimer),this.resizeTimer=b.setTimeout(this._handlers.onResize,this.settings.responsiveRefreshRate)},e.prototype.onResize=function(){return!!this._items.length&&this._width!==this.$element.width()&&!!this.$element.is(":visible")&&(this.enter("resizing"),this.trigger("resize").isDefaultPrevented()?(this.leave("resizing"),!1):(this.invalidate("width"),this.refresh(),this.leave("resizing"),void this.trigger("resized")))},e.prototype.registerEventHandlers=function(){a.support.transition&&this.$stage.on(a.support.transition.end+".owl.core",a.proxy(this.onTransitionEnd,this)),!1!==this.settings.responsive&&this.on(b,"resize",this._handlers.onThrottledResize),this.settings.mouseDrag&&(this.$element.addClass(this.options.dragClass),this.$stage.on("mousedown.owl.core",a.proxy(this.onDragStart,this)),this.$stage.on("dragstart.owl.core selectstart.owl.core",function(){return!1})),this.settings.touchDrag&&(this.$stage.on("touchstart.owl.core",a.proxy(this.onDragStart,this)),this.$stage.on("touchcancel.owl.core",a.proxy(this.onDragEnd,this)))},e.prototype.onDragStart=function(b){var d=null;3!==b.which&&(a.support.transform?(d=this.$stage.css("transform").replace(/.*\(|\)| /g,"").split(","),d={x:d[16===d.length?12:4],y:d[16===d.length?13:5]}):(d=this.$stage.position(),d={x:this.settings.rtl?d.left+this.$stage.width()-this.width()+this.settings.margin:d.left,y:d.top}),this.is("animating")&&(a.support.transform?this.animate(d.x):this.$stage.stop(),this.invalidate("position")),this.$element.toggleClass(this.options.grabClass,"mousedown"===b.type),this.speed(0),this._drag.time=(new Date).getTime(),this._drag.target=a(b.target),this._drag.stage.start=d,this._drag.stage.current=d,this._drag.pointer=this.pointer(b),a(c).on("mouseup.owl.core touchend.owl.core",a.proxy(this.onDragEnd,this)),a(c).one("mousemove.owl.core touchmove.owl.core",a.proxy(function(b){var d=this.difference(this._drag.pointer,this.pointer(b));a(c).on("mousemove.owl.core touchmove.owl.core",a.proxy(this.onDragMove,this)),Math.abs(d.x)<Math.abs(d.y)&&this.is("valid")||(b.preventDefault(),this.enter("dragging"),this.trigger("drag"))},this)))},e.prototype.onDragMove=function(a){var b=null,c=null,d=null,e=this.difference(this._drag.pointer,this.pointer(a)),f=this.difference(this._drag.stage.start,e);this.is("dragging")&&(a.preventDefault(),this.settings.loop?(b=this.coordinates(this.minimum()),c=this.coordinates(this.maximum()+1)-b,f.x=((f.x-b)%c+c)%c+b):(b=this.settings.rtl?this.coordinates(this.maximum()):this.coordinates(this.minimum()),c=this.settings.rtl?this.coordinates(this.minimum()):this.coordinates(this.maximum()),d=this.settings.pullDrag?-1*e.x/5:0,f.x=Math.max(Math.min(f.x,b+d),c+d)),this._drag.stage.current=f,this.animate(f.x))},e.prototype.onDragEnd=function(b){var d=this.difference(this._drag.pointer,this.pointer(b)),e=this._drag.stage.current,f=d.x>0^this.settings.rtl?"left":"right";a(c).off(".owl.core"),this.$element.removeClass(this.options.grabClass),(0!==d.x&&this.is("dragging")||!this.is("valid"))&&(this.speed(this.settings.dragEndSpeed||this.settings.smartSpeed),this.current(this.closest(e.x,0!==d.x?f:this._drag.direction)),this.invalidate("position"),this.update(),this._drag.direction=f,(Math.abs(d.x)>3||(new Date).getTime()-this._drag.time>300)&&this._drag.target.one("click.owl.core",function(){return!1})),this.is("dragging")&&(this.leave("dragging"),this.trigger("dragged"))},e.prototype.closest=function(b,c){var d=-1,f=this.width(),g=this.coordinates();return this.settings.freeDrag||a.each(g,a.proxy(function(a,h){return"left"===c&&b>h-30&&b<h+30?d=a:"right"===c&&b>h-f-30&&b<h-f+30?d=a+1:this.op(b,"<",h)&&this.op(b,">",g[a+1]||h-f)&&(d="left"===c?a+1:a),-1===d},this)),this.settings.loop||(this.op(b,">",g[this.minimum()])?d=b=this.minimum():this.op(b,"<",g[this.maximum()])&&(d=b=this.maximum())),d},e.prototype.animate=function(b){var c=this.speed()>0;this.is("animating")&&this.onTransitionEnd(),c&&(this.enter("animating"),this.trigger("translate")),a.support.transform3d&&a.support.transition?this.$stage.css({transform:"translate3d("+b+"px,0px,0px)",transition:this.speed()/1e3+"s"}):c?this.$stage.animate({left:b+"px"},this.speed(),this.settings.fallbackEasing,a.proxy(this.onTransitionEnd,this)):this.$stage.css({left:b+"px"})},e.prototype.is=function(a){return this._states.current[a]&&this._states.current[a]>0},e.prototype.current=function(a){if(a===d)return this._current;if(0===this._items.length)return d;if(a=this.normalize(a),this._current!==a){var b=this.trigger("change",{property:{name:"position",value:a}});b.data!==d&&(a=this.normalize(b.data)),this._current=a,this.invalidate("position"),this.trigger("changed",{property:{name:"position",value:this._current}})}return this._current},e.prototype.invalidate=function(b){return"string"===a.type(b)&&(this._invalidated[b]=!0,this.is("valid")&&this.leave("valid")),a.map(this._invalidated,function(a,b){return b})},e.prototype.reset=function(a){(a=this.normalize(a))!==d&&(this._speed=0,this._current=a,this.suppress(["translate","translated"]),this.animate(this.coordinates(a)),this.release(["translate","translated"]))},e.prototype.normalize=function(a,b){var c=this._items.length,e=b?0:this._clones.length;return!this.isNumeric(a)||c<1?a=d:(a<0||a>=c+e)&&(a=((a-e/2)%c+c)%c+e/2),a},e.prototype.relative=function(a){return a-=this._clones.length/2,this.normalize(a,!0)},e.prototype.maximum=function(a){var b,c,d,e=this.settings,f=this._coordinates.length;if(e.loop)f=this._clones.length/2+this._items.length-1;else if(e.autoWidth||e.merge){for(b=this._items.length,c=this._items[--b].width(),d=this.$element.width();b--&&!((c+=this._items[b].width()+this.settings.margin)>d););f=b+1}else f=e.center?this._items.length-1:this._items.length-e.items;return a&&(f-=this._clones.length/2),Math.max(f,0)},e.prototype.minimum=function(a){return a?0:this._clones.length/2},e.prototype.items=function(a){return a===d?this._items.slice():(a=this.normalize(a,!0),this._items[a])},e.prototype.mergers=function(a){return a===d?this._mergers.slice():(a=this.normalize(a,!0),this._mergers[a])},e.prototype.clones=function(b){var c=this._clones.length/2,e=c+this._items.length,f=function(a){return a%2==0?e+a/2:c-(a+1)/2};return b===d?a.map(this._clones,function(a,b){return f(b)}):a.map(this._clones,function(a,c){return a===b?f(c):null})},e.prototype.speed=function(a){return a!==d&&(this._speed=a),this._speed},e.prototype.coordinates=function(b){var c,e=1,f=b-1;return b===d?a.map(this._coordinates,a.proxy(function(a,b){return this.coordinates(b)},this)):(this.settings.center?(this.settings.rtl&&(e=-1,f=b+1),c=this._coordinates[b],c+=(this.width()-c+(this._coordinates[f]||0))/2*e):c=this._coordinates[f]||0,c=Math.ceil(c))},e.prototype.duration=function(a,b,c){return 0===c?0:Math.min(Math.max(Math.abs(b-a),1),6)*Math.abs(c||this.settings.smartSpeed)},e.prototype.to=function(a,b){var c=this.current(),d=null,e=a-this.relative(c),f=(e>0)-(e<0),g=this._items.length,h=this.minimum(),i=this.maximum();this.settings.loop?(!this.settings.rewind&&Math.abs(e)>g/2&&(e+=-1*f*g),a=c+e,(d=((a-h)%g+g)%g+h)!==a&&d-e<=i&&d-e>0&&(c=d-e,a=d,this.reset(c))):this.settings.rewind?(i+=1,a=(a%i+i)%i):a=Math.max(h,Math.min(i,a)),this.speed(this.duration(c,a,b)),this.current(a),this.$element.is(":visible")&&this.update()},e.prototype.next=function(a){a=a||!1,this.to(this.relative(this.current())+1,a)},e.prototype.prev=function(a){a=a||!1,this.to(this.relative(this.current())-1,a)},e.prototype.onTransitionEnd=function(a){if(a!==d&&(a.stopPropagation(),(a.target||a.srcElement||a.originalTarget)!==this.$stage.get(0)))return!1;this.leave("animating"),this.trigger("translated")},e.prototype.viewport=function(){var d;return this.options.responsiveBaseElement!==b?d=a(this.options.responsiveBaseElement).width():b.innerWidth?d=b.innerWidth:c.documentElement&&c.documentElement.clientWidth?d=c.documentElement.clientWidth:console.warn("Can not detect viewport width."),d},e.prototype.replace=function(b){this.$stage.empty(),this._items=[],b&&(b=b instanceof jQuery?b:a(b)),this.settings.nestedItemSelector&&(b=b.find("."+this.settings.nestedItemSelector)),b.filter(function(){return 1===this.nodeType}).each(a.proxy(function(a,b){b=this.prepare(b),this.$stage.append(b),this._items.push(b),this._mergers.push(1*b.find("[data-merge]").addBack("[data-merge]").attr("data-merge")||1)},this)),this.reset(this.isNumeric(this.settings.startPosition)?this.settings.startPosition:0),this.invalidate("items")},e.prototype.add=function(b,c){var e=this.relative(this._current);c=c===d?this._items.length:this.normalize(c,!0),b=b instanceof jQuery?b:a(b),this.trigger("add",{content:b,position:c}),b=this.prepare(b),0===this._items.length||c===this._items.length?(0===this._items.length&&this.$stage.append(b),0!==this._items.length&&this._items[c-1].after(b),this._items.push(b),this._mergers.push(1*b.find("[data-merge]").addBack("[data-merge]").attr("data-merge")||1)):(this._items[c].before(b),this._items.splice(c,0,b),this._mergers.splice(c,0,1*b.find("[data-merge]").addBack("[data-merge]").attr("data-merge")||1)),this._items[e]&&this.reset(this._items[e].index()),this.invalidate("items"),this.trigger("added",{content:b,position:c})},e.prototype.remove=function(a){(a=this.normalize(a,!0))!==d&&(this.trigger("remove",{content:this._items[a],position:a}),this._items[a].remove(),this._items.splice(a,1),this._mergers.splice(a,1),this.invalidate("items"),this.trigger("removed",{content:null,position:a}))},e.prototype.preloadAutoWidthImages=function(b){b.each(a.proxy(function(b,c){this.enter("pre-loading"),c=a(c),a(new Image).one("load",a.proxy(function(a){c.attr("src",a.target.src),c.css("opacity",1),this.leave("pre-loading"),!this.is("pre-loading")&&!this.is("initializing")&&this.refresh()},this)).attr("src",c.attr("src")||c.attr("data-src")||c.attr("data-src-retina"))},this))},e.prototype.destroy=function(){this.$element.off(".owl.core"),this.$stage.off(".owl.core"),a(c).off(".owl.core"),!1!==this.settings.responsive&&(b.clearTimeout(this.resizeTimer),this.off(b,"resize",this._handlers.onThrottledResize));for(var d in this._plugins)this._plugins[d].destroy();this.$stage.children(".cloned").remove(),this.$stage.unwrap(),this.$stage.children().contents().unwrap(),this.$stage.children().unwrap(),this.$element.removeClass(this.options.refreshClass).removeClass(this.options.loadingClass).removeClass(this.options.loadedClass).removeClass(this.options.rtlClass).removeClass(this.options.dragClass).removeClass(this.options.grabClass).attr("class",this.$element.attr("class").replace(new RegExp(this.options.responsiveClass+"-\\S+\\s","g"),"")).removeData("owl.carousel")},e.prototype.op=function(a,b,c){var d=this.settings.rtl;switch(b){case"<":return d?a>c:a<c;case">":return d?a<c:a>c;case">=":return d?a<=c:a>=c;case"<=":return d?a>=c:a<=c}},e.prototype.on=function(a,b,c,d){a.addEventListener?a.addEventListener(b,c,d):a.attachEvent&&a.attachEvent("on"+b,c)},e.prototype.off=function(a,b,c,d){a.removeEventListener?a.removeEventListener(b,c,d):a.detachEvent&&a.detachEvent("on"+b,c)},e.prototype.trigger=function(b,c,d,f,g){var h={item:{count:this._items.length,index:this.current()}},i=a.camelCase(a.grep(["on",b,d],function(a){return a}).join("-").toLowerCase()),j=a.Event([b,"owl",d||"carousel"].join(".").toLowerCase(),a.extend({relatedTarget:this},h,c));return this._supress[b]||(a.each(this._plugins,function(a,b){b.onTrigger&&b.onTrigger(j)}),this.register({type:e.Type.Event,name:b}),this.$element.trigger(j),this.settings&&"function"==typeof this.settings[i]&&this.settings[i].call(this,j)),j},e.prototype.enter=function(b){a.each([b].concat(this._states.tags[b]||[]),a.proxy(function(a,b){this._states.current[b]===d&&(this._states.current[b]=0),this._states.current[b]++},this))},e.prototype.leave=function(b){a.each([b].concat(this._states.tags[b]||[]),a.proxy(function(a,b){this._states.current[b]--},this))},e.prototype.register=function(b){if(b.type===e.Type.Event){if(a.event.special[b.name]||(a.event.special[b.name]={}),!a.event.special[b.name].owl){var c=a.event.special[b.name]._default;a.event.special[b.name]._default=function(a){return!c||!c.apply||a.namespace&&-1!==a.namespace.indexOf("owl")?a.namespace&&a.namespace.indexOf("owl")>-1:c.apply(this,arguments)},a.event.special[b.name].owl=!0}}else b.type===e.Type.State&&(this._states.tags[b.name]?this._states.tags[b.name]=this._states.tags[b.name].concat(b.tags):this._states.tags[b.name]=b.tags,this._states.tags[b.name]=a.grep(this._states.tags[b.name],a.proxy(function(c,d){return a.inArray(c,this._states.tags[b.name])===d},this)))},e.prototype.suppress=function(b){a.each(b,a.proxy(function(a,b){this._supress[b]=!0},this))},e.prototype.release=function(b){a.each(b,a.proxy(function(a,b){delete this._supress[b]},this))},e.prototype.pointer=function(a){var c={x:null,y:null};return a=a.originalEvent||a||b.event,a=a.touches&&a.touches.length?a.touches[0]:a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:a,a.pageX?(c.x=a.pageX,c.y=a.pageY):(c.x=a.clientX,c.y=a.clientY),c},e.prototype.isNumeric=function(a){return!isNaN(parseFloat(a))},e.prototype.difference=function(a,b){return{x:a.x-b.x,y:a.y-b.y}},a.fn.owlCarousel=function(b){var c=Array.prototype.slice.call(arguments,1);return this.each(function(){var d=a(this),f=d.data("owl.carousel");f||(f=new e(this,"object"==(void 0===b?"undefined":_typeof(b))&&b),d.data("owl.carousel",f),a.each(["next","prev","to","destroy","refresh","replace","add","remove"],function(b,c){f.register({type:e.Type.Event,name:c}),f.$element.on(c+".owl.carousel.core",a.proxy(function(a){a.namespace&&a.relatedTarget!==this&&(this.suppress([c]),f[c].apply(this,[].slice.call(arguments,1)),this.release([c]))},f))})),"string"==typeof b&&"_"!==b.charAt(0)&&f[b].apply(f,c)})},a.fn.owlCarousel.Constructor=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){var e=function e(b){this._core=b,this._interval=null,this._visible=null,this._handlers={"initialized.owl.carousel":a.proxy(function(a){a.namespace&&this._core.settings.autoRefresh&&this.watch()},this)},this._core.options=a.extend({},e.Defaults,this._core.options),this._core.$element.on(this._handlers)};e.Defaults={autoRefresh:!0,autoRefreshInterval:500},e.prototype.watch=function(){
this._interval||(this._visible=this._core.$element.is(":visible"),this._interval=b.setInterval(a.proxy(this.refresh,this),this._core.settings.autoRefreshInterval))},e.prototype.refresh=function(){this._core.$element.is(":visible")!==this._visible&&(this._visible=!this._visible,this._core.$element.toggleClass("owl-hidden",!this._visible),this._visible&&this._core.invalidate("width")&&this._core.refresh())},e.prototype.destroy=function(){var a,c;b.clearInterval(this._interval);for(a in this._handlers)this._core.$element.off(a,this._handlers[a]);for(c in Object.getOwnPropertyNames(this))"function"!=typeof this[c]&&(this[c]=null)},a.fn.owlCarousel.Constructor.Plugins.AutoRefresh=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){var e=function e(b){this._core=b,this._loaded=[],this._handlers={"initialized.owl.carousel change.owl.carousel resized.owl.carousel":a.proxy(function(b){if(b.namespace&&this._core.settings&&this._core.settings.lazyLoad&&(b.property&&"position"==b.property.name||"initialized"==b.type))for(var c=this._core.settings,e=c.center&&Math.ceil(c.items/2)||c.items,f=c.center&&-1*e||0,g=(b.property&&void 0!==b.property.value?b.property.value:this._core.current())+f,h=this._core.clones().length,i=a.proxy(function(a,b){this.load(b)},this);f++<e;)this.load(h/2+this._core.relative(g)),h&&a.each(this._core.clones(this._core.relative(g)),i),g++},this)},this._core.options=a.extend({},e.Defaults,this._core.options),this._core.$element.on(this._handlers)};e.Defaults={lazyLoad:!1},e.prototype.load=function(c){var d=this._core.$stage.children().eq(c),e=d&&d.find(".owl-lazy");!e||a.inArray(d.get(0),this._loaded)>-1||(e.each(a.proxy(function(c,d){var e,f=a(d),g=b.devicePixelRatio>1&&f.attr("data-src-retina")||f.attr("data-src");this._core.trigger("load",{element:f,url:g},"lazy"),f.is("img")?f.one("load.owl.lazy",a.proxy(function(){f.css("opacity",1),this._core.trigger("loaded",{element:f,url:g},"lazy")},this)).attr("src",g):(e=new Image,e.onload=a.proxy(function(){f.css({"background-image":'url("'+g+'")',opacity:"1"}),this._core.trigger("loaded",{element:f,url:g},"lazy")},this),e.src=g)},this)),this._loaded.push(d.get(0)))},e.prototype.destroy=function(){var a,b;for(a in this.handlers)this._core.$element.off(a,this.handlers[a]);for(b in Object.getOwnPropertyNames(this))"function"!=typeof this[b]&&(this[b]=null)},a.fn.owlCarousel.Constructor.Plugins.Lazy=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){var e=function e(b){this._core=b,this._handlers={"initialized.owl.carousel refreshed.owl.carousel":a.proxy(function(a){a.namespace&&this._core.settings.autoHeight&&this.update()},this),"changed.owl.carousel":a.proxy(function(a){a.namespace&&this._core.settings.autoHeight&&"position"==a.property.name&&this.update()},this),"loaded.owl.lazy":a.proxy(function(a){a.namespace&&this._core.settings.autoHeight&&a.element.closest("."+this._core.settings.itemClass).index()===this._core.current()&&this.update()},this)},this._core.options=a.extend({},e.Defaults,this._core.options),this._core.$element.on(this._handlers)};e.Defaults={autoHeight:!1,autoHeightClass:"owl-height"},e.prototype.update=function(){var b=this._core._current,c=b+this._core.settings.items,d=this._core.$stage.children().toArray().slice(b,c),e=[],f=0;a.each(d,function(b,c){e.push(a(c).height())}),f=Math.max.apply(null,e),this._core.$stage.parent().height(f).addClass(this._core.settings.autoHeightClass)},e.prototype.destroy=function(){var a,b;for(a in this._handlers)this._core.$element.off(a,this._handlers[a]);for(b in Object.getOwnPropertyNames(this))"function"!=typeof this[b]&&(this[b]=null)},a.fn.owlCarousel.Constructor.Plugins.AutoHeight=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){var e=function e(b){this._core=b,this._videos={},this._playing=null,this._handlers={"initialized.owl.carousel":a.proxy(function(a){a.namespace&&this._core.register({type:"state",name:"playing",tags:["interacting"]})},this),"resize.owl.carousel":a.proxy(function(a){a.namespace&&this._core.settings.video&&this.isInFullScreen()&&a.preventDefault()},this),"refreshed.owl.carousel":a.proxy(function(a){a.namespace&&this._core.is("resizing")&&this._core.$stage.find(".cloned .owl-video-frame").remove()},this),"changed.owl.carousel":a.proxy(function(a){a.namespace&&"position"===a.property.name&&this._playing&&this.stop()},this),"prepared.owl.carousel":a.proxy(function(b){if(b.namespace){var c=a(b.content).find(".owl-video");c.length&&(c.css("display","none"),this.fetch(c,a(b.content)))}},this)},this._core.options=a.extend({},e.Defaults,this._core.options),this._core.$element.on(this._handlers),this._core.$element.on("click.owl.video",".owl-video-play-icon",a.proxy(function(a){this.play(a)},this))};e.Defaults={video:!1,videoHeight:!1,videoWidth:!1},e.prototype.fetch=function(a,b){var c=function(){return a.attr("data-vimeo-id")?"vimeo":a.attr("data-vzaar-id")?"vzaar":"youtube"}(),d=a.attr("data-vimeo-id")||a.attr("data-youtube-id")||a.attr("data-vzaar-id"),e=a.attr("data-width")||this._core.settings.videoWidth,f=a.attr("data-height")||this._core.settings.videoHeight,g=a.attr("href");if(!g)throw new Error("Missing video URL.");if(d=g.match(/(http:|https:|)\/\/(player.|www.|app.)?(vimeo\.com|youtu(be\.com|\.be|be\.googleapis\.com)|vzaar\.com)\/(video\/|videos\/|embed\/|channels\/.+\/|groups\/.+\/|watch\?v=|v\/)?([A-Za-z0-9._%-]*)(\&\S+)?/),d[3].indexOf("youtu")>-1)c="youtube";else if(d[3].indexOf("vimeo")>-1)c="vimeo";else{if(!(d[3].indexOf("vzaar")>-1))throw new Error("Video URL not supported.");c="vzaar"}d=d[6],this._videos[g]={type:c,id:d,width:e,height:f},b.attr("data-video",g),this.thumbnail(a,this._videos[g])},e.prototype.thumbnail=function(b,c){var d,e,f,g=c.width&&c.height?'style="width:'+c.width+"px;height:"+c.height+'px;"':"",h=b.find("img"),i="src",j="",k=this._core.settings,l=function(a){e='<div class="owl-video-play-icon"></div>',d=k.lazyLoad?'<div class="owl-video-tn '+j+'" '+i+'="'+a+'"></div>':'<div class="owl-video-tn" style="opacity:1;background-image:url('+a+')"></div>',b.after(d),b.after(e)};if(b.wrap('<div class="owl-video-wrapper"'+g+"></div>"),this._core.settings.lazyLoad&&(i="data-src",j="owl-lazy"),h.length)return l(h.attr(i)),h.remove(),!1;"youtube"===c.type?(f="//img.youtube.com/vi/"+c.id+"/hqdefault.jpg",l(f)):"vimeo"===c.type?a.ajax({type:"GET",url:"//vimeo.com/api/v2/video/"+c.id+".json",jsonp:"callback",dataType:"jsonp",success:function(a){f=a[0].thumbnail_large,l(f)}}):"vzaar"===c.type&&a.ajax({type:"GET",url:"//vzaar.com/api/videos/"+c.id+".json",jsonp:"callback",dataType:"jsonp",success:function(a){f=a.framegrab_url,l(f)}})},e.prototype.stop=function(){this._core.trigger("stop",null,"video"),this._playing.find(".owl-video-frame").remove(),this._playing.removeClass("owl-video-playing"),this._playing=null,this._core.leave("playing"),this._core.trigger("stopped",null,"video")},e.prototype.play=function(b){var c,d=a(b.target),e=d.closest("."+this._core.settings.itemClass),f=this._videos[e.attr("data-video")],g=f.width||"100%",h=f.height||this._core.$stage.height();this._playing||(this._core.enter("playing"),this._core.trigger("play",null,"video"),e=this._core.items(this._core.relative(e.index())),this._core.reset(e.index()),"youtube"===f.type?c='<iframe width="'+g+'" height="'+h+'" src="//www.youtube.com/embed/'+f.id+"?autoplay=1&rel=0&v="+f.id+'" frameborder="0" allowfullscreen></iframe>':"vimeo"===f.type?c='<iframe src="//player.vimeo.com/video/'+f.id+'?autoplay=1" width="'+g+'" height="'+h+'" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>':"vzaar"===f.type&&(c='<iframe frameborder="0"height="'+h+'"width="'+g+'" allowfullscreen mozallowfullscreen webkitAllowFullScreen src="//view.vzaar.com/'+f.id+'/player?autoplay=true"></iframe>'),a('<div class="owl-video-frame">'+c+"</div>").insertAfter(e.find(".owl-video")),this._playing=e.addClass("owl-video-playing"))},e.prototype.isInFullScreen=function(){var b=c.fullscreenElement||c.mozFullScreenElement||c.webkitFullscreenElement;return b&&a(b).parent().hasClass("owl-video-frame")},e.prototype.destroy=function(){var a,b;this._core.$element.off("click.owl.video");for(a in this._handlers)this._core.$element.off(a,this._handlers[a]);for(b in Object.getOwnPropertyNames(this))"function"!=typeof this[b]&&(this[b]=null)},a.fn.owlCarousel.Constructor.Plugins.Video=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){var e=function e(b){this.core=b,this.core.options=a.extend({},e.Defaults,this.core.options),this.swapping=!0,this.previous=d,this.next=d,this.handlers={"change.owl.carousel":a.proxy(function(a){a.namespace&&"position"==a.property.name&&(this.previous=this.core.current(),this.next=a.property.value)},this),"drag.owl.carousel dragged.owl.carousel translated.owl.carousel":a.proxy(function(a){a.namespace&&(this.swapping="translated"==a.type)},this),"translate.owl.carousel":a.proxy(function(a){a.namespace&&this.swapping&&(this.core.options.animateOut||this.core.options.animateIn)&&this.swap()},this)},this.core.$element.on(this.handlers)};e.Defaults={animateOut:!1,animateIn:!1},e.prototype.swap=function(){if(1===this.core.settings.items&&a.support.animation&&a.support.transition){this.core.speed(0);var b,c=a.proxy(this.clear,this),d=this.core.$stage.children().eq(this.previous),e=this.core.$stage.children().eq(this.next),f=this.core.settings.animateIn,g=this.core.settings.animateOut;this.core.current()!==this.previous&&(g&&(b=this.core.coordinates(this.previous)-this.core.coordinates(this.next),d.one(a.support.animation.end,c).css({left:b+"px"}).addClass("animated owl-animated-out").addClass(g)),f&&e.one(a.support.animation.end,c).addClass("animated owl-animated-in").addClass(f))}},e.prototype.clear=function(b){a(b.target).css({left:""}).removeClass("animated owl-animated-out owl-animated-in").removeClass(this.core.settings.animateIn).removeClass(this.core.settings.animateOut),this.core.onTransitionEnd()},e.prototype.destroy=function(){var a,b;for(a in this.handlers)this.core.$element.off(a,this.handlers[a]);for(b in Object.getOwnPropertyNames(this))"function"!=typeof this[b]&&(this[b]=null)},a.fn.owlCarousel.Constructor.Plugins.Animate=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){var e=function e(b){this._core=b,this._timeout=null,this._paused=!1,this._handlers={"changed.owl.carousel":a.proxy(function(a){a.namespace&&"settings"===a.property.name?this._core.settings.autoplay?this.play():this.stop():a.namespace&&"position"===a.property.name&&this._core.settings.autoplay&&this._setAutoPlayInterval()},this),"initialized.owl.carousel":a.proxy(function(a){a.namespace&&this._core.settings.autoplay&&this.play()},this),"play.owl.autoplay":a.proxy(function(a,b,c){a.namespace&&this.play(b,c)},this),"stop.owl.autoplay":a.proxy(function(a){a.namespace&&this.stop()},this),"mouseover.owl.autoplay":a.proxy(function(){this._core.settings.autoplayHoverPause&&this._core.is("rotating")&&this.pause()},this),"mouseleave.owl.autoplay":a.proxy(function(){this._core.settings.autoplayHoverPause&&this._core.is("rotating")&&this.play()},this),"touchstart.owl.core":a.proxy(function(){this._core.settings.autoplayHoverPause&&this._core.is("rotating")&&this.pause()},this),"touchend.owl.core":a.proxy(function(){this._core.settings.autoplayHoverPause&&this.play()},this)},this._core.$element.on(this._handlers),this._core.options=a.extend({},e.Defaults,this._core.options)};e.Defaults={autoplay:!1,autoplayTimeout:5e3,autoplayHoverPause:!1,autoplaySpeed:!1},e.prototype.play=function(a,b){this._paused=!1,this._core.is("rotating")||(this._core.enter("rotating"),this._setAutoPlayInterval())},e.prototype._getNextTimeout=function(d,e){return this._timeout&&b.clearTimeout(this._timeout),b.setTimeout(a.proxy(function(){this._paused||this._core.is("busy")||this._core.is("interacting")||c.hidden||this._core.next(e||this._core.settings.autoplaySpeed)},this),d||this._core.settings.autoplayTimeout)},e.prototype._setAutoPlayInterval=function(){this._timeout=this._getNextTimeout()},e.prototype.stop=function(){this._core.is("rotating")&&(b.clearTimeout(this._timeout),this._core.leave("rotating"))},e.prototype.pause=function(){this._core.is("rotating")&&(this._paused=!0)},e.prototype.destroy=function(){var a,b;this.stop();for(a in this._handlers)this._core.$element.off(a,this._handlers[a]);for(b in Object.getOwnPropertyNames(this))"function"!=typeof this[b]&&(this[b]=null)},a.fn.owlCarousel.Constructor.Plugins.autoplay=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){"use strict";var e=function e(b){this._core=b,this._initialized=!1,this._pages=[],this._controls={},this._templates=[],this.$element=this._core.$element,this._overrides={next:this._core.next,prev:this._core.prev,to:this._core.to},this._handlers={"prepared.owl.carousel":a.proxy(function(b){b.namespace&&this._core.settings.dotsData&&this._templates.push('<div class="'+this._core.settings.dotClass+'">'+a(b.content).find("[data-dot]").addBack("[data-dot]").attr("data-dot")+"</div>")},this),"added.owl.carousel":a.proxy(function(a){a.namespace&&this._core.settings.dotsData&&this._templates.splice(a.position,0,this._templates.pop())},this),"remove.owl.carousel":a.proxy(function(a){a.namespace&&this._core.settings.dotsData&&this._templates.splice(a.position,1)},this),"changed.owl.carousel":a.proxy(function(a){a.namespace&&"position"==a.property.name&&this.draw()},this),"initialized.owl.carousel":a.proxy(function(a){a.namespace&&!this._initialized&&(this._core.trigger("initialize",null,"navigation"),this.initialize(),this.update(),this.draw(),this._initialized=!0,this._core.trigger("initialized",null,"navigation"))},this),"refreshed.owl.carousel":a.proxy(function(a){a.namespace&&this._initialized&&(this._core.trigger("refresh",null,"navigation"),this.update(),this.draw(),this._core.trigger("refreshed",null,"navigation"))},this)},this._core.options=a.extend({},e.Defaults,this._core.options),this.$element.on(this._handlers)};e.Defaults={nav:!1,navText:["prev","next"],navSpeed:!1,navElement:"div",navContainer:!1,navContainerClass:"owl-nav",navClass:["owl-prev","owl-next"],slideBy:1,dotClass:"owl-dot",dotsClass:"owl-dots",dots:!0,dotsEach:!1,dotsData:!1,dotsSpeed:!1,dotsContainer:!1},e.prototype.initialize=function(){var b,c=this._core.settings;this._controls.$relative=(c.navContainer?a(c.navContainer):a("<div>").addClass(c.navContainerClass).appendTo(this.$element)).addClass("disabled"),this._controls.$previous=a("<"+c.navElement+">").addClass(c.navClass[0]).html(c.navText[0]).prependTo(this._controls.$relative).on("click",a.proxy(function(a){this.prev(c.navSpeed)},this)),this._controls.$next=a("<"+c.navElement+">").addClass(c.navClass[1]).html(c.navText[1]).appendTo(this._controls.$relative).on("click",a.proxy(function(a){this.next(c.navSpeed)},this)),c.dotsData||(this._templates=[a("<div>").addClass(c.dotClass).append(a("<span>")).prop("outerHTML")]),this._controls.$absolute=(c.dotsContainer?a(c.dotsContainer):a("<div>").addClass(c.dotsClass).appendTo(this.$element)).addClass("disabled"),this._controls.$absolute.on("click","div",a.proxy(function(b){var d=a(b.target).parent().is(this._controls.$absolute)?a(b.target).index():a(b.target).parent().index();b.preventDefault(),this.to(d,c.dotsSpeed)},this));for(b in this._overrides)this._core[b]=a.proxy(this[b],this)},e.prototype.destroy=function(){var a,b,c,d;for(a in this._handlers)this.$element.off(a,this._handlers[a]);for(b in this._controls)this._controls[b].remove();for(d in this.overides)this._core[d]=this._overrides[d];for(c in Object.getOwnPropertyNames(this))"function"!=typeof this[c]&&(this[c]=null)},e.prototype.update=function(){var a,b,c,d=this._core.clones().length/2,e=d+this._core.items().length,f=this._core.maximum(!0),g=this._core.settings,h=g.center||g.autoWidth||g.dotsData?1:g.dotsEach||g.items;if("page"!==g.slideBy&&(g.slideBy=Math.min(g.slideBy,g.items)),g.dots||"page"==g.slideBy)for(this._pages=[],a=d,b=0,c=0;a<e;a++){if(b>=h||0===b){if(this._pages.push({start:Math.min(f,a-d),end:a-d+h-1}),Math.min(f,a-d)===f)break;b=0,++c}b+=this._core.mergers(this._core.relative(a))}},e.prototype.draw=function(){var b,c=this._core.settings,d=this._core.items().length<=c.items,e=this._core.relative(this._core.current()),f=c.loop||c.rewind;this._controls.$relative.toggleClass("disabled",!c.nav||d),c.nav&&(this._controls.$previous.toggleClass("disabled",!f&&e<=this._core.minimum(!0)),this._controls.$next.toggleClass("disabled",!f&&e>=this._core.maximum(!0))),this._controls.$absolute.toggleClass("disabled",!c.dots||d),c.dots&&(b=this._pages.length-this._controls.$absolute.children().length,c.dotsData&&0!==b?this._controls.$absolute.html(this._templates.join("")):b>0?this._controls.$absolute.append(new Array(b+1).join(this._templates[0])):b<0&&this._controls.$absolute.children().slice(b).remove(),this._controls.$absolute.find(".active").removeClass("active"),this._controls.$absolute.children().eq(a.inArray(this.current(),this._pages)).addClass("active"))},e.prototype.onTrigger=function(b){var c=this._core.settings;b.page={index:a.inArray(this.current(),this._pages),count:this._pages.length,size:c&&(c.center||c.autoWidth||c.dotsData?1:c.dotsEach||c.items)}},e.prototype.current=function(){var b=this._core.relative(this._core.current());return a.grep(this._pages,a.proxy(function(a,c){return a.start<=b&&a.end>=b},this)).pop()},e.prototype.getPosition=function(b){var c,d,e=this._core.settings;return"page"==e.slideBy?(c=a.inArray(this.current(),this._pages),d=this._pages.length,b?++c:--c,c=this._pages[(c%d+d)%d].start):(c=this._core.relative(this._core.current()),d=this._core.items().length,b?c+=e.slideBy:c-=e.slideBy),c},e.prototype.next=function(b){a.proxy(this._overrides.to,this._core)(this.getPosition(!0),b)},e.prototype.prev=function(b){a.proxy(this._overrides.to,this._core)(this.getPosition(!1),b)},e.prototype.to=function(b,c,d){var e;!d&&this._pages.length?(e=this._pages.length,a.proxy(this._overrides.to,this._core)(this._pages[(b%e+e)%e].start,c)):a.proxy(this._overrides.to,this._core)(b,c)},a.fn.owlCarousel.Constructor.Plugins.Navigation=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){"use strict";var e=function e(c){this._core=c,this._hashes={},this.$element=this._core.$element,this._handlers={"initialized.owl.carousel":a.proxy(function(c){c.namespace&&"URLHash"===this._core.settings.startPosition&&a(b).trigger("hashchange.owl.navigation")},this),"prepared.owl.carousel":a.proxy(function(b){if(b.namespace){var c=a(b.content).find("[data-hash]").addBack("[data-hash]").attr("data-hash");if(!c)return;this._hashes[c]=b.content}},this),"changed.owl.carousel":a.proxy(function(c){if(c.namespace&&"position"===c.property.name){var d=this._core.items(this._core.relative(this._core.current())),e=a.map(this._hashes,function(a,b){return a===d?b:null}).join();if(!e||b.location.hash.slice(1)===e)return;b.location.hash=e}},this)},this._core.options=a.extend({},e.Defaults,this._core.options),this.$element.on(this._handlers),a(b).on("hashchange.owl.navigation",a.proxy(function(a){var c=b.location.hash.substring(1),e=this._core.$stage.children(),f=this._hashes[c]&&e.index(this._hashes[c]);void 0!==f&&f!==this._core.current()&&this._core.to(this._core.relative(f),!1,!0)},this))};e.Defaults={URLhashListener:!1},e.prototype.destroy=function(){var c,d;a(b).off("hashchange.owl.navigation");for(c in this._handlers)this._core.$element.off(c,this._handlers[c]);for(d in Object.getOwnPropertyNames(this))"function"!=typeof this[d]&&(this[d]=null)},a.fn.owlCarousel.Constructor.Plugins.Hash=e}(window.Zepto||window.jQuery,window,document),function(a,b,c,d){function e(b,c){var e=!1,f=b.charAt(0).toUpperCase()+b.slice(1);return a.each((b+" "+h.join(f+" ")+f).split(" "),function(a,b){if(g[b]!==d)return e=!c||b,!1}),e}function f(a){return e(a,!0)}var g=a("<support>").get(0).style,h="Webkit Moz O ms".split(" "),i={transition:{end:{WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",transition:"transitionend"}},animation:{end:{WebkitAnimation:"webkitAnimationEnd",MozAnimation:"animationend",OAnimation:"oAnimationEnd",animation:"animationend"}}},j={csstransforms:function(){return!!e("transform")},csstransforms3d:function(){return!!e("perspective")},csstransitions:function(){return!!e("transition")},cssanimations:function(){return!!e("animation")}};j.csstransitions()&&(a.support.transition=new String(f("transition")),a.support.transition.end=i.transition.end[a.support.transition]),j.cssanimations()&&(a.support.animation=new String(f("animation")),a.support.animation.end=i.animation.end[a.support.animation]),j.csstransforms()&&(a.support.transform=new String(f("transform")),a.support.transform3d=j.csstransforms3d())}(window.Zepto||window.jQuery,window,document),$(function($){var self=this,$header=$(".fullpage"),h=window.innerHeight;$header.css("min-height",h),$("#particles").particleground({dotColor:"rgba(255, 255, 255, 0.92)",lineColor:"rgba(255, 255, 255, 0.1)",minSpeedX:.1,maxSpeedX:.6,minSpeedY:.1,maxSpeedY:.6,lineWidth:1,density:12100,curvedLines:!1,proximity:150,parallaxMultiplier:10,particleRadius:3}),$(".intro").css({"margin-top":-$(".intro").height()/2});var $hamburger=$(".hamburger");$hamburger.on("click touch",function(e){$hamburger.toggleClass("is-active")}),$("#hamburger").on("click touch",function(){$("#main-nav").fadeToggle(200)}),$("#soc-med").on("click touch",function(){$(self).width()<1e3&&($(this).toggleClass("open-list"),$("#soc-med-list").fadeToggle(200))}),$("#footer-1").on("click touch",function(){$(self).width()<1e3&&($(this).toggleClass("open-list"),$("#footer-1-list").fadeToggle(200))}),$("#footer-2").on("click touch",function(){$(self).width()<1e3&&($(this).toggleClass("open-list"),$("#footer-2-list").fadeToggle(200))}),$("#footer-3").on("click touch",function(){$(self).width()<1e3&&($(this).toggleClass("open-list"),$("#footer-3-list").fadeToggle(200))}),$("#footer-4").on("click touch",function(){$(self).width()<1e3&&($(this).toggleClass("open-list"),$("#footer-4-list").fadeToggle(200))}),window.onresize=function(event){$(this).width()>=1e3?($("#soc-med-list").show(),$("#footer-1-list").show(),$("#footer-2-list").show(),$("#footer-3-list").show(),$("#footer-4-list").show(),$(".open-list").removeClass("open-list")):($("#soc-med-list").hide(),$("#footer-1-list").hide(),$("#footer-2-list").hide(),$("#footer-3-list").hide(),$("#footer-4-list").hide())},$("#header-reg-input").on("change keyup paste",function(){$.trim(this.value).length?$("#form-marker-wrap").fadeOut(200):$("#form-marker-wrap").fadeIn(200)}),$("#pulse-container").on("click touch",function(e){e.stopPropagation(),$("#form-hint").toggle(200)}),$(".container").on("click touch",function(e){$("#form-hint").fadeOut(200)}),$(".graph-carousel").owlCarousel({loop:!0,margin:0,responsiveClass:!0,rewind:!0,slideBy:3,autoplay:!0,autoplayTimeout:3e3,autoplayHoverPause:!0,dots:!1,navText:["",""],responsive:{0:{items:3,nav:!0},400:{items:4,nav:!0},550:{items:5,nav:!0},750:{items:8,nav:!0},1e3:{items:13,nav:!0,loop:!1,margin:20}}}),$(".reviews-carousel").owlCarousel({loop:!1,margin:0,responsiveClass:!0,rewind:!0,slideBy:1,autoplay:!1,autoplayTimeout:3e3,autoplayHoverPause:!0,dots:!1,navText:["",tt("More Testimonials")],mouseDrag:!1,smartSpeed:150,responsive:{0:{items:1,nav:!0},550:{items:2,nav:!0},1e3:{items:3,nav:!0,loop:!0,margin:20}}})}),function(I,g){"use strict";function i(a){var b,d={},a=a.split(",");for(b=0;b<a.length;b++)d[a[b]]=!0;return d}function z(a,d){function b(a,b,c,h){if(b=g.lowercase(b),m[b])for(;f.last()&&n[f.last()];)e("",f.last());o[b]&&f.last()==b&&e("",b),(h=p[b]||!!h)||f.push(b);var j={};c.replace(A,function(a,b,d,e,c){j[b]=k(d||e||c||"")}),d.start&&d.start(b,j,h)}function e(a,b){var c,e=0;if(b=g.lowercase(b))for(e=f.length-1;e>=0&&f[e]!=b;e--);if(e>=0){for(c=f.length-1;c>=e;c--)d.end&&d.end(f[c]);f.length=e}}var c,h,f=[],j=a;for(f.last=function(){return f[f.length-1]};a;){if(h=!0,f.last()&&q[f.last()]?(a=a.replace(RegExp("(.*)<\\s*\\/\\s*"+f.last()+"[^>]*>","i"),function(b,a){return a=a.replace(D,"$1").replace(E,"$1"),d.chars&&d.chars(k(a)),""}),e("",f.last())):(0===a.indexOf("\x3c!--")?(c=a.indexOf("--\x3e"))>=0&&(d.comment&&d.comment(a.substring(4,c)),a=a.substring(c+3),h=!1):B.test(a)?(c=a.match(r))&&(a=a.substring(c[0].length),c[0].replace(r,e),h=!1):C.test(a)&&(c=a.match(s))&&(a=a.substring(c[0].length),c[0].replace(s,b),h=!1),h&&(c=a.indexOf("<"),h=c<0?a:a.substring(0,c),a=c<0?"":a.substring(c),d.chars&&d.chars(k(h)))),a==j)throw"Parse Error: "+a;j=a}e()}function k(a){return l.innerHTML=a.replace(/</g,"&lt;"),l.innerText||l.textContent||""}function t(a){return a.replace(/&/g,"&amp;").replace(F,function(a){return"&#"+a.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function u(a){var d=!1,b=g.bind(a,a.push);return{start:function(a,c,h){a=g.lowercase(a),!d&&q[a]&&(d=a),!d&&1==v[a]&&(b("<"),b(a),g.forEach(c,function(a,c){var e=g.lowercase(c);1!=G[e]||!0===w[e]&&!a.match(H)||(b(" "),b(c),b('="'),b(t(a)),b('"'))}),b(h?"/>":">"))},end:function(a){a=g.lowercase(a),!d&&1==v[a]&&(b("</"),b(a),b(">")),a==d&&(d=!1)},chars:function(a){d||b(t(a))}}}var s=/^<\s*([\w:-]+)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*>/,r=/^<\s*\/\s*([\w:-]+)[^>]*>/,A=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,C=/^</,B=/^<\s*\//,D=/<\!--(.*?)--\>/g,E=/<!\[CDATA\[(.*?)]]\>/g,H=/^((ftp|https?):\/\/|mailto:|#)/,F=/([^\#-~| |!])/g,p=i("area,br,col,hr,img,wbr"),x=i("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),y=i("rp,rt"),o=g.extend({},y,x),m=g.extend({},x,i("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),n=g.extend({},y,i("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),q=i("script,style"),v=g.extend({},p,m,n,o),w=i("background,cite,href,longdesc,src,usemap"),G=g.extend({},w,i("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,span,start,summary,target,title,type,valign,value,vspace,width")),l=document.createElement("pre");g.module("ngSanitize",[]).value("$sanitize",function(a){var d=[];return z(a,u(d)),d.join("")}),g.module("ngSanitize").directive("ngBindHtml",["$sanitize",function(a){return function(d,b,e){b.addClass("ng-binding").data("$binding",e.ngBindHtml),d.$watch(e.ngBindHtml,function(c){c=a(c),b.html(c||"")})}}]),g.module("ngSanitize").filter("linky",function(){var a=/((ftp|https?):\/\/|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s\.\;\,\(\)\{\}\<\>]/,d=/^mailto:/;return function(b){if(!b)return b;for(var f,g,e=b,c=[],h=u(c);b=e.match(a);)f=b[0],b[2]==b[3]&&(f="mailto:"+f),g=b.index,h.chars(e.substr(0,g)),h.start("a",{href:f}),h.chars(b[0].replace(d,"")),h.end("a"),e=e.substring(g+b[0].length);return h.chars(e),c.join("")}})}(window,window.angular),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.Centrifuge=e()}}(function(){var e;return function t(e,n,i){function s(o,c){if(!n[o]){if(!e[o]){var a="function"==typeof require&&require;if(!c&&a)return a(o,!0);if(r)return r(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var h=n[o]={exports:{}};e[o][0].call(h.exports,function(t){var n=e[o][1][t];return s(n||t)},h,h.exports,t,e,n,i)}return n[o].exports}for(var r="function"==typeof require&&require,o=0;o<i.length;o++)s(i[o]);return s}({1:[function(e,t){function n(){}var i=t.exports={};i.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.MutationObserver,n="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};var i=[];if(t){var s=document.createElement("div");return new MutationObserver(function(){var e=i.slice();i.length=0,e.forEach(function(e){e()})}).observe(s,{attributes:!0}),function(e){i.length||s.setAttribute("yes","no"),i.push(e)}}return n?(window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),i.length>0)){i.shift()()}},!0),function(e){i.push(e),window.postMessage("process-tick","*")}):function(e){setTimeout(e,0)}}(),i.title="browser",i.browser=!0,i.env={},i.argv=[],i.on=n,i.addListener=n,i.once=n,i.off=n,i.removeListener=n,i.removeAllListeners=n,i.emit=n,i.binding=function(){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(){throw new Error("process.chdir is not supported")}},{}],2:[function(t,n,i){(function(s,r){!function(t,s){"object"==typeof i&&void 0!==n?n.exports=s():"function"==typeof e&&e.amd?e(s):t.ES6Promise=s()}(this,function(){"use strict";function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function n(e){return"function"==typeof e}function i(e){Y=e}function o(e){$=e}function a(){return void 0!==K?function(){K(l)}:f()}function f(){var e=setTimeout;return function(){return e(l,1)}}function l(){for(var e=0;V>e;e+=2){(0,ne[e])(ne[e+1]),ne[e]=void 0,ne[e+1]=void 0}V=0}function d(e,t){var n=arguments,i=this,s=new this.constructor(p);void 0===s[se]&&P(s);var r=i._state;return r?function(){var e=n[r-1];$(function(){return A(r,s,e,i._result)})}():C(i,s,e,t),s}function g(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(p);return j(n,e),n}function p(){}function b(){return new TypeError("You cannot resolve a promise with itself")}function v(){return new TypeError("A promises callback cannot return that same promise.")}function m(e){try{return e.then}catch(t){return ae.error=t,ae}}function y(e,t,n,i){try{e.call(t,n,i)}catch(s){return s}}function w(e,t,n){$(function(e){var i=!1,s=y(n,t,function(n){i||(i=!0,t!==n?j(e,n):O(e,n))},function(t){i||(i=!0,x(e,t))},"Settle: "+(e._label||" unknown promise"));!i&&s&&(i=!0,x(e,s))},e)}function S(e,t){t._state===oe?O(e,t._result):t._state===ce?x(e,t._result):C(t,void 0,function(t){return j(e,t)},function(t){return x(e,t)})}function k(e,t,i){t.constructor===e.constructor&&i===d&&t.constructor.resolve===g?S(e,t):i===ae?x(e,ae.error):void 0===i?O(e,t):n(i)?w(e,t,i):O(e,t)}function j(t,n){t===n?x(t,b()):e(n)?k(t,n,m(n)):O(t,n)}function E(e){e._onerror&&e._onerror(e._result),R(e)}function O(e,t){e._state===re&&(e._result=t,e._state=oe,0!==e._subscribers.length&&$(R,e))}function x(e,t){e._state===re&&(e._state=ce,e._result=t,$(E,e))}function C(e,t,n,i){var s=e._subscribers,r=s.length;e._onerror=null,s[r]=t,s[r+oe]=n,s[r+ce]=i,0===r&&e._state&&$(R,e)}function R(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var i=void 0,s=void 0,r=e._result,o=0;o<t.length;o+=3)i=t[o],s=t[o+n],i?A(n,i,s,r):s(r);e._subscribers.length=0}}function T(){this.error=null}function M(e,t){try{return e(t)}catch(n){return ue.error=n,ue}}function A(e,t,i,s){var r=n(i),o=void 0,c=void 0,a=void 0,u=void 0;if(r){if(o=M(i,s),o===ue?(u=!0,c=o.error,o=null):a=!0,t===o)return void x(t,v())}else o=s,a=!0;t._state!==re||(r&&a?j(t,o):u?x(t,c):e===oe?O(t,o):e===ce&&x(t,o))}function I(e,t){try{t(function(t){j(e,t)},function(t){x(e,t)})}catch(n){x(e,n)}}function L(){return he++}function P(e){e[se]=he++,e._state=void 0,e._result=void 0,e._subscribers=[]}function J(e,t){this._instanceConstructor=e,this.promise=new e(p),this.promise[se]||P(this.promise),z(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),
0===this.length?O(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&O(this.promise,this._result))):x(this.promise,D())}function D(){return new Error("Array Methods must be provided an Array")}function q(e){return new J(this,e).promise}function U(e){var t=this;return new t(z(e)?function(n,i){for(var s=e.length,r=0;s>r;r++)t.resolve(e[r]).then(n,i)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function B(e){var t=this,n=new t(p);return x(n,e),n}function N(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function F(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function H(e){this[se]=L(),this._result=this._state=void 0,this._subscribers=[],p!==e&&("function"!=typeof e&&N(),this instanceof H?I(this,e):F())}function W(){var e=void 0;if(void 0!==r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=e.Promise;if(n){var i=null;try{i=Object.prototype.toString.call(n.resolve())}catch(t){}if("[object Promise]"===i&&!n.cast)return}e.Promise=H}var X=void 0;X=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var z=X,V=0,K=void 0,Y=void 0,$=function(e,t){ne[V]=e,ne[V+1]=t,2===(V+=2)&&(Y?Y(l):ie())},G="undefined"!=typeof window?window:void 0,Q=G||{},Z=Q.MutationObserver||Q.WebKitMutationObserver,ee="undefined"==typeof self&&void 0!==s&&"[object process]"==={}.toString.call(s),te="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ne=new Array(1e3),ie=void 0;ie=ee?function(){return function(){return s.nextTick(l)}}():Z?function(){var e=0,t=new Z(l),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}():te?function(){var e=new MessageChannel;return e.port1.onmessage=l,function(){return e.port2.postMessage(0)}}():void 0===G&&"function"==typeof t?function(){try{var e=t,n=e("vertx");return K=n.runOnLoop||n.runOnContext,a()}catch(i){return f()}}():f();var se=Math.random().toString(36).substring(16),re=void 0,oe=1,ce=2,ae=new T,ue=new T,he=0;return J.prototype._enumerate=function(){for(var e=this.length,t=this._input,n=0;this._state===re&&e>n;n++)this._eachEntry(t[n],n)},J.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,i=n.resolve;if(i===g){var s=m(e);if(s===d&&e._state!==re)this._settledAt(e._state,t,e._result);else if("function"!=typeof s)this._remaining--,this._result[t]=e;else if(n===H){var r=new n(p);k(r,e,s),this._willSettleAt(r,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(i(e),t)},J.prototype._settledAt=function(e,t,n){var i=this.promise;i._state===re&&(this._remaining--,e===ce?x(i,n):this._result[t]=n),0===this._remaining&&O(i,this._result)},J.prototype._willSettleAt=function(e,t){var n=this;C(e,void 0,function(e){return n._settledAt(oe,t,e)},function(e){return n._settledAt(ce,t,e)})},H.all=q,H.race=U,H.resolve=g,H.reject=B,H._setScheduler=i,H._setAsap=o,H._asap=$,H.prototype={constructor:H,then:d,catch:function(e){return this.then(null,e)}},H.polyfill=W,H.Promise=H,H})}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:1}],3:[function(t,n){(function(){"use strict";function t(){}function i(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function s(e){return function(){return this[e].apply(this,arguments)}}var r=t.prototype,o=this,c=o.EventEmitter;r.getListeners=function(e){var t,n,i=this._getEvents();if(e instanceof RegExp){t={};for(n in i)i.hasOwnProperty(n)&&e.test(n)&&(t[n]=i[n])}else t=i[e]||(i[e]=[]);return t},r.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},r.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},r.addListener=function(e,t){var n,s=this.getListenersAsObject(e),r="object"==typeof t;for(n in s)s.hasOwnProperty(n)&&-1===i(s[n],t)&&s[n].push(r?t:{listener:t,once:!1});return this},r.on=s("addListener"),r.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},r.once=s("addOnceListener"),r.defineEvent=function(e){return this.getListeners(e),this},r.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},r.removeListener=function(e,t){var n,s,r=this.getListenersAsObject(e);for(s in r)r.hasOwnProperty(s)&&-1!==(n=i(r[s],t))&&r[s].splice(n,1);return this},r.off=s("removeListener"),r.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},r.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},r.manipulateListeners=function(e,t,n){var i,s,r=e?this.removeListener:this.addListener,o=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(i=n.length;i--;)r.call(this,t,n[i]);else for(i in t)t.hasOwnProperty(i)&&(s=t[i])&&("function"==typeof s?r.call(this,i,s):o.call(this,i,s));return this},r.removeEvent=function(e){var t,n=typeof e,i=this._getEvents();if("string"===n)delete i[e];else if(e instanceof RegExp)for(t in i)i.hasOwnProperty(t)&&e.test(t)&&delete i[t];else delete this._events;return this},r.removeAllListeners=s("removeEvent"),r.emitEvent=function(e,t){var n,i,s,r,c=this.getListenersAsObject(e);for(r in c)if(c.hasOwnProperty(r))for(n=c[r].slice(0),s=n.length;s--;)i=n[s],!0===i.once&&this.removeListener(e,i.listener),i.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,i.listener);return this},r.trigger=s("emitEvent"),r.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},r.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},r._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},r._getEvents=function(){return this._events||(this._events={})},t.noConflict=function(){return o.EventEmitter=c,t},"function"==typeof e&&e.amd?e(function(){return t}):"object"==typeof n&&n.exports?n.exports=t:o.EventEmitter=t}).call(this)},{}],4:[function(e,t){(function(n){function i(e,t){return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,t.prototype}function s(e,t){try{return e[t]}catch(n){return}}function r(e,t){for(var n=t||{},i=2;i<arguments.length;++i){var o=arguments[i];if(void 0!==o&&null!==o)for(var c in o){var a=s(o,c),u=s(n,c);if(a!==t&&void 0!==a)if(e&&"object"==typeof a&&null!==a)if(a instanceof Array)n[c]=r(e,u instanceof Array?u:[],a);else{var h="object"!=typeof u||u instanceof Array?{}:u;n[c]=r(e,h,a)}else n[c]=a}}return n}function o(e,t){return-1!==e.indexOf(t,e.length-t.length)}function c(e,t){return 0===e.lastIndexOf(t,0)}function a(e){return"/"==e.substring(e.length-1)&&(e=e.substring(0,e.length-1)),e}function u(e){return void 0!==e&&null!==e&&("string"==typeof e||e instanceof String)}function h(e){return void 0!==e&&null!==e&&"function"==typeof e}function f(e,t){if(n.console){var i=n.console[e];h(i)&&i.apply(n.console,t)}}function l(e,t,n){var i=.5*Math.random(),s=t*Math.pow(2,e+1);return s>n&&(s=n),Math.floor((1-i)*s)}function _(e){return"error"in e&&null!==e.error&&""!==e.error}function d(e){this._sockJS=null,this._isSockJS=!1,this._status="disconnected",this._reconnect=!0,this._reconnecting=!1,this._transport=null,this._transportName=null,this._transportClosed=!0,this._messageId=0,this._clientID=null,this._subs={},this._lastMessageID={},this._messages=[],this._isBatching=!1,this._isAuthBatching=!1,this._authChannels={},this._numRefreshFailed=0,this._refreshTimeout=null,this._pingInterval=null,this._pongTimeout=null,this._retries=0,this._callbacks={},this._latency=null,this._latencyStart=null,this._config={sockJS:null,retry:1e3,maxRetry:2e4,timeout:5e3,info:"",resubscribe:!0,ping:!0,pingInterval:3e4,pongWaitTimeout:5e3,debug:!1,insecure:!1,server:null,privateChannelPrefix:"$",transports:["websocket","xdr-streaming","xhr-streaming","eventsource","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"],refreshEndpoint:"/centrifuge/refresh/",refreshHeaders:{},refreshParams:{},refreshData:{},refreshTransport:"ajax",refreshAttempts:null,refreshFailed:null,authEndpoint:"/centrifuge/auth/",authHeaders:{},authParams:{},authTransport:"ajax"},e&&this.configure(e)}function g(e,t,n){this._status=m,this._error=null,this._centrifuge=e,this.channel=t,this._setEvents(n),this._isResubscribe=!1,this._recovered=!1,this._ready=!1,this._promise=null,this._initializePromise()}var p=e("es6-promise").Promise,b=e("wolfy87-eventemitter");Object.create||(Object.create=function(){function e(){}return function(t){if(1!=arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return e.prototype=t,new e}}()),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null==this)throw new TypeError;var t,n,i=Object(this),s=i.length>>>0;if(0===s)return-1;if(t=0,arguments.length>1&&(t=Number(arguments[1]),t!=t?t=0:0!=t&&1/0!=t&&t!=-1/0&&(t=(t>0||-1)*Math.floor(Math.abs(t)))),t>=s)return-1;for(n=t>=0?t:Math.max(s-Math.abs(t),0);s>n;n++)if(n in i&&i[n]===e)return n;return-1}),i(d,b),d._authCallbacks={},d._nextAuthCallbackID=1;var v=d.prototype;v._jsonp=function(e,t,i,s,r){i.length>0&&this._log("Only AJAX request allows to send custom headers, it's not possible with JSONP."),self._debug("sending JSONP request to",e);var o=d._nextAuthCallbackID.toString();d._nextAuthCallbackID++;var c=n.document,a=c.createElement("script");d._authCallbacks[o]=function(e){r(!1,e),delete d[o]};var u="";for(var h in t)u.length>0&&(u+="&"),u+=encodeURIComponent(h)+"="+encodeURIComponent(t[h]);var f="Centrifuge._authCallbacks['"+o+"']";a.src=this._config.authEndpoint+"?callback="+encodeURIComponent(f)+"&data="+encodeURIComponent(JSON.stringify(s))+"&"+u;var l=c.getElementsByTagName("head")[0]||c.documentElement;l.insertBefore(a,l.firstChild)},v._ajax=function(e,t,i,s,r){var o=this;o._debug("sending AJAX request to",e);var c=n.XMLHttpRequest?new n.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),a="";for(var u in t)a.length>0&&(a+="&"),a+=encodeURIComponent(u)+"="+encodeURIComponent(t[u]);a.length>0&&(a="?"+a),c.open("POST",e+a,!0),c.setRequestHeader("X-Requested-With","XMLHttpRequest"),c.setRequestHeader("Content-Type","application/json");for(var h in i)c.setRequestHeader(h,i[h]);return c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status){var e,t=!1;try{e=JSON.parse(c.responseText),t=!0}catch(n){r(!0,"JSON returned was invalid, yet status code was 200. Data was: "+c.responseText)}t&&r(!1,e)}else o._log("Couldn't get auth info from application",c.status),r(!0,c.status)},setTimeout(function(){c.send(JSON.stringify(s))},20),c},v._log=function(){f("info",arguments)},v._debug=function(){!0===this._config.debug&&f("debug",arguments)},v._websocketSupported=function(){return!("function"!=typeof WebSocket&&"object"!=typeof WebSocket)},v._sockjsEndpoint=function(){var e=this._config.url;return e=e.replace("ws://","http://"),e=e.replace("wss://","https://"),e=a(e),o(this._config.url,"connection")||(e+="/connection"),e},v._rawWebsocketEndpoint=function(){var e=this._config.url;return e=e.replace("http://","ws://"),e=e.replace("https://","wss://"),e=a(e),o(this._config.url,"connection/websocket")||(e+="/connection/websocket"),e},v._configure=function(e){if(this._debug("Configuring centrifuge object with",e),e||(e={}),this._config=r(!1,this._config,e),!this._config.url)throw"Missing required configuration parameter 'url' specifying server URL";if(!this._config.user&&""!==this._config.user){if(!this._config.insecure)throw"Missing required configuration parameter 'user' specifying user's unique ID in your application";this._debug("user not found but this is OK for insecure mode - anonymous access will be used"),this._config.user=""}if(!this._config.timestamp){if(!this._config.insecure)throw"Missing required configuration parameter 'timestamp'";this._debug("token not found but this is OK for insecure mode")}if(!this._config.token){if(!this._config.insecure)throw"Missing required configuration parameter 'token' specifying the sign of authorization request";this._debug("timestamp not found but this is OK for insecure mode")}if(this._config.url=a(this._config.url),o(this._config.url,"connection"))if(this._debug("client will connect to SockJS endpoint"),null!==this._config.sockJS)this._debug("SockJS explicitly provided in options"),this._sockJS=this._config.sockJS;else{if("undefined"==typeof SockJS)throw"include SockJS client library before Centrifuge javascript client library or provide SockJS object in options or use raw Websocket connection endpoint";this._debug("use globally defined SockJS"),this._sockJS=SockJS}else o(this._config.url,"connection/websocket")?this._debug("client will connect to raw Websocket endpoint"):(this._debug("client will detect connection endpoint itself"),null!==this._config.sockJS?(this._debug("SockJS explicitly provided in options"),this._sockJS=this._config.sockJS):"undefined"==typeof SockJS?this._debug("SockJS not found"):(this._debug("use globally defined SockJS"),this._sockJS=SockJS))},v._setStatus=function(e){this._status!==e&&(this._debug("Status",this._status,"->",e),this._status=e)},v._isDisconnected=function(){return"disconnected"===this._status},v._isConnecting=function(){return"connecting"===this._status},v._isConnected=function(){return"connected"===this._status},v._nextMessageId=function(){return++this._messageId},v._resetRetry=function(){this._debug("reset retries count to 0"),this._retries=0},v._getRetryInterval=function(){var e=l(this._retries,this._config.retry,this._config.maxRetry);return this._retries+=1,e},v._clearConnectedState=function(e){this._clientID=null;for(var t in this._callbacks){var n=this._callbacks[t],i=n.errback;i&&i(this._createErrorObject("disconnected","retry"))}this._callbacks={};for(var s in this._subs){var r=this._subs[s];e?(r._isSuccess()&&r._triggerUnsubscribe(),r._setSubscribing()):r._setUnsubscribed()}this._config.resubscribe&&this._reconnect||(this._subs={})},v._send=function(e){0!==e.length&&(1==e.length&&(e=e[0]),this._debug("Send",e),this._transport.send(JSON.stringify(e)))},v._setupTransport=function(){var e=this;if(this._isSockJS=!1,null!==this._sockJS){var t={transports:this._config.transports};null!==this._config.server&&(t.server=this._config.server),this._isSockJS=!0,this._transport=new this._sockJS(this._sockjsEndpoint(),null,t)}else{if(!this._websocketSupported())return void this._debug("No Websocket support and no SockJS configured, can't connect");this._transport=new WebSocket(this._rawWebsocketEndpoint())}this._transport.onopen=function(){e._transportClosed=!1,e._reconnecting=!1,e._isSockJS?(e._transportName=e._transport.transport,e._transport.onheartbeat=function(){e._restartPing()}):e._transportName="raw-websocket",e._resetRetry(),u(e._config.user)||e._log("user expected to be string"),u(e._config.info)||e._log("info expected to be string");var t={method:"connect",params:{user:e._config.user,info:e._config.info}};e._config.insecure||(t.params.timestamp=e._config.timestamp,t.params.token=e._config.token,u(e._config.timestamp)||e._log("timestamp expected to be string"),u(e._config.token)||e._log("token expected to be string")),e._addMessage(t),e._latencyStart=new Date},this._transport.onerror=function(t){e._debug("transport level error",t)},this._transport.onclose=function(t){e._transportClosed=!0;var n="connection closed",i=!0;if(t&&"reason"in t&&t.reason)try{var s=JSON.parse(t.reason);e._debug("reason is an advice object",s),n=s.reason,i=s.reconnect}catch(r){n=t.reason,e._debug("reason is a plain string",n),i="disconnect"!==n}if(e._disconnect(n,i),!0===e._reconnect){e._reconnecting=!0;var o=e._getRetryInterval();e._debug("reconnect after "+o+" milliseconds"),setTimeout(function(){!0===e._reconnect&&e._connect.call(e)},o)}},this._transport.onmessage=function(t){var n;n=JSON.parse(t.data),e._debug("Received",n),e._receive(n),e._restartPing()}},v._connect=function(e){if(this.isConnected())return void this._debug("connect called when already connected");if("connecting"!=this._status){if(this._numRefreshFailed>0)return void this._debug("can't connect when credentials expired, need to refresh");this._debug("start connecting"),this._setStatus("connecting"),this._clientID=null,this._reconnect=!0,e&&this.on("connect",e),this._setupTransport()}},v._disconnect=function(e,t){if(!this.isDisconnected()){this._debug("disconnected:",e,t);var n=t||!1;if(!1===n&&(this._reconnect=!1),this._clearConnectedState(t),!this.isDisconnected()){this._setStatus("disconnected");var i={reason:e,reconnect:n};this._refreshTimeout&&clearTimeout(this._refreshTimeout),!1===this._reconnecting&&this.trigger("disconnect",[i])}this._transportClosed||this._transport.close()}},v._refreshFailed=function(){this.isDisconnected()||this._disconnect("refresh failed",!1),null!==this._config.refreshFailed&&this._config.refreshFailed()},v._refresh=function(){var e=this;if(this._debug("refresh credentials"),0===e._config.refreshAttempts)return this._debug("refresh attempts set to 0, do not send refresh request at all"),void e._refreshFailed();var t=function(t,n){if(!0===t)return e._debug("error getting connect parameters",n),e._numRefreshFailed++,e._refreshTimeout&&clearTimeout(e._refreshTimeout),null!==e._config.refreshAttempts&&e._numRefreshFailed>=e._config.refreshAttempts?void e._refreshFailed():void(e._refreshTimeout=setTimeout(function(){e._refresh.call(e)},3e3+Math.round(1e3*Math.random())));if(e._numRefreshFailed=0,e._config.user=n.user,e._config.timestamp=n.timestamp,"info"in n&&(e._config.info=n.info),e._config.token=n.token,e.isDisconnected())e._debug("credentials refreshed, connect from scratch"),e._connect();else{e._debug("send refreshed credentials");var i={method:"refresh",params:{user:e._config.user,timestamp:e._config.timestamp,info:e._config.info,token:e._config.token}};e._addMessage(i)}},n=this._config.refreshTransport.toLowerCase();if("ajax"===n)this._ajax(this._config.refreshEndpoint,this._config.refreshParams,this._config.refreshHeaders,this._config.refreshData,t);else{if("jsonp"!==n)throw"Unknown refresh transport "+n;this._jsonp(this._config.refreshEndpoint,this._config.refreshParams,this._config.refreshHeaders,this._config.refreshData,t)}},v._subscribe=function(e){var t=e.channel;if(t in this._subs||(this._subs[t]=e),!this.isConnected())return void e._setNew();e._setSubscribing();var n={method:"subscribe",params:{channel:t}};if(c(t,this._config.privateChannelPrefix))this._isAuthBatching?this._authChannels[t]=!0:(this.startAuthBatching(),this._subscribe(e),this.stopAuthBatching());else{!0===this._recover(t)&&(n.params.recover=!0,n.params.last=this._getLastID(t)),this._addMessage(n)}},v._unsubscribe=function(e){if(this.isConnected()){var t={method:"unsubscribe",params:{channel:e.channel}};this._addMessage(t)}},v._getSub=function(e){var t=this._subs[e];return t||null},v._connectResponse=function(e){if(!this.isConnected())if(_(e))this.trigger("error",[{message:e}]);else{if(null!==this._latencyStart&&(this._latency=(new Date).getTime()-this._latencyStart.getTime(),this._latencyStart=null),!e.body)return;if(e.body.expires){var t=e.body.expired;if(t)return void this._refresh()}this._clientID=e.body.client,this._setStatus("connected"),this._refreshTimeout&&clearTimeout(this._refreshTimeout);var n=this;if(e.body.expires&&(this._refreshTimeout=setTimeout(function(){n._refresh.call(n)},1e3*e.body.ttl)),this._config.resubscribe){this.startBatching(),this.startAuthBatching();for(var i in this._subs){var s=this._subs[i];this._subscribe(s)}this.stopAuthBatching(),this.stopBatching(!0)}var r={client:e.body.client,transport:this._transportName,latency:this._latency};this._restartPing(),this.trigger("connect",[r])}},v._stopPing=function(){null!==this._pongTimeout&&clearTimeout(this._pongTimeout),null!==this._pingInterval&&clearInterval(this._pingInterval)},v._startPing=function(){if(!(!0!==this._config.ping||this._config.pingInterval<=0)&&this.isConnected()){var e=this;this._pingInterval=setInterval(function(){return e.isConnected()?(e.ping(),void(e._pongTimeout=setTimeout(function(){e._disconnect("no ping",!0)},e._config.pongWaitTimeout))):void e._stopPing()},this._config.pingInterval)}},v._restartPing=function(){this._stopPing(),this._startPing()},v._disconnectResponse=function(e){if(_(e))this.trigger("error",[{message:e}]);else{var t=!1;"reconnect"in e.body&&(t=e.body.reconnect);var n="";"reason"in e.body&&(n=e.body.reason),this._disconnect(n,t)}},v._subscribeResponse=function(e){var t=e.body;if(null!==t){var n=t.channel,i=this._getSub(n);if(i&&i._isSubscribing())if(_(e))this.trigger("error",[{message:e}]),i._setSubscribeError(this._errorObjectFromMessage(e));else{var s=t.messages;if(s&&s.length>0)for(var r in s.reverse())this._messageResponse({body:s[r]});else"last"in t&&(this._lastMessageID[n]=t.last);var o=!1;"recovered"in t&&(o=t.recovered),i._setSubscribeSuccess(o)}}},v._unsubscribeResponse=function(e){var t=e.uid,n=e.body,i=n.channel,s=this._getSub(i);s&&(_(e)?this.trigger("error",[{message:e}]):t||s._setUnsubscribed())},v._publishResponse=function(e){var t=e.uid,n=e.body;if(t in this._callbacks){var i=this._callbacks[t];if(delete this._callbacks[t],_(e)){var s=i.errback;if(!s)return;s(this._errorObjectFromMessage(e)),this.trigger("error",[{message:e}])}else{var r=i.callback;if(!r)return;r(n)}}},v._presenceResponse=function(e){var t=e.uid,n=e.body;if(t in this._callbacks){var i=this._callbacks[t];if(delete this._callbacks[t],_(e)){var s=i.errback;if(!s)return;s(this._errorObjectFromMessage(e)),this.trigger("error",[{message:e}])}else{var r=i.callback;if(!r)return;r(n)}}},v._historyResponse=function(e){var t=e.uid,n=e.body;if(t in this._callbacks){var i=this._callbacks[t];if(delete this._callbacks[t],_(e)){var s=i.errback;if(!s)return;s(this._errorObjectFromMessage(e)),this.trigger("error",[{message:e}])}else{var r=i.callback;if(!r)return;r(n)}}},v._joinResponse=function(e){var t=e.body,n=t.channel,i=this._getSub(n);i&&i.trigger("join",[t])},v._leaveResponse=function(e){var t=e.body,n=t.channel,i=this._getSub(n);i&&i.trigger("leave",[t])},v._messageResponse=function(e){var t=e.body,n=t.channel;this._lastMessageID[n]=t.uid;var i=this._getSub(n);i&&i.trigger("message",[t])},v._refreshResponse=function(e){if(this._refreshTimeout&&clearTimeout(this._refreshTimeout),_(e))this.trigger("error",[{message:e}]);else if(e.body.expires){var t=this,n=e.body.expired;if(n)return void(t._refreshTimeout=setTimeout(function(){t._refresh.call(t)},3e3+Math.round(1e3*Math.random())));this._clientID=e.body.client,t._refreshTimeout=setTimeout(function(){t._refresh.call(t)},1e3*e.body.ttl)}},v._dispatchMessage=function(e){if(void 0===e||null===e)return void this._debug("dispatch: got undefined or null message");var t=e.method;if(!t)return void this._debug("dispatch: got message with empty method");switch(t){case"connect":this._connectResponse(e);break;case"disconnect":this._disconnectResponse(e);break;case"subscribe":this._subscribeResponse(e);break;case"unsubscribe":this._unsubscribeResponse(e);break;case"publish":this._publishResponse(e);break;case"presence":this._presenceResponse(e);break;case"history":this._historyResponse(e);break;case"join":this._joinResponse(e);break;case"leave":this._leaveResponse(e);break;case"ping":break;case"refresh":this._refreshResponse(e);break;case"message":this._messageResponse(e);break;default:this._debug("dispatch: got message with unknown method"+t)}},v._receive=function(e){if(Object.prototype.toString.call(e)===Object.prototype.toString.call([])){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];this._dispatchMessage(n)}}else Object.prototype.toString.call(e)===Object.prototype.toString.call({})&&this._dispatchMessage(e)},v._flush=function(){var e=this._messages.slice(0);this._messages=[],this._send(e)},v._ping=function(){var e={method:"ping"};this._addMessage(e)},v._recover=function(e){return e in this._lastMessageID},v._getLastID=function(e){var t=this._lastMessageID[e];return t?(this._debug("last uid found and sent for channel",e),t):(this._debug("no last uid found for channel",e),"")},v._createErrorObject=function(e,t){var n={error:e};return t&&(n.advice=t),n},v._errorObjectFromMessage=function(e){var t=e.error,n=e.advice;return this._createErrorObject(t,n)},v._registerCall=function(e,t,n){var i=this;this._callbacks[e]={callback:t,errback:n},setTimeout(function(){delete i._callbacks[e],h(n)&&n(i._createErrorObject("timeout","retry"))},this._config.timeout)},v._addMessage=function(e){var t=""+this._nextMessageId();return e.uid=t,!0===this._isBatching?this._messages.push(e):this._send([e]),t},v.getClientId=function(){return this._clientID},v.isConnected=v._isConnected,v.isDisconnected=v._isDisconnected,v.configure=function(e){this._configure.call(this,e)},v.connect=v._connect,v.disconnect=function(){this._disconnect("client",!1)},v.ping=v._ping,v.startBatching=function(){this._isBatching=!0},v.stopBatching=function(e){e=e||!1,this._isBatching=!1,!0===e&&this.flush()},v.flush=function(){this._flush()},v.startAuthBatching=function(){this._isAuthBatching=!0},v.stopAuthBatching=function(){this._isAuthBatching=!1;var e=this._authChannels;this._authChannels={};var t=[];for(var n in e){this._getSub(n)&&t.push(n)}if(0!=t.length){var s={client:this.getClientId(),channels:t},r=this,o=function(e,n){if(!0!==e){var i=!1;r._isBatching||(r.startBatching(),i=!0);for(var s in t){var o=t[s],c=n[o];if(c)if(c.status&&200!==c.status)r._subscribeResponse({error:c.status,body:{channel:o}});else{var a={method:"subscribe",params:{channel:o,client:r.getClientId(),info:c.info,sign:c.sign}},u=r._recover(o);!0===u&&(a.params.recover=!0,a.params.last=r._getLastID(o)),r._addMessage(a)}else r._subscribeResponse({error:"channel not found in authorization response",advice:"fix",body:{channel:o}})}i&&r.stopBatching(!0)}else{r._debug("authorization request failed");for(var s in t){var o=t[s];r._subscribeResponse({error:"authorization request failed",advice:"fix",body:{channel:o}})}}},c=this._config.authTransport.toLowerCase();if("ajax"===c)this._ajax(this._config.authEndpoint,this._config.authParams,this._config.authHeaders,s,o);else{if("jsonp"!==c)throw"Unknown auth transport "+c;this._jsonp(this._config.authEndpoint,this._config.authParams,this._config.authHeaders,s,o)}}},v.subscribe=function(e,t){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!u(e))throw"Illegal argument type: channel must be a string";if(!this._config.resubscribe&&!this.isConnected())throw"Can not only subscribe in connected state when resubscribe option is off";var n=this._getSub(e);if(null!==n)return n._setEvents(t),n._isUnsubscribed()&&n.subscribe(),n;var i=new g(this,e,t);return this._subs[e]=i,i.subscribe(),i};var m=0;i(g,b);var j=g.prototype;j._initializePromise=function(){this._ready=!1;var e=this;this._promise=new p(function(t,n){e._resolve=function(n){e._ready=!0,t(n)},e._reject=function(t){e._ready=!0,n(t)}})},j._setEvents=function(e){if(e)if(h(e))this.on("message",e);else if(Object.prototype.toString.call(e)===Object.prototype.toString.call({})){var t=["message","join","leave","unsubscribe","subscribe","error"];for(var n in t){var i=t[n];i in e&&this.on(i,e[i])}}},j._isNew=function(){return this._status===m},j._isUnsubscribed=function(){return 4===this._status},j._isSubscribing=function(){return 1===this._status},j._isReady=function(){return 2===this._status||3===this._status},j._isSuccess=function(){return 2===this._status},j._isError=function(){return 3===this._status},j._setNew=function(){this._status=m},j._setSubscribing=function(){!0===this._ready&&(this._initializePromise(),this._isResubscribe=!0),this._status=1},j._setSubscribeSuccess=function(e){if(2!=this._status){this._recovered=e,this._status=2;var t=this._getSubscribeSuccessContext(e);this.trigger("subscribe",[t]),this._resolve(t)}},j._setSubscribeError=function(e){if(3!=this._status){this._status=3,this._error=e;var t=this._getSubscribeErrorContext();this.trigger("error",[t]),this._reject(t)}},j._triggerUnsubscribe=function(){var e={channel:this.channel};this.trigger("unsubscribe",[e])},j._setUnsubscribed=function(){4!=this._status&&(this._status=4,this._triggerUnsubscribe())},j._getSubscribeSuccessContext=function(){return{channel:this.channel,isResubscribe:this._isResubscribe,recovered:this._recovered}},j._getSubscribeErrorContext=function(){var e=this._error;return e.channel=this.channel,e.isResubscribe=this._isResubscribe,e},j.ready=function(e,t){this._ready&&(this._isSuccess()?e(this._getSubscribeSuccessContext()):t(this._getSubscribeErrorContext()))},j.subscribe=function(){return 2!=this._status?(this._centrifuge._subscribe(this),this):void 0},j.unsubscribe=function(){this._setUnsubscribed(),this._centrifuge._unsubscribe(this)},j.publish=function(e){var t=this;return new p(function(n,i){return t._isUnsubscribed()?void i(t._centrifuge._createErrorObject("subscription unsubscribed","fix")):void t._promise.then(function(){if(!t._centrifuge.isConnected())return void i(t._centrifuge._createErrorObject("disconnected","retry"));var s={method:"publish",params:{channel:t.channel,data:e}},r=t._centrifuge._addMessage(s);t._centrifuge._registerCall(r,n,i)},function(e){i(e)})})},j.presence=function(){var e=this;return new p(function(t,n){return e._isUnsubscribed()?void n(e._centrifuge._createErrorObject("subscription unsubscribed","fix")):void e._promise.then(function(){if(!e._centrifuge.isConnected())return void n(e._centrifuge._createErrorObject("disconnected","retry"));var i={method:"presence",params:{channel:e.channel}},s=e._centrifuge._addMessage(i);e._centrifuge._registerCall(s,t,n)},function(e){n(e)})})},j.history=function(){var e=this;return new p(function(t,n){return e._isUnsubscribed()?void n(e._centrifuge._createErrorObject("subscription unsubscribed","fix")):void e._promise.then(function(){if(!e._centrifuge.isConnected())return void n(e._centrifuge._createErrorObject("disconnected","retry"));var i={method:"history",params:{channel:e.channel}},s=e._centrifuge._addMessage(i);e._centrifuge._registerCall(s,t,n)},function(e){n(e)})})},t.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"es6-promise":2,"wolfy87-eventemitter":3}]},{},[4])(4)});var UrlParser={regx:/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,get:function(url){var matches=this.regx.exec(url);return{href:matches[0],withoutHash:matches[1],url:matches[2],origin:matches[3],protocol:matches[4],protocolseparator:matches[5],credhost:matches[6],cred:matches[7],user:matches[8],pass:matches[9],host:matches[10],hostname:matches[11],port:matches[12],pathname:matches[13],segment1:matches[14],segment2:matches[15],search:matches[16],hash:matches[17]}}};Utils={getCurrentSite:function(){var url=window.location.href;return url.indexOf("wallet.exmo.")>-1?"wallet":url.indexOf("merchant.exmo.")>-1?"merchant":"exchange"},removeExponent:function(number){var data=String(number).split(/[eE]/);if(1==data.length)return data[0];var z="",sign=number<0?"-":"",str=data[0].replace(".",""),mag=Number(data[1])+1;if(mag<0){for(z=sign+"0.";mag++;)z+="0";return z+str.replace(/^\-/,"")}for(mag-=str.length;mag--;)z+="0";return str+z},getProductLink:function(name){var url=window.location.href,port="";return 4==Utils.explode(".",url).length?"":(url.indexOf("://")>-1&&(url=url.substring(url.indexOf("://")+3,url.length)),
url.indexOf("https://exmo.com/")>-1&&(url=url.substring(0,url.indexOf("https://exmo.com/"))),url.indexOf(":")>-1&&(port=url.substring(url.indexOf(":"),url.length),url=url.substring(0,url.indexOf(":"))),url=Utils.explode(".",url),url=void 0!=url[2]?url[2]:void 0!=url[1]?url[1]:"com",url="//"+name+".exmo."+url+port+"/root/")},explode:function(delimiter,string){var emptyArray={0:""};return 2!=arguments.length||void 0===arguments[0]||void 0===arguments[1]?null:""!==delimiter&&!1!==delimiter&&null!==delimiter&&("function"==typeof delimiter||"object"==typeof delimiter||"function"==typeof string||"object"==typeof string?emptyArray:(!0===delimiter&&(delimiter="1"),string.toString().split(delimiter.toString())))},isNumber:function(e){var key=e.charCode||e.keyCode||0;return 8==key||9==key||37==key||39==key||46==key||110==key||190==key||key>=35&&key<=40||key>=48&&key<=57||key>=96&&key<=105},myFloor:function(val,decimals){return null==decimals&&(decimals=8),void 0==val?0:(val=this.removeExponent(val.toString()),-1==val.indexOf(".")?val:val.substr(0,val.indexOf(".")+1)+""+val.substring(val.indexOf(".")+1,val.indexOf(".")+1+decimals))},formatProbels:function(dg){dg=""+dg;var cel=dg,dr="";return dg.indexOf(".")>0&&(cel=dg.substr(0,dg.indexOf(".")),dr=dg.substr(dg.indexOf("."),dg.length)),(cel=cel.replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 "))+dr},removeSpaces:function(str){return str.replace(/\s+/g,"")},trimX:function(str,cnt){var ppos,before,after;return"string"!=typeof str&&(str+=""),-1===(ppos=str.indexOf("."))?str:(before=str.substr(0,ppos),after=str.substr(ppos,cnt+1),".0"==after&&(after=""),before+after)},limitFloatLength:function(value,maxLength){var val="0",maxLength=void 0!==maxLength?maxLength:10;"string"==typeof value&&(val=value.slice()),"number"==typeof value&&(val=number_format(value,maxLength,".",""));var ppos=val.indexOf(".",0);return ppos>-1&&(val=ppos<maxLength?val.slice(0,maxLength):val.slice(0,ppos)),"."===val.slice(-1)&&(val=val.slice(0,-1)),val}},function(exports){"use strict";var number_format=function(number,decimals,dec_point,thousands_sep){var i,j,kw,kd,km;isNaN(decimals=Math.abs(decimals))&&(decimals=2),null==dec_point&&(dec_point=","),null==thousands_sep&&(thousands_sep="."),number=(number+"").replace(",","."),isNaN(number)&&(number=0),number=Utils.myFloor(number,decimals);var znak="";number<0&&(znak="-"),number=Big(number),i=parseInt(number.toFixed(decimals))+"",(j=i.length)>3?j%=3:j=0,km=j?i.substr(0,j)+thousands_sep:"",kw=i.substr(j).replace(/(\d{3})(?=\d)/g,"$1"+thousands_sep),kd=decimals?dec_point+number.minus(i).abs().toFixed(decimals).replace(/-/,0).slice(2):"";var res=km+kw+kd;if(res.indexOf(".")>0||res.indexOf(",")>0){for(;"0"==res[res.length-1];)res=res.substr(0,res.length-1);"."!=res[res.length-1]&&","!=res[res.length-1]||(res=res.substr(0,res.length-1))}return res+="","0"!=res&&-1==res.indexOf("-")&&(res=znak+res),res},tt=function(phrase,args){if("string"!=typeof phrase||0==phrase.length)return"";var res=phrase;if(null==args&&(args=[]),null!=exports.tt_data&&null!=exports.tt_data[phrase]&&(res=exports.tt_data[phrase]),args instanceof Array)for(var i in args)res=res.replace("["+(parseInt(i,10)+1)+"]",args[i]);return res},ttt=function(phrase,args){return tt(phrase,args)},getIdFromHash=function(){var url=window.location.hash,match=url.match(/#.*[?&]id=([^&]+)(&|$)/);return match?match[1]:""};exports.number_format=number_format,exports.tt=tt,exports.ttt=ttt,exports.getIdFromHash=getIdFromHash,null!=exports.location&&(exports.onpopstate=function(){var match,pl=/\+/g,search=/([^&=]+)=?([^&]*)/g,decode=function(s){return decodeURIComponent(s.replace(pl," "))},query=exports.location.search.substring(1);for(exports.$_GET={};match=search.exec(query);)exports.$_GET[decode(match[1])]=decode(match[2])})(),null==exports.console&&(exports.console={log:function(){},error:function(){}})}(this),function(n){"use strict";function c(){function n(t){var i=this;if(!(i instanceof n))return void 0===t?c():new n(t);t instanceof n?(i.s=t.s,i.e=t.e,i.c=t.c.slice()):y(i,t),i.constructor=n}return n.prototype=t,n.DP=l,n.RM=a,n}function s(n,t,i){var e=n.constructor,r=t-(n=new e(n)).e,f=n.c;for(f.length>++t&&o(n,r,e.RM),f[0]?i?r=t:(f=n.c,r=n.e+r+1):++r;f.length<r;f.push(0));return r=n.e,1===i||i&&(t<=r||r<=u)?(n.s<0&&f[0]?"-":"")+(f.length>1?f[0]+"."+f.join("").slice(1):f[0])+(r<0?"e":"e+")+r:n.toString()}function y(n,t){var u,r,f;for(0===t&&1/t<0?t="-0":v.test(t+="")||i(NaN),n.s="-"==t.charAt(0)?(t=t.slice(1),-1):1,(u=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(u<0&&(u=r),u+=+t.slice(r+1),t=t.substring(0,r)):u<0&&(u=t.length),r=0;"0"==t.charAt(r);r++);if(r==(f=t.length))n.c=[n.e=0];else{for(;"0"==t.charAt(--f););for(n.e=u-r-1,n.c=[],u=0;r<=f;n.c[u++]=+t.charAt(r++));}return n}function o(n,t,r,u){var o,e=n.c,f=n.e+t+1;if(1===r?u=e[f]>=5:2===r?u=e[f]>5||5==e[f]&&(u||f<0||e[f+1]!==o||1&e[f-1]):3===r?u=u||e[f]!==o||f<0:(u=!1,0!==r&&i("!Big.RM!")),f<1||!e[0])u?(n.e=-t,n.c=[1]):n.c=[n.e=0];else{if(e.length=f--,u)for(;++e[f]>9;)e[f]=0,f--||(++n.e,e.unshift(1));for(f=e.length;!e[--f];e.pop());}return n}function i(n){var t=new Error(n);throw t.name="BigError",t}var e,l=20,a=1,r=1e6,u=-7,f=21,t={},v=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;t.abs=function(){var n=new this.constructor(this);return n.s=1,n},t.cmp=function(n){var e,o=this,u=o.c,f=(n=new o.constructor(n)).c,t=o.s,s=n.s,i=o.e,r=n.e;if(!u[0]||!f[0])return u[0]?t:f[0]?-s:0;if(t!=s)return t;if(e=t<0,i!=r)return i>r^e?1:-1;for(t=-1,s=(i=u.length)<(r=f.length)?i:r;++t<s;)if(u[t]!=f[t])return u[t]>f[t]^e?1:-1;return i==r?0:i>r^e?1:-1},t.div=function(n){var p=this,w=p.constructor,h=p.c,e=(n=new w(n)).c,v=p.s==n.s?1:-1,c=w.DP;if((c!==~~c||c<0||c>r)&&i("!Big.DP!"),!h[0]||!e[0])return h[0]==e[0]&&i(NaN),e[0]||i(v/0),new w(0*v);var s,b,y,l,f,it=e.slice(),k=s=e.length,rt=h.length,t=h.slice(0,s),u=t.length,a=n,d=a.c=[],g=0,nt=c+(a.e=p.e-n.e)+1;for(a.s=v,v=nt<0?0:nt,it.unshift(0);u++<s;t.push(0));do{for(y=0;y<10;y++){if(s!=(u=t.length))l=s>u?1:-1;else for(f=-1,l=0;++f<s;)if(e[f]!=t[f]){l=e[f]>t[f]?1:-1;break}if(!(l<0))break;for(b=u==s?e:it;u;){if(t[--u]<b[u]){for(f=u;f&&!t[--f];t[f]=9);--t[f],t[u]+=10}t[u]-=b[u]}for(;!t[0];t.shift());}d[g++]=l?y:++y,t[0]&&l?t[u]=h[k]||0:t=[h[k]]}while((k++<rt||void 0!==t[0])&&v--);return d[0]||1==g||(d.shift(),a.e--),g>nt&&o(a,c,w.RM,void 0!==t[0]),a},t.eq=function(n){return!this.cmp(n)},t.gt=function(n){return this.cmp(n)>0},t.gte=function(n){return this.cmp(n)>-1},t.lt=function(n){return this.cmp(n)<0},t.lte=function(n){return this.cmp(n)<1},t.minus=function(n){var f,u,o,c,s=this,l=s.constructor,e=s.s,i=(n=new l(n)).s;if(e!=i)return n.s=-i,s.plus(n);var t=s.c.slice(),a=s.e,r=n.c,h=n.e;if(!t[0]||!r[0])return r[0]?(n.s=-i,n):new l(t[0]?s:0);if(e=a-h){for((c=e<0)?(e=-e,o=t):(h=a,o=r),o.reverse(),i=e;i--;o.push(0));o.reverse()}else for(u=((c=t.length<r.length)?t:r).length,e=i=0;i<u;i++)if(t[i]!=r[i]){c=t[i]<r[i];break}if(c&&(o=t,t=r,r=o,n.s=-n.s),(i=(u=r.length)-(f=t.length))>0)for(;i--;t[f++]=0);for(i=f;u>e;){if(t[--u]<r[u]){for(f=u;f&&!t[--f];t[f]=9);--t[f],t[u]+=10}t[u]-=r[u]}for(;0==t[--i];t.pop());for(;0==t[0];)t.shift(),--h;return t[0]||(n.s=1,t=[h=0]),n.c=t,n.e=h,n},t.mod=function(n){var e,t=this,r=t.constructor,u=t.s,f=(n=new r(n)).s;return n.c[0]||i(NaN),t.s=n.s=1,e=1==n.cmp(t),t.s=u,n.s=f,e?new r(t):(u=r.DP,f=r.RM,r.DP=r.RM=0,t=t.div(n),r.DP=u,r.RM=f,this.minus(t.times(n)))},t.plus=function(n){var u,e=this,s=e.constructor,i=e.s,f=(n=new s(n)).s;if(i!=f)return n.s=-f,e.minus(n);var h=e.e,t=e.c,o=n.e,r=n.c;if(!t[0]||!r[0])return r[0]?n:new s(t[0]?e:0*i);if(t=t.slice(),i=h-o){for(i>0?(o=h,u=r):(i=-i,u=t),u.reverse();i--;u.push(0));u.reverse()}for(t.length-r.length<0&&(u=r,r=t,t=u),i=r.length,f=0;i;)f=(t[--i]=t[i]+r[i]+f)/10|0,t[i]%=10;for(f&&(t.unshift(f),++o),i=t.length;0==t[--i];t.pop());return n.c=t,n.e=o,n},t.pow=function(n){var t=this,u=new t.constructor(1),r=u,f=n<0;for((n!==~~n||n<-1e6||n>1e6)&&i("!pow!"),n=f?-n:n;1&n&&(r=r.times(t)),n>>=1;)t=t.times(t);return f?u.div(r):r},t.round=function(n,t){var u=this,f=u.constructor;return null==n?n=0:(n!==~~n||n<0||n>r)&&i("!round!"),o(u=new f(u),n,null==t?f.RM:t),u},t.sqrt=function(){var f,n,e,r=this,u=r.constructor,h=r.c,t=r.s,s=r.e,c=new u("0.5");if(!h[0])return new u(r);t<0&&i(NaN),t=Math.sqrt(r.toString()),0==t||t==1/0?(f=h.join(""),f.length+s&1||(f+="0"),n=new u(Math.sqrt(f).toString()),n.e=((s+1)/2|0)-(s<0||1&s)):n=new u(t.toString()),t=n.e+(u.DP+=4);do{e=n,n=c.times(e.plus(r.div(e)))}while(e.c.slice(0,t).join("")!==n.c.slice(0,t).join(""));return o(n,u.DP-=4,u.RM),n},t.times=function(n){var t,s=this,h=s.constructor,f=s.c,e=(n=new h(n)).c,o=f.length,i=e.length,u=s.e,r=n.e;if(n.s=s.s==n.s?1:-1,!f[0]||!e[0])return new h(0*n.s);for(n.e=u+r,o<i&&(t=f,f=e,e=t,r=o,o=i,i=r),t=new Array(r=o+i);r--;t[r]=0);for(u=i;u--;){for(i=0,r=o+u;r>u;)i=t[r]+e[u]*f[r-u-1]+i,t[r--]=i%10,i=i/10|0;t[r]=(t[r]+i)%10}for(i&&++n.e,t[0]||t.shift(),u=t.length;!t[--u];t.pop());return n.c=t,n},t.toString=t.valueOf=t.toJSON=function(){var r=this,t=r.e,n=r.c.join(""),i=n.length;if(t<=u||t>=f)n=n.charAt(0)+(i>1?"."+n.slice(1):"")+(t<0?"e":"e+")+t;else if(t<0){for(;++t;n="0"+n);n="0."+n}else if(t>0)if(++t>i)for(t-=i;t--;n+="0");else t<i&&(n=n.slice(0,t)+"."+n.slice(t));else i>1&&(n=n.charAt(0)+"."+n.slice(1));return r.s<0&&r.c[0]?"-"+n:n},t.toExponential=function(n){return null==n?n=this.c.length-1:(n!==~~n||n<0||n>r)&&i("!toExp!"),s(this,n,1)},t.toFixed=function(n){var t,e=this,o=u,h=f;return u=-(f=1/0),null==n?t=e.toString():n===~~n&&n>=0&&n<=r&&(t=s(e,e.e+n),e.s<0&&e.c[0]&&t.indexOf("-")<0&&(t="-"+t)),u=o,f=h,t||i("!toFix!"),t},t.toPrecision=function(n){return null==n?this.toString():((n!==~~n||n<1||n>r)&&i("!toPre!"),s(this,n-1,2))},e=c(),"function"==typeof define&&define.amd?define(function(){return e}):"undefined"!=typeof module&&module.exports?module.exports=e:n.Big=e}(this),function(){"use strict";var a=angular.module("ngNotify",[]),b=!1;try{angular.module("ngSanitize")&&(angular.module("ngNotify").requires.push("ngSanitize"),b=!0)}catch(c){}a.run(["$templateCache",function(a){a.put("templates/ng-notify/ng-notify.html",'<div class="ngn" ng-class="ngNotify.notifyClass" ng-style="ngNotify.notifyStyle"><span class="ngn-dismiss" ng-click="dismiss()">&times;</span><span class="content" ng-if="ngNotify.notifyHtml" ng-bind-html="ngNotify.notifyMessage"></span><span ng-if="!ngNotify.notifyHtml" ng-bind="ngNotify.notifyMessage"></span></div>')}]),a.provider("ngNotify",function(){this.$get=["$document","$compile","$log","$rootScope","$timeout","$interval","$templateCache",function(a,c,d,e,f,g,h){var i,j,v={theme:"pure",position:"bottom",duration:3e3,type:"info",sticky:!1,html:!1},w={notifyClass:"",notifyMessage:"",notifyStyle:{display:"none",opacity:0}},x={pure:"",prime:"ngn-prime",pastel:"ngn-pastel",pitchy:"ngn-pitchy"},y={info:"ngn-info",error:"ngn-error",success:"ngn-success",warn:"ngn-warn",grimace:"ngn-grimace"},z={bottom:"ngn-bottom",top:"ngn-top"},A=e.$new(),B=c(h.get("templates/ng-notify/ng-notify.html"))(A);A.ngNotify=angular.extend({},w),a.find("body").append(B);var C=function(a){var b=a.type||v.type;return(y[b]||y.info)+" "},D=function(a){var b=a.theme||v.theme;return(x[b]||x.pure)+" "},E=function(a){var b=a.position||v.position;return(z[b]||z.bottom)+" "},F=function(a){var b=a.duration||v.duration;return angular.isNumber(b)?b:3e3},G=function(a){return!!(void 0!==a.sticky?a.sticky:v.sticky)},H=function(a){return!a.html&&!v.html||b?!!(void 0!==a.html?a.html:v.html):(d.debug("ngNotify warning: \ngSanitize couldn't be located.  In order to use the 'html' option, be sure the ngSanitize source is included in your project."),!1)},I=function(a,b){var c=C(a)+D(a)+E(a);return c+=b?"ngn-sticky":""},J=function(){A.ngNotify=angular.extend({},w)},K=function(a,b,c,d){var e=25/c;A.ngNotify.notifyStyle={display:"block",opacity:b};var f=function(){b+=a*e,A.ngNotify.notifyStyle.opacity=b,(0>=b||b>=1)&&(g.cancel(j),j=!1,d())};j||(j=g(f,25))},L=function(a,b){K(-1,1,a,b)},M=function(a,b){K(1,0,a,b)};return A.dismiss=function(){L(500,function(){J()})},{config:function(a){a=a||{},angular.extend(v,a)},set:function(a,b){if(a){g.cancel(j),j=!1,f.cancel(i);var c={};"object"==typeof b?c=b:c.type=b;var d=G(c),e=F(c);angular.extend(A.ngNotify,{notifyHtml:H(c),notifyClass:I(c,d),notifyMessage:a}),M(200,function(){d||(i=f(function(){A.dismiss()},e))})}},dismiss:function(){A.dismiss()},addTheme:function(a,b){a&&b&&(x[a]=b)},addType:function(a,b){a&&b&&(y[a]=b)}}}]})}(),function(p,f,n){"use strict";f.module("ngCookies",["ng"]).factory("$cookies",["$rootScope","$browser",function(d,b){var h,c={},g={},k=!1,l=f.copy,m=f.isUndefined;return b.addPollFn(function(){var a=b.cookies();h!=a&&(h=a,l(a,g),l(a,c),k&&d.$apply())})(),k=!0,d.$watch(function(){var a,e,d;for(a in g)m(c[a])&&b.cookies(a,void 0);for(a in c)e=c[a],f.isString(e)?e!==g[a]&&(b.cookies(a,e),d=!0):f.isDefined(g[a])?c[a]=g[a]:delete c[a];if(d)for(a in e=b.cookies(),c)c[a]!==e[a]&&(m(e[a])?delete c[a]:c[a]=e[a])}),c}]).factory("$cookieStore",["$cookies",function(d){return{get:function(b){return(b=d[b])?f.fromJson(b):b},put:function(b,c){d[b]=f.toJson(c)},remove:function(b){delete d[b]}}}])}(window,window.angular),function(e){function n(){}function t(e,n){return function(){e.apply(n,arguments)}}function o(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],s(e,this)}function i(e,n){for(;3===e._state;)e=e._value;return 0===e._state?void e._deferreds.push(n):(e._handled=!0,void o._immediateFn(function(){var t=1===e._state?n.onFulfilled:n.onRejected;if(null===t)return void(1===e._state?r:u)(n.promise,e._value);var o;try{o=t(e._value)}catch(i){return void u(n.promise,i)}r(n.promise,o)}))}function r(e,n){try{if(n===e)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var i=n.then;if(n instanceof o)return e._state=3,e._value=n,void f(e);if("function"==typeof i)return void s(t(i,n),e)}e._state=1,e._value=n,f(e)}catch(r){u(e,r)}}function u(e,n){e._state=2,e._value=n,f(e)}function f(e){2===e._state&&0===e._deferreds.length&&o._immediateFn(function(){e._handled||o._unhandledRejectionFn(e._value)});for(var n=0,t=e._deferreds.length;n<t;n++)i(e,e._deferreds[n]);e._deferreds=null}function c(e,n,t){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.promise=t}function s(e,n){var t=!1;try{e(function(e){t||(t=!0,r(n,e))},function(e){t||(t=!0,u(n,e))})}catch(o){if(t)return;t=!0,u(n,o)}}var a=setTimeout;o.prototype.catch=function(e){return this.then(null,e)},o.prototype.then=function(e,t){var o=new this.constructor(n);return i(this,new c(e,t,o)),o},o.all=function(e){var n=Array.prototype.slice.call(e);return new o(function(e,t){function o(r,u){try{if(u&&("object"==typeof u||"function"==typeof u)){var f=u.then;if("function"==typeof f)return void f.call(u,function(e){o(r,e)},t)}n[r]=u,0==--i&&e(n)}catch(c){t(c)}}if(0===n.length)return e([]);for(var i=n.length,r=0;r<n.length;r++)o(r,n[r])})},o.resolve=function(e){return e&&"object"==typeof e&&e.constructor===o?e:new o(function(n){n(e)})},o.reject=function(e){return new o(function(n,t){t(e)})},o.race=function(e){return new o(function(n,t){for(var o=0,i=e.length;o<i;o++)e[o].then(n,t)})},o._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){a(e,0)},o._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},o._setImmediateFn=function(e){o._immediateFn=e},o._setUnhandledRejectionFn=function(e){o._unhandledRejectionFn=e},"undefined"!=typeof module&&module.exports?module.exports=o:e.Promise||(e.Promise=o)}(this),function(){window.div=function(content,classes){return'<div class="'+(classes||"")+'">'+content+"</div>"},window.p=function(content,classes){return'<p class="'+(classes||"")+'">'+content+"</p>"},window.li=function(content,classes){return'<li class="'+(classes||"")+'">'+content+"</li>"},window.ul=function(content,classes){return'<ul class="'+(classes||"")+'">'+content+"</ul>"},window.setScrollableBody=function(){$("body").css("overflow","visible")},window.setUnscrollableBody=function(){$("body").css("overflow","hidden")},$(".container").on("click touch",function(){$(".popup_container").is(":visible")?$("body").css("overflow","hidden"):$("body").css("overflow","visible")})}(),angular.module("ExCaptcha",[]).constant("ExCaptchaType",{CAPTCHA_INTERNAL:0,CAPTCHA_RECAPTCHA:1}).service("ExCaptcha",function($window,$q,ExCaptchaType){var self=this;self.captchaType=ExCaptchaType.CAPTCHA_RECAPTCHA,"undefined"!=typeof Settings&&null!=Settings.captcha&&(self.captchaType=Settings.captcha),self.public_key="6Lcp8gATAAAAALtKsKUunrkAvH3S3tX3mv6FouUU",self.deferred=$q.defer(),self.promise=self.deferred.promise,self.recaptcha=null,self.internalCaptchaSelector=null,self.internalCaptchaCheckButton=!1,$window.recaptchaApiLoaded=function(){self.recaptcha=$window.grecaptcha,null!=self.recaptcha&&self.deferred.resolve(self.recaptcha)},self.getCaptchaType=function(){return self.captchaType},self.init=function(){return self.recaptcha?$q.when(self.recaptcha):self.promise},self.setError=function(msg){if(self.captchaType==ExCaptchaType.CAPTCHA_INTERNAL&&null!=self.internalCaptchaSelector){var $sel=$(self.internalCaptchaSelector),$wrap=$sel.find(".ex-captcha");$sel.find(".ex-captcha-error").html(msg),$wrap.addClass("err_mod")}},self.internalCaptchaURL=function(){return"/ctrl/captchaCheck/img/"+parseInt(9e5*Math.random()+1e5)},self.resetInternalCaptcha=function(){if(null!=self.internalCaptchaSelector){var $sel=$(self.internalCaptchaSelector),$img=$sel.find(".ex-captcha-img"),$input=$sel.find(".ex-captcha-input"),$err=$sel.find(".ex-captcha-error"),$wrap=$sel.find(".ex-captcha");$img.attr("src",self.internalCaptchaURL()),$input.val(""),$wrap.removeClass("err_mod"),$err.html("")}},self.renderInternalCaptcha=function(selector,verifyCallback,options){var checkButton=!1,buttonClass="";self.internalCaptchaCheckButton=!1,null!=options&&options.checkButton&&(checkButton=!0,self.internalCaptchaCheckButton=!0,buttonClass=" check-button-mod");var inputClass="span10";checkButton&&(inputClass="span8");var inputTpl="<div class='row ex-captcha-input-wrap"+buttonClass+"'><div class='col "+inputClass+"'><input type='text' placeholder='"+tt("Type the text")+"' class='ex-captcha-input'/></div>";checkButton&&(inputTpl+="<a href='#' class='col span2 ex-captcha-check'></a>"),inputTpl+="<div class='col span2 ex-captcha-reload-wrap'><a href='#' class='ex-captcha-reload'><img src=\"/static/img/refresh.svg\" alt='reload image'></a></div></div>";var tpl="<div class='ex-captcha std_form'><div class='ex-captcha-error'></div><div class='ex-captcha-img-wrap'><img class='ex-captcha-img' src='"+self.internalCaptchaURL()+"' alt='captcha'></div>"+inputTpl+"</div>";self.internalCaptchaSelector=selector,$(selector).html(tpl),self.internalCaptchaCheckButton&&$(selector).on("click",".ex-captcha-check",function(e){if(e.preventDefault(),"function"==typeof verifyCallback){var answer=$(this).parent().find(".ex-captcha-input").val()+"";verifyCallback(answer)}}),$(selector).on("keydown",".ex-captcha-input",function(e){13==e.keyCode&&e.preventDefault()}),$(selector).on("keyup",".ex-captcha-input",function(e){if(!self.internalCaptchaCheckButton&&"function"==typeof verifyCallback){var answer=$(this).val()+"";if(null==answer||answer.length<1)return;verifyCallback(answer)}}),$(selector).on("click",".ex-captcha-reload",function(e){e.preventDefault(),self.resetInternalCaptcha()})},self.render=function(selector,verifyCallback,options){null==options&&(options={});var defRender=$q.defer();return self.isDefined()&&$(selector).children().length>0?(self.reset(),$q.when(self)):(self.captchaType==ExCaptchaType.CAPTCHA_RECAPTCHA&&self.init().then(function(recaptcha){var theme=angular.element(selector).data("theme")||"light";null!=options.theme&&(theme=options.theme),recaptcha.ready(function(){recaptcha.render(selector,{sitekey:self.public_key,callback:verifyCallback,theme:theme}),defRender.resolve(self)})}),self.captchaType==ExCaptchaType.CAPTCHA_INTERNAL?(self.renderInternalCaptcha(selector,verifyCallback,options),$q.when(self)):defRender.promise)},self.reset=function(){var def=$q.defer();return self.captchaType==ExCaptchaType.CAPTCHA_RECAPTCHA&&self.init().then(function(recaptcha){recaptcha.reset(),def.resolve(recaptcha)}),self.captchaType==ExCaptchaType.CAPTCHA_INTERNAL&&(self.resetInternalCaptcha(),def.resolve(null)),def.promise},self.isDefined=function(){return self.captchaType!=ExCaptchaType.CAPTCHA_RECAPTCHA||angular.isDefined($window.grecaptcha)},self.captchaType==ExCaptchaType.CAPTCHA_RECAPTCHA&&self.isDefined()&&$window.recaptchaApiLoaded()}),angular.module("TradePage",[]).service("TradePage",function(User,$location,$q){var self=this;self.pair="",self.curr1="",self.curr2="",self.scrollLeftPos=0,self.in_progress=!1,self.market=null,self.created_orders="1"==window.User.created_orders,self.init=function(){var default_para=Settings.default_para;void 0==$location.search().pair?self.setPara(default_para):self.setPara($location.search().pair)},self.setMarket=function(market){self.market=market},self.setPara=function(pair){Validator.isValid("pair",pair)&&(self.pair=pair,self.curr1=pair.substr(0,pair.indexOf("_")),self.curr2=pair.substr(pair.indexOf("_")+1,pair.length),self.btnTextDefault())},self.strReplaceZap=function(str){return str.indexOf(",")>-1&&(str=str.indexOf(".")>-1?str.replace(",",""):str.replace(",",".")),str=str.replace(">",""),str=str.replace("~",""),str=str.replace(" ","")},self.btnTextSending=function(){self.in_progress=!0,$("#market_buy").val(tt("Processing...")),$("#market_sell").val(tt("Processing...")),$("#limit_buy").val(tt("Processing...")),$("#limit_sell").val(tt("Processing..."))},self.btnTextDefault=function(){0==self.in_progress&&($("#market_buy").val(tt("Buy")+" "+self.curr1),$("#market_sell").val(tt("Sell")+" "+self.curr1),$("#limit_buy").val(tt("Buy")+" "+self.curr1),$("#limit_sell").val(tt("Sell")+" "+self.curr1))},self.calcNeedSumma=function(arOrders,target_amount,lymbda){Big.DP=8,target_amount=new Big(target_amount);var kolvoPlus,summaPlus,order,order_price,order_amount,current_amount=new Big(0),current_summa=new Big(0);for(i=0;i<arOrders.length&&(order=arOrders[i],order_amount=new Big(order[1]),order_price=new Big(order[0]),kolvoPlus=new Big(0),summaPlus=new Big(0),kolvoPlus=current_amount.plus(order_amount).gt(target_amount)?new Big(target_amount.minus(current_amount).toFixed(8)):order_amount,summaPlus=kolvoPlus.times(order_price),summaPlus.lt(1e-8)&&(summaPlus=0),current_amount=current_amount.plus(kolvoPlus),current_summa=current_summa.plus(summaPlus),!current_amount.gte(target_amount));i++);return void 0==lymbda&&(current_summa=Utils.limitFloatLength(current_summa.toFixed(8),10),current_amount.eq(0)&&(current_amount=new Big(0)),current_summa=current_amount.plus(.001).gt(target_amount)?"> "+current_summa:"~ "+current_summa),current_summa},self.calcNeedAmount=function(arOrders,target_summa,lymbda){Big.DP=8,target_summa=new Big(target_summa);var kolvoPlus,summaPlus,order,order_price,order_amount,order_result,current_kolvo=new Big(0),current_summa=new Big(0);for(i=0;i<arOrders.length;i++){if(order=arOrders[i],order_amount=new Big(order[1]),order_price=new Big(order[0]),order_result=new Big(order[2]),kolvoPlus=new Big(0),summaPlus=new Big(0),current_summa.plus(order_result).gt(target_summa)){if(kolvoPlus=new Big(target_summa.minus(current_summa).div(order_price).toFixed(8)),kolvoPlus.lt(1e-8))break;summaPlus=kolvoPlus.times(order_price)}else kolvoPlus=order_amount,summaPlus=order_result;if(summaPlus.lt(1e-8)&&(summaPlus=new Big(0)),current_kolvo=current_kolvo.plus(kolvoPlus),current_summa=current_summa.plus(summaPlus),current_summa.plus(.001).gte(target_summa))break}return void 0==lymbda&&(current_kolvo=Utils.limitFloatLength(current_kolvo.toString(),10),current_kolvo=current_summa.plus(.001).lt(target_summa)?"> "+current_kolvo:"~ "+current_kolvo),current_kolvo},self.sortDomItems=function(items,itemsWrap,cb){[].slice.call(items).sort(cb).forEach(function(item){itemsWrap.append(item)})},self.checkAuth=function(){var dfd=$q.defer();return app.auth?(dfd.resolve(),dfd.promise):(window.location.href="/register",dfd.resolve())}}).controller("TradePageCtrl",function($scope,TradePage,TopPanel,$rootScope,User,$element){$scope.TradePage=TradePage,TradePage.btnTextDefault(),TopPanel.highlightPair=!0}).directive("orderCreateDir",function(){return function(scope,element,attrs){scope.tabs=element.find(".tab_btn"),scope.formsSrc=element.find(".tab_unit"),scope.forms=[];for(var i=0;i<scope.formsSrc.length;i++){var orderType=scope.formsSrc[i].getAttribute("order-type");scope.forms[orderType]=scope.formsSrc[i]}scope.tabs.on("click touch",function(e){var type=e.currentTarget.getAttribute("order-type");scope.tabs.removeClass("btn_active"),$(e.currentTarget).addClass("btn_active");for(var i in scope.forms)i!=type?angular.element(scope.forms[i]).css("display","none"):angular.element(scope.forms[i]).css("display","block")})}}).service("Order",function($http,User,Rates,$location,Alert,TradePage,$rootScope){var self=this;self.cancel=function(id){$http.post("/ctrl/orderCancel/cancel",{csrf_token:app.csrf_token,orderid:id}).success(function(resp){if(1!=resp.success)return void Alert.msg(resp.error);$rootScope.$broadcast("REFRESH_MY_ORDERS")}).error(function(data,status,headers,config){Alert.msg(tt("Error 10171: Server problem"))})},self.cancelAll=function(cancelType,pair){null==pair&&(pair=TradePage.pair),$http.post("/ctrl/orderCancel/cancel",{csrf_token:app.csrf_token,cancelType:cancelType,pair:pair}).success(function(resp){if(1!=resp.success)return void Alert.msg(resp.error);$rootScope.$broadcast("REFRESH_MY_ORDERS")}).error(function(data,status,headers,config){Alert.msg(tt("Error 10171: Server problem"))})},self.createComplexOrder=function(data,$scope,successf,errorf){1!=TradePage.in_progress&&(TradePage.btnTextSending(),void 0==data||void 0==data.pair||void 0==data.type||void 0==data.quantity||void 0==data.price||void 0==data.sl?Alert.msg(tt("Parameters error")):$http.post("/ctrl/orderCreate",{csrf_token:app.csrf_token,pair:data.pair,type:data.type,quantity:data.quantity,price:data.price,sl:data.sl,src:2}).success(function(resp){1==resp.success?(TradePage.created_orders||(User.change_settings("created_orders"),TradePage.created_orders=!0),void 0!=successf&&successf.call($scope)):(Alert.msg(resp.error),void 0!=errorf&&errorf.call($scope)),TradePage.in_progress=!1,TradePage.btnTextDefault()}).error(function(data,status,headers,config){TradePage.in_progress=!1,TradePage.btnTextDefault(),Alert.msg(tt("Error 10172: Server problem"))}))}}).controller("MarketOrdersCtrl",function($scope,TradePage,Order,$rootScope,$element,$http,OrdersActive){$scope.elBuyAmount=$element.find("input[name=buyAmount]"),$scope.elBuyAmount.val(0),$scope.elBuySumma=$element.find("input[name=buySumma]"),$scope.elBuySumma.val(0),$scope.elSellAmount=$element.find("input[name=sellAmount]"),$scope.elSellAmount.val(0),$scope.elSellSumma=$element.find("input[name=sellSumma]"),$scope.elSellSumma.val(0),$scope.priblBuySumm=0,$scope.priblSellSumm=0,$scope.priblBuyAmount=0,$scope.priblSellAmount=0,$scope.onDestroyF=[];var dFB=$rootScope.$on("SET_BUY_PRICE",function(event,data){if(void 0!=data.amount){var amount=parseFloat(data.amount);amount=number_format(amount,8,".",""),$scope.elBuyAmount.val(amount)}$scope.elBuySumma.val(0)});$scope.onDestroyF.push(dFB);var dFS=$rootScope.$on("SET_SELL_PRICE",function(event,data){if(void 0!=data.amount){var amount=parseFloat(data.amount);amount=number_format(amount,8,".",""),$scope.elSellAmount.val(amount)}$scope.elSellSumma.val(0)});$scope.onDestroyF.push(dFS);var dF2=$rootScope.$on("PAIR_CHANGED",function(){$scope.elBuyAmount.val(0),$scope.elBuySumma.val(0),$scope.elSellAmount.val(0),$scope.elSellSumma.val(0),$scope.priblBuySumm=0,$scope.priblSellSumm=0,$scope.priblBuyAmount=0,$scope.priblSellAmount=0});$scope.onDestroyF.push(dF2),$.each([$scope.elBuyAmount,$scope.elBuySumma,$scope.elSellAmount,$scope.elSellSumma],function(){$(this).on("click touch focusin",function(){"0"==$(this).val()&&$(this).val("")}).on("blur focusout",function(){""==$(this).val()&&$(this).val("0")})}),$scope.elBuyAmount.on("keyup paste focusin",function(){$scope.elBuySumma.val(0),$scope.elSellSumma.val(0),$scope.elSellAmount.val(0),$scope.request($scope.elBuySumma.val()||0,$scope.elBuyAmount.val()||0,"basedOnReceive",TradePage.curr2,TradePage.curr1).then(function(result){$scope.priblBuySumm=result,$scope.priblSellSumm=0,$scope.priblBuyAmount=0,$scope.priblSellAmount=0})}),$scope.elBuySumma.on("keyup paste focusin",function(){$scope.elBuyAmount.val(0),$scope.elSellSumma.val(0),$scope.elSellAmount.val(0),$scope.request($scope.elBuySumma.val()||0,$scope.elBuyAmount.val()||0,"basedOnGive",TradePage.curr2,TradePage.curr1).then(function(result){$scope.priblBuyAmount=result,$scope.priblBuySumm=0,$scope.priblSellSumm=0,$scope.priblSellAmount=0})}),$scope.elSellAmount.on("keyup paste focusin",function(){$scope.elSellSumma.val(0),$scope.elBuyAmount.val(0),$scope.elBuySumma.val(0),$scope.request($scope.elSellAmount.val()||0,$scope.elSellSumma.val()||0,"basedOnGive",TradePage.curr1,TradePage.curr2).then(function(result){$scope.priblSellSumm=result,$scope.priblBuySumm=0,$scope.priblBuyAmount=0,$scope.priblSellAmount=0})}),$scope.elSellSumma.on("keyup paste focusin",function(){$scope.elSellAmount.val(0),$scope.elBuyAmount.val(0),$scope.elBuySumma.val(0),$scope.request($scope.elSellAmount.val()||0,$scope.elSellSumma.val()||0,"basedOnReceive",TradePage.curr1,TradePage.curr2).then(function(result){$scope.priblSellAmount=result,$scope.priblBuySumm=0,$scope.priblSellSumm=0,$scope.priblBuyAmount=0})}),$element.find(".market_order_block").on("click touch",".btn",function(e){e.stopPropagation()}),$element.find(".market_order_block").on("click touch",function(){$element.find(".market_order_block").removeClass("border-right"),$(this).addClass("border-right"),$element.find(".border-right .trade_input").focus()}),$element.find(".trade_input").on("click focus",function(e){e.stopPropagation(),$element.find(".market_order_block").removeClass("border-right"),$(this).closest(".market_order_block").addClass("border-right")}),$scope.createBuyOrder=function(){TradePage.checkAuth().then(function(){var otype="market_buy",amount=TradePage.strReplaceZap($scope.elBuyAmount.val());0==amount&&(amount=TradePage.strReplaceZap($scope.elBuySumma.val()),otype="market_buy_total"),Order.createComplexOrder({pair:TradePage.pair,type:otype,quantity:amount,price:0,sl:0},$scope,function(){$scope.elBuyAmount.val(0),$scope.elBuySumma.val(0)})})},$scope.createSellOrder=function(){TradePage.checkAuth().then(function(){var otype="market_sell",amount=TradePage.strReplaceZap($scope.elSellAmount.val());0==amount&&(amount=TradePage.strReplaceZap($scope.elSellSumma.val()),otype="market_sell_total"),Order.createComplexOrder({pair:TradePage.pair,type:otype,quantity:amount,price:0,sl:0},$scope,function(){$scope.elSellAmount.val(0),$scope.elSellSumma.val(0)})})},$scope.reset=function(){$scope.priblBuySumm=0,$scope.priblSellSumm=0,$scope.priblBuyAmount=0,$scope.priblSellAmount=0},$scope.request=function(amount,quantity,direction,curr1,curr2){return new Promise(function(resolve,reject){$http.post("/ctrl/calculateOffer/approximately",{csrf_token:app.csrf_token,currencyGive:curr1,currencyReceive:curr2,direction:direction,amount:amount,quantity:quantity,balance:0,balance2:0,ignoreBalance:!0}).success(function(resp){1==resp.success?("basedOnGive"==direction&&resolve("TOO_LARGE"==resp.data.error_code?0:resp.data.prefix+resp.data.quantity),"basedOnReceive"==direction&&resolve("TOO_LARGE"==resp.data.error_code?0:resp.data.prefix+resp.data.amount)):resolve(0)
})})}}).controller("BuyOrderCtrl",function($scope,Settings,$element,TradePage,UWallets,Order,$rootScope,OrdersActive,Alert,User){$scope.elAmount=$element.find("input[name=buyAmount]"),$scope.elPrice=$element.find("input[name=buyPrice]"),$scope.elResult=$element.find(".elTotal"),$scope.elComission=$element.find(".elComission"),$scope.elOstatok=$element.find(".elBalance"),$scope.elPrice.val(0),$scope.comission=Settings.comission,$scope.onDestroyF=[],$.each([$scope.elAmount,$scope.elPrice],function(){$(this).on("click touch",function(){"0"==$(this).val()&&$(this).val("")}).on("blur",function(){""==$(this).val()&&$(this).val("0")})});var dF=$rootScope.$on("SET_BUY_PRICE",function(event,data){if(void 0!=data.amount){var amount=parseFloat(data.amount);amount=number_format(amount,8,".",""),$scope.elAmount.val(amount)}if(void 0!=data.price){var price=parseFloat(data.price);price=number_format(price,8,".",""),$scope.elPrice.val(price)}$scope.recalc()});$scope.onDestroyF.push(dF);var dF1=$rootScope.$on("SET_SELL_PRICE",function(event,data){if(void 0!=data.price){var price=parseFloat(data.price);price=number_format(price,8,".",""),$scope.elPrice.val(price)}$scope.recalc()});$scope.onDestroyF.push(dF1),$rootScope.$on("PAIR_CHANGED",function(){$scope.toDefault(),$scope.setOstatok(),$scope.elPrice.val(0)}),$scope.walletInit=!1,$rootScope.$on("WALLETS_UPDATED",function(){0==$scope.walletInit&&($scope.setOstatok(),$scope.walletInit=!0)}),$scope.setOstatok=function(){var initOstatok=0;void 0!=User.id&&(initOstatok=UWallets.getBalance(TradePage.curr2)),$scope.elOstatok.text(initOstatok)},$scope.setOstatok(),$.each([$scope.elOstatok],function(){$(this).on("click touch",function(){var price=$scope.elPrice.val();if("string"==typeof price&&(price=price.replace(",",".")),("object"==typeof price||isNaN(price))&&(price=0),price>0){var amount=UWallets.getBalance(TradePage.curr2)/price;amount=number_format(amount,8,".",""),$scope.elOstatok.text(UWallets.getBalance(TradePage.curr2)-amount*price),("object"==typeof price||isNaN(price))&&(price=0),amount>0&&$scope.elAmount.val(amount),$scope.recalc()}})}),$scope.toDefault=function(){$scope.elAmount.val(0),$scope.elResult.text(0),$scope.elComission.text(0)},$scope.toDefault(),$.each([$scope.elAmount,$scope.elPrice],function(){$(this).on("keyup paste",function(e){setTimeout(function(){$scope.recalc(e)},100)})}),$scope.recalc=function(){var price=$scope.elPrice.val(),buyAmount=$scope.elAmount.val();price=TradePage.strReplaceZap(price),buyAmount=TradePage.strReplaceZap(buyAmount),price=parseFloat(price),buyAmount=parseFloat(buyAmount);var cv=buyAmount/100*$scope.comission,rv=price*buyAmount;(isNaN(cv)||isNaN(rv))&&(price=parseFloat(price),buyAmount=parseFloat(buyAmount),cv=price*buyAmount/100*$scope.comission,rv=price*buyAmount),cv=cv.toFixed(8),cv=parseFloat(cv),rv=rv.toFixed(8),rv=parseFloat(rv),("object"==typeof rv||isNaN(rv))&&(rv=0),("object"==typeof cv||isNaN(cv))&&(cv=0),rv=number_format(rv,8,".",""),cv=number_format(cv,8,".",""),$scope.elComission.text(cv),$scope.elResult.text(rv);var ostatok=UWallets.getBalance(TradePage.curr2)-rv;ostatok=number_format(ostatok,8,".",""),$scope.elOstatok.text(ostatok)},$element.find("#limit_buy").on("click touch",function(){$scope.$apply(function(){TradePage.checkAuth().then(function(){$scope.createOrder()})})}),$scope.createOrder=function(){var topSellPrice=null;null!=OrdersActive.top_price&&(topSellPrice=OrdersActive.top_price.sell);var buyPrice=TradePage.strReplaceZap($scope.elPrice.val());null!=topSellPrice&&buyPrice-topSellPrice>topSellPrice/100*10?Alert.question(tt("Buy price on your order")+" "+buyPrice+" "+TradePage.curr2+" "+tt("exceeds the minimum sell price")+" "+topSellPrice+" "+TradePage.curr2+" "+tt("by more than 10%. Are you sure you want to create order with given price?"),function(a){1==a&&$scope.createOrderRealBuy()}):$scope.createOrderRealBuy()},$scope.createOrderRealBuy=function(){var price=$scope.elPrice.val(),buyAmount=$scope.elAmount.val();price=TradePage.strReplaceZap(price),buyAmount=TradePage.strReplaceZap(buyAmount),Order.createComplexOrder({pair:TradePage.pair,type:"buy",quantity:buyAmount,price:price,sl:0},$scope,function(){$scope.toDefault()})}}).controller("ComplexSellCtrl",function($scope,$element,TradePage,Order,Settings,$rootScope,OrdersActive,Alert,UWallets){$scope.elAmount=$element.find("input[name=sellAmount]"),$scope.elPrice=$element.find("input[name=sellPrice]"),$scope.elResult=$element.find(".elTotal"),$scope.elComission=$element.find(".elComission"),$scope.elOstatok=$element.find(".elBalance"),$scope.elPrice.val(0),$scope.comission=Settings.comission,$scope.onDestroyF=[];var dF=$rootScope.$on("SET_SELL_PRICE",function(event,data){if(void 0!=data.amount){var amount=parseFloat(data.amount);amount=number_format(amount,8,".",""),$scope.elAmount.val(amount)}if(void 0!=data.price){var price=parseFloat(data.price);price=number_format(price,8,".",""),$scope.elPrice.val(price)}$scope.recalc()});$scope.onDestroyF.push(dF);var dF1=$rootScope.$on("SET_BUY_PRICE",function(event,data){if(void 0!=data.price){var price=parseFloat(data.price);price=number_format(price,8,".",""),$scope.elPrice.val(price)}$scope.recalc()});$scope.onDestroyF.push(dF1),$rootScope.$on("PAIR_CHANGED",function(){$scope.toDefault(),$scope.setOstatok(),$scope.elPrice.val(0)}),$scope.walletInit=!1,$rootScope.$on("WALLETS_UPDATED",function(){0==$scope.walletInit&&($scope.setOstatok(),$scope.walletInit=!0)}),$.each([$scope.elAmount,$scope.elPrice],function(){$(this).on("click touch",function(){"0"==$(this).val()&&$(this).val("")}).on("blur",function(){""==$(this).val()&&$(this).val("0")})}),$scope.setOstatok=function(){var initOstatok=0;void 0!=User.id&&(initOstatok=UWallets.getBalance(TradePage.curr1)),$scope.elOstatok.text(initOstatok)},$scope.setOstatok(),$scope.toDefault=function(){$scope.elAmount.val(0),$scope.elResult.text(0),$scope.elComission.text(0)},$scope.toDefault(),$.each([$scope.elOstatok],function(){$(this).on("click touch",function(){$scope.elOstatok.text(0),$scope.elAmount.val(UWallets.getBalance(TradePage.curr1)),$scope.recalc()})}),$.each([$scope.elAmount,$scope.elPrice],function(){$(this).on("keyup paste",function(e){setTimeout(function(){$scope.recalc(e)},100)})}),$scope.recalc=function(){var price=$scope.elPrice.val(),amount=$scope.elAmount.val();price=TradePage.strReplaceZap(price),amount=TradePage.strReplaceZap(amount),price=parseFloat(price),amount=parseFloat(amount);var cv=price*amount/100*$scope.comission,rv=price*amount;(isNaN(cv)||isNaN(rv))&&(amount=parseFloat(amount),cv=amount/100*$scope.comission,rv=price*amount),cv=cv.toFixed(8),cv=parseFloat(cv),rv=rv.toFixed(8),rv=parseFloat(rv),("object"==typeof rv||isNaN(rv))&&(rv=0),("object"==typeof cv||isNaN(cv))&&(cv=0),("object"==typeof amount||isNaN(amount))&&(amount=0),rv=number_format(rv,8,".",""),cv=number_format(cv,8,".",""),$scope.elComission.text(cv),$scope.elResult.text(rv);var ostatok=UWallets.getBalance(TradePage.curr1)-parseFloat(amount);ostatok=number_format(ostatok,8,".",""),$scope.elOstatok.text(ostatok)},$element.find("#limit_sell").on("click touch",function(){$scope.$apply(function(){TradePage.checkAuth().then(function(){$scope.createOrder()})})}),$scope.createOrder=function(){var topBuyPrice=void 0;void 0!=OrdersActive.top_price&&void 0!=OrdersActive.top_price.buy&&(topBuyPrice=OrdersActive.top_price.buy);var sellPrice=TradePage.strReplaceZap($scope.elPrice.val());void 0!=topBuyPrice&&topBuyPrice-sellPrice>topBuyPrice/100*10?Alert.question(tt("Sell price on your order")+" "+sellPrice+" "+TradePage.curr2+" "+tt("is less than the current maximum buy price")+" "+topBuyPrice+" "+TradePage.curr2+tt(". If you create this order the transaction will be made at your price(")+sellPrice+" "+TradePage.curr2+tt("). Create this order?"),function(a){1==a&&$scope.createOrderReal()}):$scope.createOrderReal()},$scope.createOrderReal=function(){var price=$scope.elPrice.val(),amount=$scope.elAmount.val();price=TradePage.strReplaceZap(price),amount=TradePage.strReplaceZap(amount),Order.createComplexOrder({pair:TradePage.pair,type:"sell",quantity:amount,sl:0,price:price},$scope,function(){$scope.toDefault()})}}),angular.module("IO",[]).service("IO",function($rootScope,$http,UWallets,Alert){var self=this;self.arCurr=[],self.deposite_settings=[],self.withdraw_settings=[],self.forms=[],self.getCurrDesc=function(name){return Settings.currencies&&void 0!=Settings.currencies[name]?" ("+Settings.currencies[name].description+")":""},self.replaceComma=function($el){if(null!=$el&&"function"==typeof $el.val){var str=$el.val();"function"==typeof str.indexOf&&str.indexOf(",")>-1&&$el.val(str.replace(",","."))}},self.createTask=function($scope,$element,POST,elSumma,elPoluchaete){return new Promise(function(resolve,reject){app.SignedRequest("/ctrl/withdrawAdd",POST,function(resp){1==resp.success?(Alert.msg(tt("Withdrawal request successfully created, further instructions have been sent to your e-mail address")),elSumma.val(0),elPoluchaete&&elPoluchaete.val(0)):Alert.msg(resp.error),resolve(resp)},function(error){reject(error),Alert.msg(tt("Error 10342: Server problem"))},function(){reject()})})},self.init=function(cb){$http.post("/ctrl/IOSettings",{csrf_token:app.csrf_token}).success(function(resp){1==resp.success&&(self.arCurr=resp.data.arCurr,self.forms=resp.data.forms,self.deposite_settings=resp.data.deposite_settings,self.withdraw_settings=resp.data.withdraw_settings,self.wt_providers=resp.data.wt_providers,self.wt_out_providers=resp.data.wt_out_providers,self.accounts=resp.data.accounts,$rootScope.$broadcast("WALLET_SETTINGS_INIT"),"function"==typeof cb&&cb())})},self.isCrypta=function(curr){return!(!Settings.currencies||void 0==Settings.currencies[curr])&&!Settings.currencies[curr].isFiat},self.getBalance=function(name){return UWallets.getBalance(name)},self.getBalanceB=function(name){return Utils.formatProbels(UWallets.getBalance(name))},self.formulaSumma2Pol=function(providerId,summa,cb){if(summa<=0||void 0==cb)return void cb(0);$http.post("/ctrl/IOSettings/calcNeedBasedOnAmount",{csrf_token:app.csrf_token,provider_id:providerId,amount:summa}).success(function(resp){1==resp.success&&cb(resp.data.need)}).error(function(){cb(0)})},self.formulaPol2Summa=function(providerId,pol,cb){if(pol<=0||void 0==cb)return void cb(0);$http.post("/ctrl/IOSettings/calcAmountBasedOnNeed",{csrf_token:app.csrf_token,provider_id:providerId,need:pol}).success(function(resp){1==resp.success&&cb(resp.data.amount)}).error(function(){cb(0)})},self.isWTProvider=function(name){return void 0!=self.wt_providers[name]},self.isWTOutProvider=function(name){return void 0!=self.wt_out_providers[name]},self.getProvider=function(curr,direction,id){if("deposit"==direction){for(var i in self.deposite_settings[curr])if(self.deposite_settings[curr][i].id==id)return self.deposite_settings[curr][i]}else for(var i in self.withdraw_settings[curr])if(self.withdraw_settings[curr][i].id==id)return self.withdraw_settings[curr][i]},self.getWithdrawProviderByName=function(name){for(var i in self.withdraw_settings)for(var j in self.withdraw_settings[i])if(self.withdraw_settings[i][j].name==name)return self.withdraw_settings[i][j]},self.generateAccountsList=function($element,provider){var provider_name=provider.name,currency=provider.curr,account_select=$element.find(".account_select");account_select.empty();var item,cnt=0;for(var i in self.accounts)void 0!==(item=self.accounts[i])&&item.cname==currency&&item.provider==provider_name&&cnt++;if(cnt>0){var list=[];for(i in self.accounts)item=self.accounts[i],item.cname==currency&&item.provider==provider_name&&list.push({value:item.id,title:item.name});(new Select).init(account_select,{scrollable:!1,title:tt("My Accounts"),onSelect:function(id){$element.find("[name=save_to_ab]").prop("checked",!1),$element.find("[name=save_to_ab]").attr("value",!1),$element.find(".ab_acc_name_block").hide(),$element.find("[name=ab_acc_name]").val("");var fieldValue,field,item=self.getAccountsById(id);for(var fieldName in item.fields)fieldValue=item.fields[fieldName],field=$element.find('input[name="'+fieldName+'"]'),field.val("").val(fieldValue),"hidden"==field.attr("type")&&field.trigger("change")},items:list}),$element.find(".accounts_block").show()}else $element.find(".accounts_block").hide()},self.getAccountsById=function(id){for(var i in self.accounts)if(self.accounts[i].id==id)return self.accounts[i]},self.generateProvidersList=function(providersBlock,currency,direction,disabled){providersBlock.empty();var sList=self.deposite_settings;"withdraw"==direction&&(sList=self.withdraw_settings);var imgId,ss="",count=0;for(i in sList[currency]){var item=sList[currency][i];imgId=item.id;var name=item.second_name||item.name;0==count?ss+='<div class="exch_paysys_row">':count%3==0&&(ss+='</div><div class="exch_paysys_row">');var isExcode=!!~[1e4,10001].indexOf(imgId),imagePath=isExcode?"/static/img/providers/"+imgId+".png":"/ctrl/providerImage?id="+imgId,disable=disabled?"disabled":"";ss+='<label class="exch_paysys_item" for="provider_'+item.id+'" '+disable+'>   <input id="provider_'+item.id+'" class="hide provider_radio" type="radio" name="'+direction+"_provider_"+currency+'" value="'+item.id+'"/>   <span class="exch_paysys_check_inner">       <span class="exch_paysys_check_text provider_name" name="'+name+'">'+name+'</span>       <span class="exch_paysys_check_img" style="background-image: url('+imagePath+')"></span>   </span></label>',count++}ss+="</div>",providersBlock.append(ss)},self.updateProviderInfoPanel=function($element,provider,title){$element.empty();var tpl="";provider.important_comment&&(tpl+=div(p(provider.important_comment),"error_msg mb_small"));var list=[];provider.min>0&&list.push(li([tt("Minimum"),number_format(provider.min,8,".",""),provider.curr].join(" "))),provider.max>0&&list.push(li([tt("Maximum"),number_format(provider.max,8,".",""),provider.curr].join(" "))),provider.comission_desc.length>0&&list.push(li([tt("Fee"),provider.comission_desc].join(" "))),provider.comment.length>0&&list.push(li(provider.comment)),list.length>0&&(title&&(tpl=p(title,"repl_col_text")+tpl),tpl+='<div class="wallet_col_war">                            <div class="exch_paysys_description">'+ul(list.join(""),"exch_paysys_description_list")+"</div>                        </div>",$element.html(tpl))},self.loadWTSettings=function(provider,el,curr,scope){el.find(".wire_loader").show(),el.find(".wire_content").hide(),el.find(".wire_error").hide(),$rootScope.$broadcast("WALLET_DISABLE_PAYSYS_LIST"),$http.post("/ctrl/balancePage2WTSettings",{csrf_token:app.csrf_token,provider:provider,curr:curr}).success(function(resp){1==resp.success?(el.find(".wire_info").html(resp.data.html),el.find(".wire_comment").html(resp.data.comment),scope.current_wt_order=resp.data.order,scope.current_wt_provider=provider,scope.url_hash=resp.data.hash,el.find(".wire_content").show()):(el.find(".wire_error").html(resp.error),el.find(".wire_error").show()),el.show(),el.find(".wire_loader").hide(),$rootScope.$broadcast("WALLET_ENABLE_PAYSYS_LIST")})},self.loadWTOutSettings=function(provider,element,currency){$http.post("/ctrl/wallet_wireout_settings",{csrf_token:app.csrf_token,provider:provider,curr:currency}).success(function(resp){if(1==resp.success){element.html(resp.data.html);var countries=Object.keys(resp.data.countries).map(function(key){return{value:key,title:resp.data.countries[key]}});element.find(".country_select").each(function(){var countrySelect=$(this),title=countrySelect.attr("data-title"),name=countrySelect.attr("data-name"),input=$('<input name="'+name+'" type="hidden"/>');element.append(input),(new Select).init(countrySelect,{title:title,onSelect:function(id){input.attr("value",id)},items:countries})})}else Alert.msg(resp.error)})},self.createForm=function(provider,direction,element){var provider_name=provider.name,form=self.forms[direction][provider_name],dynamic_element=element.find(".dynamic_form");if(dynamic_element.empty(),provider.need_verify_card&&void 0!==provider.verified_cards){var inputData=provider.verified_cards.map(function(value){return{value:value,title:value}});self.generateFormElement({visible:!0,type:"select",name:"verified_payment_card",value:"",label:"Verified payment card",title:"choose a payment card",data:inputData},dynamic_element)}if(form&&"form"==form.type){form.fields.forEach(function(field){return self.generateFormElement(field,dynamic_element)});var func=self.toSnakeCase(provider_name+"_"+direction);void 0==window.providers&&(window.providers=[]),void 0==window.providers[func]&&form.scripts&&element.append('<script>window["providers"]["'+func+'"]='+form.scripts+";<\/script>"),void 0!=window.providers[func]&&window.providers[func](element,app)}else self.isWTOutProvider(provider_name)&&"withdraw"==direction&&self.loadWTOutSettings(provider_name,dynamic_element,provider.currency)},self.generateFormElement=function(field,element){var visible=field.visible?"":'style="display: none;"',id=self.uniqueID(10);switch(field.type){case"text":element.append('<div class="row trade_row" data-element-name="'+field.name+'" '+visible+'>                                <label class="col span5 trade_label" for="'+id+'">'+tt(field.label)+'</label>                                <input class="col span7 input_focus bg_white" id="'+id+'" type="text" name="'+field.name+'">                            </div>');break;case"hidden":element.append('<input type="'+field.type+'" name="'+field.name+'" value="'+field.value+'"/>');break;case"select":element.append('<div class="row trade_row" data-element-name="'+field.name+'" '+visible+'>                                        <label class="col span5 trade_label">'+tt(field.label)+'</label>                                        <div class="col span7" id="'+id+'"></div>                                    </div>'),element.find("#"+id).each(function(){var countrySelect=$(this),title=tt(field.title),data=[],makeSelect=function(inputData){var input=$('<input type="hidden" name="'+field.name+'">');element.append(input),(new Select).init(countrySelect,{title:title,onSelect:function(id){input.attr("value",id)},items:inputData})};field.dataSource?$http.post(field.dataSource,{csrf_token:app.csrf_token}).success(function(response){1==response.success?(response.data.items&&(data=response.data.items),response.data.countries&&(data=Object.keys(response.data.countries).map(function(key){return{value:key,title:response.data.countries[key]}})),makeSelect(data)):Alert.msg(response.error)}):(void 0!==field.data?data=field.data:field.options&&Object.keys(field.options).length>0&&(data=Object.keys(field.options).map(function(key){return{value:key,title:field.options[key]}})),makeSelect(data))})}},self.uniqueID=function(length){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,length)},self.toSnakeCase=function(string){return string=string||"",string=string.toString(),string=string.trim(),string=string.replace(/([a-z\d])([A-Z]+)/g,"$1_$2"),string=string.replace(/[-\s]+/g,"_").toLowerCase()}}).controller("IODepositeCryptaCtrl",function($scope,$element,Alert,IO,$http,$rootScope){$scope.q=$element.find("#qrcode"),$scope.addr=null,$scope.invoice=null,$rootScope.$on("SHOW_FORM_CRYPT-DEPOSIT",function(event,data){$scope.provider=data.provider,$scope.loadAddr()}),$rootScope.$on("HIDE_FORM_CRYPT-DEPOSIT",function(){$scope.q.empty(),$element.find(".addr_copy_form").hide(),$element.find(".addr_btn_create").hide()});var clipboard=new Clipboard(".crypto_copy_btn"),notifications=new Notifications;notifications.init($(".notifications"),{title:tt("Data copied to clipboard")}),clipboard.on("success",function(){notifications.show()}),clipboard.on("error",function(){btn_copy.attr("disabled",!0),btn_copy.text(tt("Use Control+C"))}),$scope.showForm=function(type){"create"==type?($element.find(".addr_copy_form").hide(),$element.find(".addr_btn_create").show(),$("#info").prepend('<p class="repl_col_text" id="title-crypt-deposit">'+tt("Please, create wallet address to deposit your account")+"</p>")):($element.find(".addr_btn_create").hide(),$element.find(".addr_copy_form").show(),$element.find("input[name=address]").val($scope.addr),$element.find("input[name=invoice]").val($scope.invoice),$scope.q.empty(),$scope.q.qrcode({width:200,height:200,text:$scope.addr}),$("#title-crypt-deposit").remove()),$element.find(".addr_btn_create").attr("disabled",!1)},$scope.createAddr=function(){$scope.in_progress||($scope.in_progress=!0,$http.post("/ctrl/cryptoAddressNew",{csrf_token:app.csrf_token,currency:$scope.provider.curr}).success(function(resp){1==resp.success?($scope.addr=resp.data.address,$scope.invoice=resp.data.invoice,$scope.showForm("copy")):Alert.msg(resp.error),$scope.in_progress=!1}))},$scope.loadAddr=function(){$scope.addr=null,$scope.invoice=null,void 0!=window.User.id&&$http.post("/ctrl/depositeAddrGet",{csrf_token:app.csrf_token,currency:$scope.provider.curr}).success(function(resp){if(1==resp.success){var addr=resp.data.address;0==addr.length?$scope.showForm("create"):($scope.addr=addr,$scope.invoice=resp.data.invoice,$scope.showForm("copy"))}})},$scope.getInvoiceTitle=function(){return $scope.provider?"XRP"===$scope.provider.name?ttt("Destination tag"):ttt("Invoice"):""},$scope.getInvoiceButtonTitle=function(){return $scope.provider?"XRP"===$scope.provider.name?ttt("copy destination tag"):ttt("copy invoice"):""}}).controller("IOWithdrawCryptaCtrl",function($scope,$element,Alert,$http,IO,$rootScope){$scope.IO=IO;var elSumma=$element.find("[name=amount]");elSumma.val(0);var elPoluchaete=$element.find("[name=result]");elPoluchaete.val("0");var elOstatok=$element.find("#withdraw_remain2"),elAddress=$element.find("[name=address]");$.each([elSumma,elPoluchaete],function(){$(this).on("click",function(){"0"==$(this).val()&&$(this).val("")}).on("blur",function(){""==$(this).val()&&$(this).val("0")})}),$element.find("[name=save_to_ab]").on("change",function(){$element.find(".ab_acc_name_block").toggle(this.checked),$(this).attr("value",this.checked)}),$scope.validate=function(){return elSumma.val()>0},$rootScope.$on("SHOW_FORM_CRYPT-WITHDRAW",function(event,data){$scope.provider=data.provider,IO.generateAccountsList($element,$scope.provider),$scope.updateOstatok()}),$rootScope.$on("HIDE_FORM_CRYPT-WITHDRAW",function(){$scope.resetForm()}),$scope.resetForm=function(){elSumma.val(0),elPoluchaete.val("0"),elAddress.val("")},$scope.getOurComission=function(name){var c=0;for(var i in IO.withdraw_settings)if(i==name){var line=IO.withdraw_settings[i];for(var k in line)void 0!==line[k]&&(c=line[k].comission+line[k].comission_fix);break}return c},$scope.getComment=function(name){var c="";for(var i in IO.withdraw_settings)if(i==name){var line=IO.withdraw_settings[i];for(var k in line)void 0!==line[k]&&(c=line[k].comment)}return c},$scope.updateOstatok=function(){var ost=IO.getBalance($scope.provider.curr);isNaN(elSumma.val())||(ost-=parseFloat(elSumma.val())),ost=number_format(ost,8,".",""),ost=Utils.formatProbels(ost),elOstatok.val(ost)},elSumma.on("keyup",function(){IO.replaceComma($(this)),$scope.updateOstatok();var p=new Big(0),sum=elSumma.val();!isNaN(sum)&&sum.length>0&&(p=new Big(sum)),p=p.minus(new Big($scope.getOurComission($scope.provider.curr))),p=number_format(p.toFixed(8),8,".",""),p<0&&(p=0),elPoluchaete.val(p)}),elPoluchaete.on("keyup",function(){IO.replaceComma($(this));var s=new Big(0),youGet=elPoluchaete.val();!isNaN(youGet)&&youGet.length>0&&(s=new Big(youGet)),s=s.plus(new Big($scope.getOurComission($scope.provider.curr))),s=number_format(s.toFixed(8),8,".",""),elSumma.val(s),$scope.updateOstatok()}),$scope.addWithdraw=function(){if(!$scope.in_progress){$scope.in_progress=!0;var POST={};POST.csrf_token=app.csrf_token,POST.amount=elSumma.val(),POST.currency=$scope.provider.curr,POST.provider=$scope.provider.name,POST.action="check";for(var el,inputs=$element.find("input"),i=0;i<inputs.length;i++)el=$(inputs[i]),el.attr("name")&&(POST[el.attr("name")]=el.val());IO.createTask($scope,$element,POST,elSumma,elPoluchaete).then(function(response){$scope.in_progress=!1,1==response.data.account_added&&($element.find("[name=save_to_ab]").prop("checked",!1),$element.find("[name=save_to_ab]").attr("value",!1),$element.find(".ab_acc_name_block").hide(),$element.find("[name=ab_acc_name]").val(""),IO.init(function(){IO.generateAccountsList($element,$scope.provider)}))},function(){$scope.in_progress=!1},function(){$scope.in_progress=!1})}}}).controller("IODepositeCtrl",function($scope,$http,$element,$rootScope,Alert,IO){var elSumma=$element.find("#buy_amount"),wire=$element.find(".wire_settings"),deposit=$element.find(".deposit");elSumma.val(0),$.each([elSumma],function(){$(this).on("click",function(){"0"==$(this).val()&&$(this).val("")}).on("blur",function(){""==$(this).val()&&$(this).val("0")})}),$rootScope.$on("SHOW_FORM_DEPOSIT",function(event,data){wire.hide(),deposit.hide(),$scope.provider=data.provider,IO.isWTProvider($scope.provider.name)?(wire.show(),IO.loadWTSettings($scope.provider.name,$element,$scope.provider.curr,$scope)):deposit.show()}),$scope.validate=function(){return elSumma.val()>0},$scope.doDeposite=function(){if(!$scope.in_progress){$scope.in_progress=!0;for(var el,summa=elSumma.val(),params={},inputs=$element.find("input"),i=0;i<inputs.length;i++)el=$(inputs[i]),params[el.attr("name")]=el.val();$http.post("/ctrl/fiat_deposite",{csrf_token:app.csrf_token,currency:$scope.provider.curr,provider:$scope.provider.name,summa:summa,params:params}).success(function(resp){if(1==resp.success){if(void 0!=resp&&void 0!=resp.data&&void 0!=resp.data.action)switch(resp.data.action){case"show_message":return Alert.msg(tt(resp.data.message)),void($scope.in_progress=!1);case"redirect":return void(window.location.href=resp.data.url);case"submit_form":$("body").append("<div id='resp_submit_form'></div>");var form_wrapper=$("#resp_submit_form");return form_wrapper.children().remove(),form_wrapper.append(resp.data.form),void form_wrapper.find("form").submit();case"render_html":return $.ajaxPrefilter("script",function(options){options.cache=!0}),void deposit.html("<div id='rendered_html'>"+resp.data.html+"</div>")}Alert.msg(tt("Error 10343: Internal error"))}else $scope.in_progress=!1,Alert.msg(resp.error)}).error(function(){$scope.in_progress=!1,Alert.msg(tt("Error 10344: Server problem"))})}}}).controller("IOWithdrawCtrl",function($scope,$element,$rootScope,Alert,$http,IO){var elSumma=$element.find("[name=amount]");elSumma.val(0);var elPoluchaete=$element.find("[name=result]");elPoluchaete.val("0");var elOstatok=$element.find("#withdraw_remain");$.each([elSumma,elPoluchaete],function(){$(this).on("click",function(){"0"==$(this).val()&&$(this).val("")}).on("blur",function(){""==$(this).val()&&$(this).val("0")})}),$element.find("[name=save_to_ab]").on("change",function(){$element.find(".ab_acc_name_block").toggle(this.checked),$(this).attr("value",this.checked)}),$rootScope.$on("SHOW_FORM_WITHDRAW",function(event,data){$scope.provider=data.provider,IO.generateAccountsList($element,$scope.provider)}),$scope.validate=function(){return elSumma.val()>0},$scope.recalcSumma=function(){$scope.updateOstatok(),IO.formulaSumma2Pol($scope.provider.id,elSumma.val(),function(val){elPoluchaete.val(val)})},elSumma.on("keyup",function(){IO.replaceComma($(this)),$scope.recalcSumma()}),$scope.recalcPoluchete=function(){IO.formulaPol2Summa($scope.provider.id,elPoluchaete.val(),function(val){elSumma.val(val),$scope.updateOstatok()})},elPoluchaete.on("keyup",function(){IO.replaceComma($(this)),$scope.recalcPoluchete()}),$scope.updateOstatok=function(){var ost=IO.getBalance($scope.provider.curr);isNaN(elSumma.val())||(ost-=parseFloat(elSumma.val())),ost=number_format(ost,8,".",""),ost=Utils.formatProbels(ost),elOstatok.val(ost)},$scope.validate=function(){return elSumma.val()>0},$scope.addWithdraw=function(){if(!$scope.in_progress){$scope.in_progress=!0;var POST={};POST.csrf_token=app.csrf_token,POST.amount=elSumma.val(),POST.currency=$scope.provider.curr,POST.provider=$scope.provider.name;for(var el,inputs=$element.find("input"),i=0;i<inputs.length;i++)el=$(inputs[i]),el.attr("name")&&(POST[el.attr("name")]=el.val());IO.createTask($scope,$element,POST,elSumma,elPoluchaete).then(function(response){$scope.in_progress=!1,1==response.data.account_added&&($element.find("[name=save_to_ab]").prop("checked",!1),$element.find("[name=save_to_ab]").attr("value",!1),$element.find(".ab_acc_name_block").hide(),$element.find("[name=ab_acc_name]").val(""),IO.init(function(){IO.generateAccountsList($element,$scope.provider)}))},function(){$scope.in_progress=!1})}}}).controller("IOLoadEXCodeCtrl",function($scope,IO,$http,Alert,$element){$scope.elCode=$element.find("input[name=code]"),$scope.load=function(){$http.post("/ctrl/excodeLoad",{csrf_token:app.csrf_token,code:$scope.elCode.val()}).success(function(resp){1==resp.success?($scope.elCode.val(""),Alert.msg(tt("EX-CODE successfully loaded [1]",[resp.data.codeAmount]))):Alert.msg(resp.error)}).error(function(){Alert.msg(tt("Error 10339: Server problem"))})},$scope.elCode.on("keydown",function(e){13==e.keyCode&&(e.target.blur(),$scope.load())})}).controller("IOCreateEXCodeCtrl",function($scope,IO,UWallets,$http,Alert,$element,$rootScope){var currencySelector=$element.find(".select-currency"),available=$element.find("[name=available]"),limit=$element.find("[name=limit]");$scope.allCurrencies=[],$scope.UWallets=UWallets,$scope.activeCurrency="BTC",$scope.elSumma=$element.find("input[name=summa]"),$rootScope.$on("SHOW_FORM_EXCODE-WITHDRAW",function(event,data){if($scope.provider=data.provider,limit.val($scope.provider.limits[$scope.activeCurrency]),available.val($scope.UWallets.getBalance($scope.activeCurrency)),0==$scope.allCurrencies.length){$scope.allCurrencies=UWallets.items.map(function(currency){return{title:currency.typename+IO.getCurrDesc(currency.typename),value:currency.typename}});(new Select).init(currencySelector,{scrollable:!0,title:$scope.activeCurrency,onSelect:function(currency){$scope.activeCurrency!=currency&&($scope.activeCurrency=currency,limit.val($scope.provider.limits[$scope.activeCurrency]),available.val($scope.UWallets.getBalance($scope.activeCurrency)))},items:$scope.allCurrencies})}}),$.each([$scope.elSumma],function(){$(this).on("click",function(){"0"==$(this).val()&&$(this).val("")}).on("blur",function(){""==$(this).val()&&$(this).val("0")})}),$scope.elSumma.on("keydown",function(e){return Utils.isNumber(e)}),$scope.elSumma.on("keyup",function(e){13==e.keyCode&&(e.target.blur(),$scope.createCode())}),$scope.validate=function(){return $scope.elSumma.val()>0},$scope.setCurrent=function(c){$scope.curr=c},$scope.createCode=function(){$scope.in_progress||($scope.in_progress=!0,IO.createTask($scope,$element,{csrf_token:app.csrf_token,currency:$scope.activeCurrency,amount:$scope.elSumma.val(),provider:"excode",address:"excode"},$scope.elSumma).then(function(){$scope.in_progress=!1},function(){$scope.in_progress=!1}))}}),angular.module("Updater",[]).service("Updater",function($rootScope,Settings,TradePage,$location){var self=this,centrifugeSubs={};self.prev_pair=void 0,self.reconnectPair=function(pair){Validator.isValid("pair",pair)&&self.prev_pair!=pair&&("pusher"==window.Settings.websocket_transport&&(console.log("Updater connect via Pusher to pair "+pair),self.pusher.unsubscribe("book_"+self.pair),self.pusher.unsubscribe("trades_"+self.pair),self.pair=pair,self.channels.stakani=self.pusher.subscribe("book_"+pair),self.channels.stakani.bind("update",function(data){data=$.parseJSON(data.data),$rootScope.$broadcast("SOCKET_MESSAGE",{channel:"stakani",msg:"REFRESH_STAKANI",data:data})}),self.channels.sdelki=self.pusher.subscribe("trades_"+pair),self.channels.sdelki.bind("update",function(data){data=$.parseJSON(data.data),$rootScope.$broadcast("SOCKET_MESSAGE",{channel:"sdelki",msg:"REFRESH_SDELKI",data:data})})),
"socket.io"==window.Settings.websocket_transport&&(console.log("Updater connect via socket.io to pair "+pair),void 0!=self.sio_books&&self.sio_books.off(),self.sio_books=io(window.Settings.socketio_server+"/book_"+pair),self.sio_books.on("update",function(data){data=$.parseJSON(data),$rootScope.$broadcast("SOCKET_MESSAGE",{channel:"stakani",msg:"REFRESH_STAKANI",data:data})}),void 0!=self.sio_trades&&self.sio_trades.off(),self.sio_trades=io(window.Settings.socketio_server+"/trades_"+pair),self.sio_trades.on("update",function(data){data=$.parseJSON(data),$rootScope.$broadcast("SOCKET_MESSAGE",{channel:"sdelki",msg:"REFRESH_SDELKI",data:data})})),"centrifugo"==window.Settings.websocket_transport&&(console.log("Updater connect via centrifugo to pair "+pair),null!=centrifugeSubs.book&&centrifugeSubs.book.unsubscribe(),null!=centrifugeSubs.trades&&centrifugeSubs.trades.unsubscribe(),centrifugeSubs.book=self.centrifuge.subscribe("book_"+pair,function(message){$rootScope.$broadcast("SOCKET_MESSAGE",{channel:"stakani",msg:"REFRESH_STAKANI",data:$.parseJSON(message.data)})}),centrifugeSubs.trades=self.centrifuge.subscribe("trades_"+pair,function(message){$rootScope.$broadcast("SOCKET_MESSAGE",{channel:"sdelki",msg:"REFRESH_SDELKI",data:$.parseJSON(message.data)})})),self.prev_pair=pair)},$rootScope.$on("PAIR_CHANGED",function(){self.reconnectPair(TradePage.pair)}),self.getChatRoom=function(){var room="en",rooms=["en","ru","zh","uk"],lang=Settings.lang;return-1!=rooms.indexOf(lang)&&(room=lang),"chat_"+room},self.init=function(){var room=self.getChatRoom();"pusher"==window.Settings.websocket_transport&&(self.pusher=new Pusher(window.Settings.pusher_key,{encrypted:!0}),self.channels=[],self.channels.rates=self.pusher.subscribe("ticker"),self.channels.rates.bind("update",function(data){data=$.parseJSON(data.data),$rootScope.$broadcast("SOCKET_MESSAGE",{channel:"ticker",data:data})}),self.channels.online=self.pusher.subscribe("online"),self.channels.online.bind("update",function(data){$rootScope.$broadcast("SOCKET_MESSAGE",{channel:"online",msg:data.message})}),self.channels.chat=self.pusher.subscribe(room),self.channels.chat.bind("update",function(data){$rootScope.$broadcast("SOCKET_MESSAGE",{channel:room,msg:data.message})}),self.channels.server_time=self.pusher.subscribe("server_time"),self.channels.server_time.bind("update",function(data){$rootScope.$broadcast("SOCKET_MESSAGE",{channel:"server_time",msg:data.message})}),void 0!=window.User.id&&(self.channels.user=self.pusher.subscribe("user_"+window.User.id),self.channels.user.bind("update",function(data){var p=data;p=void 0!=p.message?p.message:p[0],$rootScope.$broadcast("SOCKET_MESSAGE",{channel:"user",msg:p})}))),"socket.io"==window.Settings.websocket_transport&&(self.sio_rates=io(window.Settings.socketio_server+"/ticker"),self.sio_rates.on("update",function(data){data=$.parseJSON(data),$rootScope.$broadcast("SOCKET_MESSAGE",{channel:"ticker",data:data})}),self.sio_online=io(window.Settings.socketio_server+"/online"),self.sio_online.on("update",function(data){$rootScope.$broadcast("SOCKET_MESSAGE",{channel:"online",msg:data.data})}),self.sio_chat=io(window.Settings.socketio_server+"/"+room),self.sio_chat.on("update",function(data){$rootScope.$broadcast("SOCKET_MESSAGE",{channel:room,msg:data.data})}),self.sio_time=io(window.Settings.socketio_server+"/server_time"),self.sio_time.on("update",function(data){$rootScope.$broadcast("SOCKET_MESSAGE",{channel:"server_time",msg:data.data})}),void 0!=window.User.id&&(self.sio_user=io(window.Settings.socketio_server+"/user_"+window.User.id),self.sio_user.on("update",function(data){void 0==data.data&&(data.data=data[0]),$rootScope.$broadcast("SOCKET_MESSAGE",{channel:"user",msg:data.data})}))),"centrifugo"==window.Settings.websocket_transport&&(self.centrifuge=new Centrifuge({url:window.Settings.centrifugo_url,user:window.Settings.centrifugo_user_id,timestamp:window.Settings.request_time,token:window.Settings.HMAC_token}),self.centrifuge.subscribe(room,function(message){$rootScope.$broadcast("SOCKET_MESSAGE",{channel:room,msg:message.data.data})}),self.centrifuge.subscribe("ticker",function(message){$rootScope.$broadcast("SOCKET_MESSAGE",{channel:"ticker",data:$.parseJSON(message.data)})}),self.centrifuge.subscribe("online",function(message){$rootScope.$broadcast("SOCKET_MESSAGE",{channel:"online",msg:message.data.data})}),self.centrifuge.subscribe("server_time",function(message){$rootScope.$broadcast("SOCKET_MESSAGE",{channel:"server_time",msg:message.data.data})}),self.centrifuge.subscribe("user_"+window.Settings.centrifugo_user_id,function(message){void 0==message.data.data&&(message.data.data=message.data[0]),$rootScope.$broadcast("SOCKET_MESSAGE",{channel:"user",msg:message.data.data})}),self.centrifuge.connect()),void 0!=$location.search().pair?self.reconnectPair($location.search().pair):self.reconnectPair("BTC_RUB")}}),angular.module("Messages",[]).service("Messages",function($http,Alert,$rootScope){var self=this,elInPaginator=$("#in_paginator"),elOutPaginator=$("#out_paginator"),inPaginator=null,outPaginator=null;self.viewMode="in",self.prevViewMode="in",self.inList=[],self.outList=[],self.total=0,self.inActivePage=1,self.outActivePage=1,self.itemsPerPage=7,self.unreadCount=0,self.currentMessage={},$rootScope.$on("SOCKET_MESSAGE",function(e,args){"REFRESH_MESSAGES"==args.msg&&self.refresh()}),$rootScope.$on("MESSAGES_REFRESH",function(){self.refresh()}),self.setActivePage=function(page){"in"==self.viewMode?self.inActivePage=page:self.outActivePage=page},self.getActivePage=function(){return"in"==self.viewMode?self.inActivePage:self.outActivePage},self.sendButtonState=function($text,$sendButton,otherFieldsValid){var text=$.trim($text.val()),dissableButton=!0;!0===otherFieldsValid&&text.length>0&&(dissableButton=!1),$sendButton.prop("disabled",dissableButton)},self.showCreatePopup=function(login){null==login&&(login=""),$("#form_name").val(login),$("#form_subject").val(""),$("#form_msg_text").val(""),$("#msg_new_container").show()},self.showMessagePopup=function(message){if(null==message||0===Object.keys(message).length&&message.constructor===Object)return void(self.currentMessage={});self.currentMessage=message,$("#form_answer").val("");var answerDisabled="out"===self.viewMode;$("#form_answer").prop("disabled",answerDisabled),$("#msg_incoming_container").show()},self.closeMessagePopup=function(){$("#msg_incoming_container").hide(),$("#msg_new_container").hide(),$("body").css("overflow","visible")},self.load=function(page){null==page&&(page=self.getActivePage()),self.setActivePage(page),$http.post("/ctrl/messagesList",{csrf_token:app.csrf_token,mtype:self.viewMode,page:page}).success(function(resp){if(1==resp.success){var maxPage=resp.data.pages;if(null!=maxPage&&page>maxPage&&page>1)return self.load(maxPage);var list=resp.data.list;if("in"==self.viewMode){self.inList=[];for(var i in list)self.inList.push(list[i])}else{self.outList=[];for(var i in list)self.outList.push(list[i])}self.total=resp.data.total,self.repaintPaginator()}})},self.del=function(id){$http.post("/ctrl/messagesDelete",{csrf_token:app.csrf_token,id:id,mtype:self.viewMode}).success(function(resp){1==resp.success?(self.load(self.getActivePage()),self.closeMessagePopup()):Alert.msg(resp.error)}).error(function(data,status,headers,config){Alert.msg(tt("Error 10156: Server problem"))})},self.refresh=function(){self.checkUnread(),self.load()},self.checkUnread=function(){$http.post("/ctrl/messagesUnreadCount",{csrf_token:app.csrf_token}).success(function(resp){1==resp.success&&(self.unreadCount=resp.data.cnt)})},self.repaintPaginator=function(){var paginator,elPaginator;"in"==self.viewMode?(paginator=inPaginator,elPaginator=elInPaginator):(paginator=outPaginator,elPaginator=elOutPaginator),null==paginator?(paginator=new Paginator,paginator.init(elPaginator,self.total,{perPage:self.itemsPerPage,onSelect:function(page){self.load(page)}})):paginator.updateTotal(self.total),"in"==self.viewMode?inPaginator=paginator:outPaginator=paginator}}).directive("msgsDir",function(Messages,$location){return function(scope,element,attrs){scope.tabs=element.find(".mode_switcher"),scope.tabs.on("click",function(e,k){"create"!=$(e.target).attr("type")?(scope.tabs.removeClass("btn_active"),$(e.currentTarget).addClass("btn_active"),scope.changeMode($(e.currentTarget).attr("type")),scope.closeCreateForm()):(Messages.prevViewMode=Messages.viewMode,scope.showCreateForm(),scope.tabs.removeClass("btn_active"),scope.changeMode($(e.target).attr("type")))}),void 0!=$_GET.target&&(Messages.prevViewMode="in",scope.showCreateForm($_GET.target),Messages.viewMode="create",scope.tabs.removeClass("btn_active"))}}).controller("MessagesListCtrl",function($scope,Messages,$http,Alert){$scope.Messages=Messages,$scope.showM=[],$scope.showA=[],Messages.load(),$scope.$on("$destroy",function(){$scope.tabs=null}),$scope.deleteMessage=function(id){$scope.showMessage(id),Messages.del(id)},$scope.showMessage=function(id){var list=$scope.getList();for(var i in list)if(list[i].id==id){Messages.showMessagePopup(list[i]),0==list[i].read&&($scope.markAsRead(id),list[i].read=1);break}},$scope.getList=function(){return $scope.total=Messages.total,"in"==Messages.viewMode?Messages.inList:Messages.outList},$scope.changeMode=function(mode){$scope.showM=[],$scope.showA=[],Messages.viewMode=mode,Messages.destroyPaginator=!0,"in"==Messages.viewMode?Messages.load():"out"==Messages.viewMode?Messages.load():$scope.$apply()},$scope.showCreateForm=function(login){Messages.showCreatePopup(login)},$scope.closeCreateForm=function(){Messages.closeMessagePopup()},$scope.markAsRead=function(id){$http.post("/ctrl/messagesMarkRead",{csrf_token:app.csrf_token,id:id}).success(function(resp){1==resp.success?Messages.checkUnread():Alert.msg(resp.error)}).error(function(data,status,headers,config){Alert.msg(tt("Error 10157: Server problem"))})}}).controller("MessageCreateCtrl",function($scope,$element,$http,$location,Alert,Messages,$rootScope){$scope.elLogin=$element.find("#form_name"),$scope.elSubject=$element.find("#form_subject"),$scope.elText=$element.find("#form_msg_text"),$scope.elSendButton=$element.find("#send_msg_new"),$scope.$on("$destroy",function(){$scope.elText.off("keydown"),$element.off("click touch",".popup_close, #cancel_msg_new"),$element.off("click touch",".popup"),$element.off("click touch"),$scope.elText.off("keyup"),$scope.elSubject.off("keyup"),$scope.elLogin.off("keyup"),$scope.elLogin=null,$scope.elSubject=null,$scope.elText=null,$scope.elSendButton=null}),$scope.sending=!1,$scope.send=function(e){null!=e&&e.preventDefault(),0==$scope.sending&&($scope.sending=!0,$http.post("/ctrl/messagesSend",{csrf_token:app.csrf_token,receiver:$scope.elLogin.val(),subject:$scope.elSubject.val(),text:$scope.elText.val()}).success(function(resp){1==resp.success?(Alert.msg(tt("Message successfully sent")),$scope.elLogin.val(""),$scope.elSubject.val(""),$scope.elText.val(""),$scope.closeCreateForm()):Alert.msg(resp.error),$scope.sending=!1,$rootScope.$emit("MESSAGES_REFRESH")}).error(function(data,status,headers,config){$scope.sending=!1,Alert.msg(tt("Error 10158: Server problem"))}))},$scope.sendButtonState=function(e){var otherFieldsState=!1,login=$.trim($scope.elLogin.val()),subj=$.trim($scope.elSubject.val());otherFieldsState=login.length>0&&subj.length>0,Messages.sendButtonState($scope.elText,$scope.elSendButton,otherFieldsState)},$scope.closeCreateForm=function(e){null!=e&&e.preventDefault(),Messages.viewMode=Messages.prevViewMode,$(".mode_switcher[type="+Messages.viewMode+"]").addClass("btn_active"),$rootScope.$broadcast("SOCKET_MESSAGE",{msg:"REFRESH_MESSAGES"}),Messages.closeMessagePopup()},$scope.init=function(){$scope.elText.on("keydown",function(e){if(13===e.keyCode&&e.ctrlKey)return e.preventDefault(),$scope.send(),!1}),$element.on("click touch",".popup_close, #cancel_msg_new",$scope.closeCreateForm),$element.on("click touch",$scope.closeCreateForm),$element.on("click touch",".popup",function(e){e.stopPropagation()}),$scope.elText.on("keyup",$scope.sendButtonState),$scope.elSubject.on("keyup",$scope.sendButtonState),$scope.elLogin.on("keyup",$scope.sendButtonState),$scope.elSendButton.on("click touch",$scope.send)},$scope.init()}).controller("MessagesFastAnswerCtrl",function($scope,$element,$http,$location,Alert,Messages){$scope.elText=$element.find("#form_answer"),$scope.elSendButton=$element.find("#send_msg"),$scope.elDeleteButton=$element.find("#delete_msg"),$scope.Messages=Messages,$scope.$on("$destroy",function(){$element.off("click touch",".popup_close"),$element.off("click touch",".popup"),$element.off("click touch"),$scope.elText.off("keyup"),$scope.elDeleteButton.off("click touch"),$scope.elText=null,$scope.elSendButton=null,$scope.elDeleteButton=null}),$scope.send=function(id,login,subject){null!=subject&&"Re:"!=subject.substring(0,3)&&(subject="Re:"+subject),$http.post("/ctrl/messagesSend",{csrf_token:app.csrf_token,receiver:login,subject:subject,text:$scope.elText.val()}).success(function(resp){1==resp.success?($scope.elText.val(""),Messages.closeMessagePopup(),Alert.msg(tt("Message successfully sent"))):Alert.msg(resp.error)}).error(function(data,status,headers,config){Alert.msg(tt("Error 10159: Server problem"))})},$scope.sendButtonState=function(e){Messages.sendButtonState($scope.elText,$scope.elSendButton,!0)},$scope.trySend=function(e){null!=e&&e.preventDefault();var message,id,login,subject;null!=(message=Messages.currentMessage)&&(id=message.id,login=message.from_login,subject=message.subject,null!=login&&null!=subject&&$scope.send(id,login,subject))},$scope.deleteCurrentMessage=function(e){e.preventDefault();var message=Messages.currentMessage,id=message.id;Messages.del(id)},$scope.init=function(){$element.on("click touch",".popup_close",Messages.closeMessagePopup),$element.on("click touch",Messages.closeMessagePopup),$element.on("click touch",".popup",function(e){e.stopPropagation()}),$scope.elText.on("keyup",$scope.sendButtonState),$scope.elSendButton.on("click touch",$scope.trySend),$scope.elDeleteButton.on("click touch",$scope.deleteCurrentMessage),$scope.elText.on("keydown",function(e){if(13===e.keyCode&&e.ctrlKey)return e.preventDefault(),$scope.trySend(),!1})},$scope.init()}),angular.module("Utm",[]).service("Utm",function($http){this.checkUtm=function(){if(location.href.indexOf("utm_source=")>-1){var send="",query=location.href.split("?");if(void 0!=query&&query.length>0)for(var i=0;i<query.length;i++)if(query[i].indexOf("utm_source")>-1){send=query[i];break}void 0!=query[1]&&$http.post("/ctrl/registerUtm",{url:send})}}}),angular.module("Referral",[]).service("Referral",function(){this.checkReferral=function(){var ref=Validator.getFromUrl("ref"),referrer=document.referrer;ref&&referrer.indexOf("yandex.")<0&&referrer.indexOf("google.")<0&&(document.cookie="ref = "+ref+";path=/")}}),angular.module("User",[]).service("User",function($http,$location,$timeout,$rootScope,SoundService,$interval){var self=this;self.id=void 0,self.lang="",self.login="",self.registered=!1,self.email="",self.need_check_new_trades=!1,self.change_settings=function(action,arValues){var params=[];void 0!=arValues&&(params=arValues),$http.post("/ctrl/changeSettings",{csrf_token:app.csrf_token,action:action,params:params})},self.init=function(){if(app.auth=!1,app.csrf_token="",void 0!=window.User.id){app.auth=!0;for(var i in window.User)self[i]=window.User[i];self.registered=!0,app.csrf_token=window.User.token,self.ping()}else console.log("User is not logged")},self.ping=function(){$http.post("/ctrl/ping",{csrf_token:app.csrf_token}),$timeout(function(){self.ping()},3e5)},self.monitNewTrades=function(){$interval(function(){self.checkNewTrades()},500)}(),self.checking=!1,self.checkNewTrades=function(){1!=self.checking&&0!=self.need_check_new_trades&&(self.need_check_new_trades=!1,1!=self.sound_disabled&&(self.checking=!0,$http.post("/ctrl/check_new_trades",{csrf_token:app.csrf_token}).success(function(resp){if(1==resp.success&&void 0!=resp.data.trades&&resp.data.trades.length>0){var msg,trades=resp.data.trades;for(var i in trades)msg="CHAT:system[*]"+trades[i].msg+"[*]",$rootScope.$broadcast("SOCKET_MESSAGE",{channel:"chat_"+self.lang,msg:msg});SoundService.playSound("dingdong")}self.checking=!1})))}}),angular.module("Sdelki",[]).service("Sdelki",function($http,TradePage,$timeout,$rootScope){var self=this;self.items=[],self.normalize=function(val){return Utils.limitFloatLength(val,10)},self.refresh=function(clear_before){void 0!=clear_before&&1==clear_before&&(self.html=""),$http.post("/ctrl/trades",{pair:TradePage.pair}).success(function(resp){1==resp.success&&(self.items=resp.data.items,$rootScope.$broadcast("TRADES_UPDATE"))})},$rootScope.$on("PAIR_CHANGED",function(){self.refresh(!0)})}).controller("SdelkiCtrl",function($scope,Sdelki,$element,$rootScope,TradePage){$scope.Sdelki=Sdelki,$scope.TradePage=TradePage,$scope.timeConverter=function(UNIX_timestamp){var localOffset=6e4*(new Date).getTimezoneOffset(),a=new Date(1e3*UNIX_timestamp+localOffset),month=a.getMonth()+1;month<10&&(month="0"+month);var date=a.getDate();date<10&&(date="0"+date);var hour=a.getHours();hour<10&&(hour="0"+hour);var min=a.getMinutes();return min<10&&(min="0"+min),'<span class="date">'+date+"."+month+"&nbsp;</span><span>"+hour+":"+min+"</span>"},$rootScope.$on("SOCKET_MESSAGE",function(e,args){"REFRESH_SDELKI"==args.msg&&$scope.$apply(function(){for(var i in args.data)if(i==TradePage.pair){var d=args.data[i];Sdelki.items=d}$scope.update()})}),$rootScope.$on("TRADES_UPDATE",function(){$scope.update()}),$scope.update=function(){var historyState=Sdelki.items&&0==Sdelki.items.length;$element.find(".no-information-trade-history").toggle(historyState)}}),angular.module("OrdersActive",[]).service("OrdersActive",function($http,TradePage,$timeout,$rootScope){var self=this;self.items_buy=void 0,self.items_sell=void 0,self.items_json=[],self.top_price=null,self.max_buy=void 0,self.max_sell=void 0,self.buy_itog=void 0,self.sell_itog=void 0,$rootScope.$on("PAIR_CHANGED",function(){self.init(!0)}),self.getMaxAmount=function(orders){var i,maxAmount=0;if(void 0!=orders&&null!=orders&&orders.length>0)for(i in orders){var amount=parseFloat(orders[i][1]);amount>maxAmount&&(maxAmount=amount)}return maxAmount},self.normalize=function(val){return Utils.limitFloatLength(val,10)},self.getBuyAmount=function(){var result=Utils.limitFloatLength(self.buy_itog,0);return isNaN(result)&&(result="0"),result},self.getSellAmount=function(){var result=Utils.limitFloatLength(self.sell_itog,0);return isNaN(result)&&(result="0"),result},self.init=function(clear_before){void 0!=clear_before&&1==clear_before&&(self.items_buy=void 0,self.items_sell=void 0,self.top_price=null),$http.post("/ctrl/book",{csrf_token:app.csrf_token,format:"html",pair:TradePage.pair}).success(function(resp){if(1==resp.success&&null!=resp.data&&resp.data.pair==TradePage.pair){var data=resp.data,orders=data.orders;null!=orders&&(self.items_buy=orders.buy,self.items_sell=orders.sell,self.itogi=data.itogi,self.top_price=data.top_price,self.items_json.bid=self.items_buy,self.items_json.ask=self.items_sell,self.max_buy=self.getMaxAmount(self.items_buy),self.max_sell=self.getMaxAmount(self.items_sell),void 0!=self.itogi&&(self.buy_itog=parseInt(self.itogi.bid_amount),self.sell_itog=parseInt(self.itogi.ask_quantity)))}$rootScope.$broadcast("ORDERS_ACTIVE_UPDATE")})}}).controller("OrdersActiveCtrl",function($scope,OrdersActive,$rootScope,$element,TradePage,$timeout){$scope.OrdersActive=OrdersActive,$scope.TradePage=TradePage,$element.on("click touchstart","td",function(e){for(var tr=$(e.target).closest("tr"),price=parseFloat(tr.find(".tcol_price").text()),amount=parseFloat(tr.find(".tcol_count").text()),prev=tr.prevAll(),i=0;i<prev.length;i++){var amnt=parseFloat($(prev[i]).find(".tcol_count").text());isNaN(amnt)&&(amnt=0),amount+=amnt}tr.hasClass("sell_order")&&$rootScope.$broadcast("SET_BUY_PRICE",{price:price,amount:amount}),tr.hasClass("buy_order")&&$rootScope.$broadcast("SET_SELL_PRICE",{price:price,amount:amount})}),$rootScope.$on("SOCKET_MESSAGE",function(e,args){"REFRESH_STAKANI"==args.msg&&$scope.$apply(function(){for(var i in args.data){var d=args.data[i];i==TradePage.pair&&(OrdersActive.items_buy=d.bid,OrdersActive.items_sell=d.ask,null!=OrdersActive.top_price&&(null!=d.bid_top&&(OrdersActive.top_price.buy=d.bid_top),null!=d.ask_top&&(OrdersActive.top_price.sell=d.ask_top)),OrdersActive.buy_itog=d.bid_amount,OrdersActive.sell_itog=d.ask_quantity)}OrdersActive.items_json.buy=OrdersActive.items_buy,OrdersActive.items_json.sell=OrdersActive.items_sell,OrdersActive.max_buy=OrdersActive.getMaxAmount(OrdersActive.items_buy),OrdersActive.max_sell=OrdersActive.getMaxAmount(OrdersActive.items_sell),$scope.update()})}),$rootScope.$on("ORDERS_ACTIVE_UPDATE",function(){$scope.update()}),$scope.update=function(){var sellState=OrdersActive.items_sell&&0==OrdersActive.items_sell.length,buyState=OrdersActive.items_buy&&0==OrdersActive.items_buy.length;$element.find(".no-information-sell-orders").toggle(sellState),$element.find(".no-information-buy-orders").toggle(buyState)},$scope.$on("$destroy",function(){$element.off("click"),OrdersActive.top_price=null})}),angular.module("OrdersMy",[]).service("OrdersMy",function($http,$timeout,TradePage,Order,Alert,$rootScope,User){var self=this;self.active=[],self.executed=[],$rootScope.$on("SOCKET_MESSAGE",function(e,args){"orders"==args.msg&&self.refresh()}),$rootScope.$on("REFRESH_MY_ORDERS",function(){self.refresh()}),$rootScope.$on("PAIR_CHANGED",function(){self.refresh(!0)}),self.refresh=function(clear){clear&&(self.active=[],self.executed=[]),$http.post("/ctrl/ordersMyActive",{csrf_token:app.csrf_token,pair:TradePage.pair}).success(function(resp){1==resp.success&&(self.active=resp.data.active),$rootScope.$broadcast("MY_ORDERS_ACTIVE_UPDATE")}),self.UpdateMyTrades()},self.UpdateMyTrades=function(){$http.post("/ctrl/ordersMyExecuted",{csrf_token:app.csrf_token,pair:TradePage.pair}).success(function(resp){1==resp.success&&(self.executed=resp.data.executed,User.need_check_new_trades=!0),$rootScope.$broadcast("MY_ORDERS_EXECUTED_UPDATE")})},self.cancelOrder=function(id){Order.cancel(id)},self.cancelAll=function(cancelType){return Order.cancelAll(cancelType,TradePage.pair),!1}}).controller("OrdersMyCancelCtrl",function($scope,$rootScope,$element,OrdersMy){var dropdown=null;$scope.cancelAll=function(cancelType){return OrdersMy.cancelAll(cancelType)},$scope.updateState=function(newState){dropdown&&dropdown.enabled(newState)},$scope.init=function(){0!=app.auth&&(dropdown=new Dropdown,dropdown.init($(".dropdown-menu"),{enabled:!1,title:tt("Cancel orders"),items:[{title:tt("All buy orders"),value:"buy"},{title:tt("All sell orders"),value:"sell"},{title:tt("All orders"),value:"all"}],onSelect:function(type){$scope.cancelAll(type)}}))},$scope.init(),$rootScope.$on("MY_ORDERS_ACTIVE_UPDATE_DROPDOWN",function(e,newState){$scope.updateState(newState)})}).controller("OrdersMyCtrl",function($scope,$rootScope,$element,OrdersMy){$scope.OrdersMy=OrdersMy,$scope.cancelOrder=function(id){return OrdersMy.cancelOrder(id)},$rootScope.$on("MY_ORDERS_ACTIVE_UPDATE",function(){$scope.update()}),$scope.update=function(){var emptyOrderList=OrdersMy.active&&0==OrdersMy.active.length;$element.find(".no-information-active-order").toggle(emptyOrderList),$rootScope.$emit("MY_ORDERS_ACTIVE_UPDATE_DROPDOWN",!emptyOrderList)}}).controller("OrdersExecutedCtrl",function($scope,$rootScope,$element,OrdersMy){$scope.OrdersMy=OrdersMy,$rootScope.$on("MY_ORDERS_EXECUTED_UPDATE",function(){$scope.update()}),$scope.update=function(){var executedState=OrdersMy.executed&&0==OrdersMy.executed.length;$element.find(".no-information-executed-order").toggle(executedState)}}).controller("OrdersMySwitcherCtrl",function($scope,$element,$rootScope){var elButtons=$element.find(".orders_my_btn"),elTabs=$element.find(".orders_my_unit");$scope.init=function(){elButtons.on("click",function(e){var $button=$(e.currentTarget),tabId=$button.data("tab-id");elButtons.removeClass("btn_active"),$button.addClass("btn_active"),elTabs.each(function(i,tab){var $tab=$(tab);$tab.data("tab-id")==tabId?$tab.show().addClass("active"):$tab.hide().removeClass("active")}),"active_orders"==tabId?$rootScope.$emit("MY_ORDERS_ACTIVE_UPDATE"):$rootScope.$emit("MY_ORDERS_ACTIVE_UPDATE_DROPDOWN",!1)})},$scope.init()}),angular.module("Chart",[]).controller("ChartCtrl",function($scope,Rates,TradePage,$rootScope,$http,$element,$timeout,Settings,$location,$q){$scope.elContent=$element.find(".chart_body"),$scope.Rates=Rates,$scope.TradePage=TradePage,$scope.period="week",$scope.priceChangeValue=0,$scope.priceChangeClass="";var $body=$("body"),isMobile=$body.hasClass("mod_mobile")||$body.hasClass("mod_tablet"),mobileWidth=0;isMobile&&(mobileWidth=window.screen.availHeight);var options={lang:"en",container_id:"tvChart",fullscreen:!1,mobile:isMobile&&mobileWidth<1200},dfd=$q.defer(),newChart=$location.search().newChart,chartDebugger=!!$location.search().cDebugger,chartType=+!!newChart;if(1!=Settings.canSwitchChart&&(chartType=1),0===chartType&&($scope.elTime=$element.find(".server_time"),$element.find("#chart_head").show()),1===chartType){var socketClient=null;"centrifugo"==window.Settings.websocket_transport&&(socketClient=new Centrifuge({url:window.Settings.centrifugo_url,user:window.Settings.centrifugo_user_id,timestamp:window.Settings.request_time,token:window.Settings.HMAC_token,resubscribe:!1,debug:chartDebugger}),socketClient.connect(function(){dfd.resolve()})),"pusher"==window.Settings.websocket_transport&&(socketClient=new Pusher(window.Settings.pusher_key,{encrypted:!0}),dfd.resolve()),$scope.isChartInit=!1,$scope.period=$scope.defaultPeriond="30";var datafeed=$scope.datafeed=new Datafeeds.UDFCompatibleDatafeed("/ctrl/chart",socketClient,chartDebugger)}$scope.getChart=function(para){var width=$scope.elContent.width(),height=$scope.elContent.height();return'<iframe src="/ctrl/getTemplate?name=main_big2&para='+para+"&period="+$scope.period+"&lang="+Settings.lang+"&release="+Settings.release+'" vspace="0px" scrolling="no" width="'+width+'px;" height="'+height+'px;"></iframe>'},$scope.priceValue=function(){return $scope.priceChangeValue=parseFloat(Rates.getPriceChange(TradePage.pair)),Math.abs($scope.priceChangeValue)},$scope.priceClass=function(){return isNaN($scope.priceChangeValue)&&($scope.priceChangeValue=0),0!==$scope.priceChangeValue&&($scope.priceChangeClass=$scope.priceChangeValue<0?" arrow_down_before":" arrow_up_before"),$scope.priceChangeClass},$scope.load=function(period){null!=period&&($scope.period=period);var para=TradePage.pair;if(0===chartType){$element.find(".btn_active").removeClass("btn_active"),$element.find(".period_"+$scope.period+" a").addClass("btn_active"),$scope.elContent.children().remove();var chartHtml=$scope.getChart(para);$scope.elContent.append(chartHtml)}1===chartType&&($("#tvChart").css("height",474),options.pair=para,options.period=$scope.period,options.debug=chartDebugger,initTradingViewChart(datafeed,options).then(function(widget){$scope.isChartInit=!0,$scope.chartWidget=widget,dfd.promise.then(function(){$scope.chartWidget.onChartReady($scope.setupChartWidget)})}))},$scope.setupChartWidget=function(){dfd.promise.then(function(){socketClient.subscribe("notifications",function(message){message.data&&message.data.need_restart&&($scope.chartWidget.activeChart().resetData(),datafeed.getUpdater().resetCache())})}),$scope.chartWidget.activeChart().onSymbolChanged().subscribe(null,function(newSymbol){TradePage.pair!==newSymbol.ticker&&$rootScope.$broadcast("TRADE_PAGE_CHANGE_PAIR",newSymbol.ticker)})},$scope.init=function(){0===chartType&&($rootScope.$on("SOCKET_MESSAGE",function(e,args){"server_time"==args.channel&&$scope.elTime.text(args.msg)}),$rootScope.$on("PAIR_CHANGED",function(e,args){$scope.load()})),1===chartType&&$rootScope.$on("PAIR_CHANGED",function(){$scope.isChartInit?$scope.chartWidget.setSymbol(TradePage.pair,$scope.period,function(){console.log("chart - switch to"+TradePage.pair)}):options.pair=TradePage.pair}),$scope.load()},$scope.init()}),angular.module("Rates",[]).service("Rates",function($http,TradePage){var self=this;self.items={},self.closePrices={},self.title="",self.last=0,self.low=0,self.high=0,self.average=0,self.volume=0,self.summa=0,self.flashItems={},self.fiatCurrencies=Object.keys(Settings.currencies).filter(function(currency){return Settings.currencies[currency].isFiat}),self.getDecimalLen=function(pair,fiatCurrencies){var decimalLength=8;return null==pair?decimalLength:(null==fiatCurrencies&&(fiatCurrencies=self.fiatCurrencies),Settings.pair_decimal_length[pair]&&(decimalLength=Settings.pair_decimal_length[pair]),+decimalLength)},self.getPriceChange=function(pairName){var priceChange=0,closePrice=parseFloat(self.closePrices[pairName])||0,currentPrice=0,pair=self.items[pairName];if(null!=pair&&(currentPrice=parseFloat(pair.buy_price)||0),0!==closePrice&&closePrice!==currentPrice){priceChange=(currentPrice-closePrice)/(closePrice/100)}return Utils.trimX(priceChange,2)},self.initFlashItems=function(){var pairName;for(pairName in self.items){var pair=self.items[pairName];self.flashItems[pairName]=parseFloat(pair.buy_price)}},self.showStatistics=function(){var items=self.items;for(var i in items)if(i==TradePage.pair){self.last=items[i].last,self.average=items[i].avg,self.volume=number_format(items[i].vol,0,"",""),self.summa=number_format(items[i].vol_curr,0,"","");var decimalLen=self.getDecimalLen(TradePage.pair);self.low=number_format(items[i].low,decimalLen,".",""),self.high=number_format(items[i].high,decimalLen,".","")}},self.updateTitle=function(m){var mode=m||"",currentPair=TradePage.pair;if(self.flashItems[currentPair]&&window.location.pathname.search(/^\/\w+\/trade$/i)>-1){var price=parseFloat(self.flashItems[currentPair]),decimalLen=self.getDecimalLen(currentPair);price=number_format(Utils.trimX(price,decimalLen),decimalLen,".",""),document.title=self.title+" "+price+mode+" "+currentPair.replace("_","https://exmo.com/")}};var updateLastTrades=function(ticker){if(null!=ticker){self.closePrices={};for(var pair in ticker){var lastTrade=0;null!=ticker[pair].close_buy_price&&(lastTrade=ticker[pair].close_buy_price),self.closePrices[pair]=lastTrade}}};self.init=function(){$http.get("/ctrl/ticker").success(function(resp){1==resp.success&&(self.items=resp.data.ticker,updateLastTrades(resp.data.ticker),self.initFlashItems(),self.showStatistics())})},self.init()}),angular.module("Chat",[]).service("Chat",function($rootScope,$http){var self=this;self.menuActive=!1,self.room=Settings.lang}).controller("ChatCtrl",function($scope,$element,Chat,$http,$compile,User,$timeout,Settings,Alert,$rootScope,$sanitize){function mousedown(e){if(wrapElem.classList.contains("chat_open"))return isDrag=!0,chartObject.css("pointer-events","none"),thumbCoords=getCoords(thumbElem),sliderCoords=getCoords(sliderElem),shiftX=e.pageX-thumbCoords.left,windowHeight=document.body.clientHeight,!1}function getCoords(elem){var box=elem.getBoundingClientRect();return{top:box.top+pageYOffset,left:box.left+pageXOffset}}function removeOld(messagesContainer){if(null!=messagesContainer){var msgs=messagesContainer.find(".chat_new_msg_unit");msgs.length>Settings.chat_max_msgs_in_window&&msgs.slice(0,msgs.length-Settings.chat_max_msgs_in_window).remove()}}function initChatScroll(){elContent.mCustomScrollbar({scrollInertia:3e3})}function checkSendState(e){$.trim(elEdit.val()).length}function chatOpen(){chat.removeClass("chat_close"),chat.addClass("chat_open"),store.set(KEY_CHAT_IS_OPEN,!0);var $body=$("body");!$body.hasClass("bg_white")&&$body.hasClass("mod_mobile")&&$body.addClass("bg_white"),chat.one("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(event){elContent.mCustomScrollbar("scrollTo","last",{scrollInertia:300})})}function initChatSettings(){
var storeX=store.get(KEY_CHAT_X),storeH=store.get(KEY_CHAT_H),shouldOpen=store.get(KEY_CHAT_IS_OPEN),chat_scroll_active=store.get(KEY_CHAT_SCROLL_ACTIVE),hasMobile=$("body").hasClass("mod_mobile");void 0!==shouldOpen&&($scope.shouldOpen=shouldOpen),hasMobile&&($scope.shouldOpen=!1),void 0!==chat_scroll_active&&($scope.stopScroll=chat_scroll_active,$scope.stopScroll?(iconScroll.addClass("active"),iconScroll.removeClass("scroll_active")):(iconScroll.removeClass("active"),iconScroll.addClass("scroll_active"))),hasMobile||(!isNaN(storeX)&&storeX>0&&document.body.clientWidth>storeX+maxWidth&&(thumbElem.style.left=storeX+"px"),!isNaN(storeH)&&storeH>0&&(elemHeight.style.height=storeH-headerHeight+"px"))}$scope.stopScroll=!1,$scope.User=User,$scope.Chat=Chat,$scope.shouldOpen=!0;var KEY_CHAT_IS_OPEN="chat_is_open",KEY_CHAT_X="chat_x",KEY_CHAT_H="chat_h",KEY_CHAT_SCROLL_ACTIVE="chat_scroll_active",sliderElem=$element.get(0),wrapElem=$element.find("#chat_wrap").get(0),elemHeight=$element.find("#chat_res_height").get(0),thumbElem=$element.children().get(0),chat=$element.find(".chat_new"),drag=$element.find("#chat_drag"),chatDrag=$element.find("#chat_drag"),chatOnlineDrag=$element.find("#online_drag"),chatHead=$element.find(".chat_new_head"),chatClose=$element.find("#btn_close_chat"),iconScroll=$element.find("#btn_autoscroll"),chatIconBell=$element.find(".icon-bell"),openMobile=$element.find("#open_chat_mobile"),mobileChat=$element.find(".mobile_chat_btn"),elOnline=$element.find(".online_cnt"),messages=$element.find("#chat_messages_list"),elContent=$element.find(".chat_new_body_content"),elEdit=$element.find(".msg_edit"),elSend=$element.find(".chat_new_send"),elMenu=$element.find(".settings_menu_block");$(elemHeight).on("mousewheel",function(e){var event=e.originalEvent,d=event.wheelDelta||-event.detail;this.scrollTop+=30*(d<0?1:-1),e.preventDefault()});var isDrag=!1,chartObject=$("#tvChart"),thumbCoords=getCoords(thumbElem),sliderCoords=getCoords(sliderElem),shiftX=0,windowHeight=document.body.clientHeight,headerHeight=124,maxWidth=330;$scope.menuMsgId=0,$scope.menuUser="",$rootScope.$on("SOCKET_MESSAGE",function(e,args){if(null!=args&&null!=args.msg){var text=args.msg;if(text.indexOf("ONLINE")>-1){var cnt=text.substring(text.indexOf("|")+1,text.length);cnt>0&&elOnline.text(cnt)}}}),$rootScope.$on("SOCKET_MESSAGE",function(e,args){if(null!=args&&null!=args.msg)if(args.msg.indexOf("CHAT:")>-1){var data=Utils.explode("[*]",args.msg.substring(5,args.msg.length));data=$scope.createMsg(data[0],data[1],data[2]),$scope.appendMsg(data)}else if(args.msg.indexOf("CHATRM:")>-1&&null!=messages){var msgId=args.msg.substring(7,args.msg.length);messages.find('.msg_unit[mid="'+msgId+'"]').remove()}}),$scope.hideChatMenu=function(){$scope.Chat.menuActive=!1,elMenu.hide()},$scope.showChatMenu=function(e){e.stopPropagation();var posPageX=$(".chat_new_body_content").offset().left,posPageY=$(".chat_new_body_content").offset().top,posX=e.pageX-posPageX+"px",posY=e.pageY-posPageY+"px",element=elMenu.detach();$(".chat_new_body_content").append(element);var user=$(e.target).parent().attr("mu"),msgId=parseInt($(e.target).parent().attr("mid"));"ban"!=user&&($scope.menuMsgId=msgId,$scope.menuUser=user),$scope.Chat.menuActive=!0,elMenu.show().css({left:posX,top:posY})},$scope.createMsg=function(user,msg,msgid){var loginStyle="",textStyle="";return"ban"==user||"admin"==user||"Support"==user||"Exmoney"==user||"system"==user?loginStyle+=" text_red":user==User.login&&(loginStyle+=" text_blue"),""!=User.login&&msg.indexOf(User.login)>-1&&(textStyle+=" text_blue"),msg?(msg=msg.replace(/([\\]+)/gi,""),msg=$sanitize(msg),msg=$scope.parseUser(msg),'<div class="chat_new_msg_unit" mu="'+user+'" mid="'+parseInt(msgid)+'"><span class="chat_new_msg_author'+loginStyle+'">'+user+"&nbsp;</span>"+$('<span class="chat_new_msg_text'+textStyle+'"></span>').html(msg).html()+"</div>"):""},$scope.parseUser=function(message){var rgx=/(\@[a-zA-Z0-9]+)+/gm;return message.replace(rgx,function(login){return'<span class="new_msg_text__replay"  data-login="'+login.replace("@","")+'" >'+login+"</span>"})},$scope.appendMsg=function(msg,userOptions){var options={scrollToLast:!0,scrollInertia:300,doUpdate:!0};$.extend(options,userOptions),null!=messages&&($scope.stopScroll&&(options.scrollToLast=!1),0==messages.length&&$timeout(function(){$scope.appendMsg(msg,options)},100),options.scrollToLast&&removeOld(messages),messages.append(msg),options.doUpdate&&elContent.mCustomScrollbar("update"),options.scrollToLast&&elContent.mCustomScrollbar("scrollTo","last",{scrollInertia:options.scrollInertia}))},$scope.contexMenuAnswer=function(user){var text="@"+user+", ";elEdit.focus(),elEdit.val(""),elEdit.val(text)},$scope.answer=function(user){var text=elEdit.val();-1==text.indexOf(user)&&(text="@"+user+", "+text),elEdit.focus(),elEdit.val(""),elEdit.val(text)},$scope.pmsg=function(user){window.location.href="/messages?target="+user},$scope.contextMenuClick=function(e){return e.preventDefault(),e.stopPropagation(),$scope.hideChatMenu(),$(e.target).hasClass("chat_reply")?void $scope.answer($scope.menuUser):$(e.target).hasClass("chat_private")?void $scope.pmsg($scope.menuUser):void 0},$scope.sendMsg=function(){var text=elEdit.val();text.length>0&&$http.post("/ctrl/chatSendMsg",{csrf_token:app.csrf_token,msg:text,room:Chat.room}).success(function(resp){1==resp.success?(elEdit.val(""),checkSendState()):Alert.msg(resp.error)}).error(function(){Alert.msg(tt("Error 10154: Server problem"))})},$scope.initData=function(){checkSendState(),$http.post("/ctrl/chatInit",{csrf_token:app.csrf_token,room:Chat.room}).success(function(resp){if(initChatSettings(),$element.show(),$scope.shouldOpen&&$timeout(chatOpen,1e3),1==resp.success){var list=resp.data.chat,msgs="";for(var i in list){var data=Utils.explode("[*]",list[i]);msgs+=$scope.createMsg(data[0],data[1],data[2])}$scope.appendMsg(msgs,{scrollInertia:0}),$scope.init(),initChatScroll()}}).error(function(){initChatScroll()})},$scope.init=function(){$(drag).on("mousedown",mousedown),$(chatOnlineDrag).on("mousedown",mousedown),document.addEventListener("mousemove",function(e){if(!isDrag)return!1;var newLeft=e.pageX-shiftX-sliderCoords.left,rightEdge=sliderElem.offsetWidth-thumbElem.offsetWidth,newTop=sliderCoords.top-e.pageY+60;newLeft<0&&(newLeft=0),newLeft>rightEdge&&(newLeft=rightEdge),thumbElem.style.left=newLeft+"px";var chatHeightLimit=$(".table_set_wrap").offset().top;newTop>windowHeight-chatHeightLimit&&(newTop=windowHeight-chatHeightLimit),newTop<220&&(newTop=220),elemHeight.style.height=newTop-headerHeight+"px",store.set(KEY_CHAT_X,newLeft),store.set(KEY_CHAT_H,newTop)},!0),document.addEventListener("mouseup",function(){isDrag=!1,chartObject.css("pointer-events","all")}),$(thumbElem).on("dragstart",function(){return!1}),chatHead.on("click touch",function(){chat.hasClass("chat_close")&&chatOpen()}),chatDrag.on("mousedown",function(){$(wrapElem).addClass("drag")}),chatDrag.on("mouseup",function(){$(wrapElem).removeClass("drag")}),chatOnlineDrag.on("mousedown",function(){$(wrapElem).addClass("drag")}),chatOnlineDrag.on("mouseup",function(){$(wrapElem).removeClass("drag")}),chatClose.on("click touch",function(event){chat.addClass("chat_close"),chat.removeClass("chat_open");var $body=$("body");$body.hasClass("bg_white")&&$body.removeClass("bg_white"),store.set(KEY_CHAT_IS_OPEN,!1),event.stopPropagation()}),chatIconBell.on("click touch",function(event){$(this).toggleClass("active"),0==User.sound_disabled?(User.sound_disabled=1,User.change_settings("sound_disabled")):(User.sound_disabled=0,User.change_settings("sound_enabled")),event.stopPropagation()}),openMobile.on("click touch",chatOpen),mobileChat.on("click touch",chatOpen),elEdit.on("keyup",checkSendState),messages.on("click touch",".chat_new_msg_author",$scope.showChatMenu),messages.on("click touch",".new_msg_text__replay",function(){void 0!==$(this).data("login")&&$scope.answer($(this).data("login"))}),elEdit.on("change keyup paste",function(){(this.value||"").trim().length?elSend.addClass("active"):elSend.removeClass("active")}),elEdit.on("keypress",function(e){13==e.which&&($scope.sendMsg(),e.preventDefault())}),elSend.on("click touch",function(e){e.preventDefault(),$scope.sendMsg()}),iconScroll.on("click touch",function(event){$scope.stopScroll?($(this).removeClass("active"),iconScroll.addClass("scroll_active"),$scope.stopScroll=!1):($(this).addClass("active"),iconScroll.removeClass("scroll_active"),$scope.stopScroll=!0),store.set(KEY_CHAT_SCROLL_ACTIVE,$scope.stopScroll),event.stopPropagation()}),$(".container").on("click touch",function(e){elMenu.hide()}),elMenu.on("click touch",$scope.contextMenuClick)},$scope.initData()}),angular.module("Settings",[]).service("Settings",function(){var self=this;if(self.chat_max_msgs_in_window=100,self.release=Math.random(),void 0!=window.Settings)for(var i in window.Settings)self[i]=window.Settings[i]}),angular.module("Alert",[]).service("Alert",function(){var self=this;self.elMsg=$("#popup_msg_container"),self.elQuestion=$("#popup_question_container"),self.elTotp=$("#popup_confirm_container"),self.elPwd=$("#popup_confirm_pwd_container"),self.show_message=!1,self.show_question=!1,self.show_totp=!1,self.show_pwd=!1,$("body").on("keydown",function(e){1==self.show_message&&(13==e.which&&(self.elMsg.hide(),self.elQuestion.hide(),setScrollableBody(),self.show_message=!1),e.preventDefault())}),self.qcallback=function(){},self.mcallback=function(){},self.totp_callback=function(){},self.pwd_callback=function(){},self.msg=function(text,callback,optional){self.elMsg.find(".modal_text").text(tt(text)),self.elMsg.find(".modal_text_optional").html(tt(optional)),self.show_message=!0,self.elMsg.show(),setUnscrollableBody(),self.mcallback=callback},self.totp=function(callback){self.elTotp.find("[name=kod]").val(""),self.show_totp=!0,self.elTotp.show(),setUnscrollableBody(),self.elTotp.find("[name=kod]").focus(),self.totp_callback=callback},self.pwd=function(callback){self.elPwd.find("[name=kod]").val(""),self.show_pwd=!0,self.elPwd.show(),setUnscrollableBody(),self.elPwd.find("[name=kod]").focus(),self.pwd_callback=callback},self.maction=function(){if("function"==typeof self.mcallback)self.mcallback();else if(void 0!=self.alert_msg){var msg=self.alert_msg+"";-1!=msg.indexOf("10011")&&(window.location.href=window.location.origin)}self.elMsg.hide(),setScrollableBody(),self.show_message=!1},self.question=function(text,callback,optional){self.elQuestion.find(".modal_text").text(tt(text)),self.elQuestion.find(".modal_text_optional").html(tt(optional)),self.qcallback=callback,self.show_question=!0,self.elQuestion.show(),setUnscrollableBody()},self.qaction=function(answ){"function"==typeof self.qcallback&&self.qcallback(answ),self.show_question=!1,self.elQuestion.hide(),setScrollableBody()},self.totp_action=function(answ){if(1!=answ)return self.show_totp=!1,self.elTotp.hide(),setScrollableBody(),void("function"==typeof self.totp_callback&&self.totp_callback(answ));0!=self.elTotp.find("[name=kod]").val().length&&("function"==typeof self.totp_callback&&self.totp_callback(answ,self.elTotp.find("[name=kod]").val()),self.show_totp=!1,self.elTotp.hide(),setScrollableBody())},self.pwd_action=function(answ){if(1!=answ)return self.show_pwd=!1,self.elPwd.hide(),setScrollableBody(),void("function"==typeof self.totp_callback&&self.pwd_callback(answ));0!=self.elPwd.find("[name=kod]").val().length&&("function"==typeof self.totp_callback&&self.pwd_callback(answ,self.elPwd.find("[name=kod]").val()),self.show_pwd=!1,self.elPwd.hide(),setScrollableBody())}}).controller("AlertCtrl",function($scope,Alert,$element){$scope.Alert=Alert,$scope.elCode=$element.find("input[name=kod]"),$scope.elCode.on("keydown",function(e){13==e.keyCode&&(e.target.blur(),$scope.Alert.totp_action(!0))})}),angular.module("NewsPage",[]).controller("NewsListCtrl",function($scope,$http,$location,$element){$scope.list=new NewsListConstructor,$scope.list.updateViewHandler=function(){$element.find("#more_news").toggle($scope.list.page<$scope.list.total_pages)},$scope.list.init($element),$scope.list.loadPage(),$scope.list.initCalendar($element),$scope.loadMore=function(){$scope.list.loadPage($scope.list.page+1)}}).controller("NewsViewCtrl",function($scope,$element){$scope.list=new NewsListConstructor,$scope.list.init($element),$scope.list.initCalendar($element),$scope.list.initImage($element)}),angular.module("ArticlesPage",[]).controller("ArticlesListCtrl",function($scope,$http,$location,$element){$scope.lang="en",$scope.load=function(page){var category="",path=location.pathname;if(void 0!==path&&""!=path){var pos=path.indexOf("https://exmo.com/articles/");pos<0&&(pos=3),pos+=10,category=path.slice(pos)}$http.post("/ctrl/articlesList",{csrf_token:app.csrf_token,page:page,lang:$scope.lang,uid:window.User.id,format:"html",category:category}).success(function(res){var data,title;void 0!=(data=res.data)&&(title=data.title,("string"!=typeof title||title.length<1)&&(title=tt("All Articles")),$element.find(".content_black_title").html(title),$element.find(".articles_box .article").remove(),$element.find(".articles_box").append(data.list),$element.find("#paginator").empty().append(data.paginator))})},$scope.init=function(lang){$scope.lang=lang;var page=parseInt($_GET.page,10);isNaN(page)&&(page=1),$scope.load(page)}}).controller("ArticleViewCtrl",function($scope,$element){}),angular.module("HistoryPage",[]).service("HistoryPage",function($http){var url={opened:"historyMyActive",canceled:"historyMyCanceled",deals:"historyMyExecuted"};this.load=function(type,limit,start){return new Promise(function(resolve,reject){$http.post("/ctrl/"+url[type],{csrf_token:app.csrf_token,limit:limit,start:start}).success(function(resp){1==resp.success?resolve(resp):reject(resp)})})}}).controller("HistoryPageCtrl",function($scope,$http,$element,$interval,$timeout,HistoryPage,$rootScope,Alert){var progress=$element.find(".progress"),no_information=$element.find(".no-information"),information=$element.find(".information");$scope.selectedGroup="opened",$scope.selectedPage=0,$scope.perPage=10,$scope.total=0,$scope.canceledOrders=[],$rootScope.$on("SOCKET_MESSAGE",function(e,args){args.msg}),$scope.cancelAll=function(cancelType){var textCancelType={buy:tt("all buy orders"),sell:tt("all sell orders"),all:tt("all orders")};Alert.question(tt("Do you really want to cancel [1]?",[textCancelType[cancelType]]),function(result){result&&$http.post("/ctrl/orderCancel/cancel",{csrf_token:app.csrf_token,cancelType:cancelType}).success(function(resp){1==resp.success?$scope.removeCancel():Alert.msg(resp.error)}).error(function(){Alert.msg(tt("Error 10171: Server problem"))})})},$scope.cancel=function(id){$http.post("/ctrl/orderCancel/cancel",{csrf_token:app.csrf_token,orderid:id}).success(function(resp){1==resp.success?$scope.removeCancel():Alert.msg(resp.error)}).error(function(){Alert.msg(tt("Error 10171: Server problem"))})},$scope.removeCancel=function(){"opened"==$scope.selectedGroup&&$scope.loadHistory($scope.selectedPage)},$scope.switchState=function(state){progress.toggle("in_progress"==state),no_information.toggle("no_information"==state),information.toggle("information"==state)},$scope.loadHistory=function(page){$scope.selectedPage=page,$scope.list=[],$scope.switchState("in_progress"),HistoryPage.load($scope.selectedGroup,$scope.perPage,$scope.selectedPage).then(function(resp){if(resp.data.list&&0==resp.data.list.length&&resp.data.total>0)return $scope.loadHistory($scope.selectedPage-$scope.perPage);$scope.list=resp.data.list,$scope.list&&0!=$scope.list.length||$scope.switchState("no_information"),$scope.total!=resp.data.total&&($scope.total=resp.data.total,$scope.paginator.updateTotal($scope.total))})},$scope.$on("ngRepeatFinished",function(){$scope.switchState("information")}),$scope.init=function(){(new ButtonGroups).init($("#button_group"),{selected:$scope.selectedGroup,buttons:[{title:tt("Opened Orders"),id:"opened"},{title:tt("Cancelled Orders"),id:"canceled"},{title:tt("Deals"),id:"deals"}],className:"btn btn_small",onSelect:function(id){$scope.selectedGroup=id,$scope.dropdown.enabled("opened"==id),$scope.paginator.updateTotal(0),$scope.loadHistory(0)}}),$scope.dropdown=new Dropdown,$scope.dropdown.init($(".dropdown-menu"),{title:tt("Cancel orders"),items:[{title:tt("All buy orders"),value:"buy"},{title:tt("All sell orders"),value:"sell"},{title:tt("All orders"),value:"all"}],onSelect:function(type){$scope.cancelAll(type)}}),$scope.paginator=new Paginator,$scope.paginator.init($("#paginator"),0,{perPage:10,onSelect:function(page){$scope.loadHistory((page-1)*$scope.perPage)}}),$scope.loadHistory(0)},$scope.init()}).directive("onFinishRender",function($timeout){return{restrict:"A",link:function(scope,element,attr){!0===scope.$last&&$timeout(function(){scope.$emit(attr.onFinishRender)})}}}),angular.module("ProfilePage",[]).service("ProfileWarn",function($http,Alert){var self=this,successHandler=function(url,params,success_cb,error_cb){return function(resp){"Error 10815"==resp.error?Alert.question(tt("Changing your profile data involves putting 'hold' on withdrawal operations during 3 days. Are you sure you want to apply changes?"),function(res){res&&(params.warn=1,$http.post(url,params).success(function(resp){success_cb(resp)}).error(function(data,status,headers,config){error_cb(data,status,headers,config)}))}):success_cb(resp)}},signedSuccessHandler=function(url,params,success_cb,error_cb){return function(resp,signedParams){"Error 10815"==resp.error?(null!=signedParams&&null!=signedParams.sign&&(params.sign=signedParams.sign),Alert.question(tt("Changing your profile data involves putting 'hold' on withdrawal operations during 3 days. Are you sure you want to apply changes?"),function(res){res&&(params.warn=1,app.SignedRequest(url,params,function(resp){success_cb(resp)},function(data,status,headers,config){error_cb(data,status,headers,config)}))})):success_cb(resp)}},errorHandler=function(error_cb){return function(data,status,headers,config){error_cb(data,status,headers,config)}};self.warnIfBlock=function(url,params,success_cb,error_cb){$http.post(url,params).success(successHandler(url,params,success_cb,error_cb)).error(errorHandler(error_cb))},self.signedWarnIfBlock=function(url,params,success_cb,error_cb){app.SignedRequest(url,params,signedSuccessHandler(url,params,success_cb,error_cb),errorHandler(error_cb))}}).controller("ProfileCtrl",function($scope){var configs={notifications:{title:tt("Notifications"),hold:!1},api:{title:tt("API"),hold:!1},ip:{title:tt("IP"),hold:!1},protection:{title:tt("Two-factor authentication"),hold:!1},access:{title:tt("User sessions"),hold:!1},password:{title:tt("Password"),hold:!0}};$scope.selected_config=null,$scope.getTitle=function(){return configs[$scope.mode].title},$scope.isActive=function(mode){return $scope.mode==mode?"sidebar_menu_active":"sidebar_menu_inactive"},$scope.setMode=function(mode){$scope.mode=mode,$scope.selected_config=configs[mode]},$scope.setMode("notifications")}).controller("ProfileGeneralCtrl",function($scope,$http,Alert){$scope.load=function(){$http.post("/ctrl/userProfile",{action:"get_general",csrf_token:app.csrf_token}).success(function(resp){if(1==resp.success){var data=resp.data;$scope.model={notify_interval:data.notify_interval||10,notify_deals:"1"==data.notify_deals,subscribe:"1"==data.subscribe},$scope.$watch("model.notify_interval",$scope.saveNotifyInterval),$scope.$watch("model.notify_deals",$scope.saveNotifyDeals),$scope.$watch("model.subscribe",$scope.saveSubscribe)}else Alert.msg(resp.error)}).error(function(){Alert.msg(tt("Error 10167: Server problem"))})},$scope.load(),$scope.saveNotifyInterval=function(newValue,oldValue){newValue!==oldValue&&(newValue<10||$scope.save())},$scope.saveNotifyDeals=function(newValue,oldValue){newValue!==oldValue&&$scope.save()},$scope.saveSubscribe=function(newValue,oldValue){newValue!==oldValue&&$scope.save()},$scope.save=function(){$scope.model.notify_interval<10&&($scope.model.notify_interval=10),$http.post("/ctrl/userProfile",{action:"save_general",csrf_token:app.csrf_token,model:$scope.model}).success(function(resp){1==resp.success?console.log(tt("Profile settings saved")):Alert.msg(resp.error)}).error(function(){Alert.msg(tt("Error 10162: Server problem"))})}}).controller("ProfilePasswordCtrl",function($scope,Alert,ProfileWarn){$scope.save=function(){0==User.auth_type?ProfileWarn.warnIfBlock("/ctrl/userProfile",{action:"change_password",csrf_token:app.csrf_token,password1:$scope.new_password,password2:$scope.new_password_confirm,old_password:$scope.old_password},function(resp){1==resp.success?Alert.msg(tt("Profile settings saved, please login again"),function(){window.location.href="/"}):Alert.msg(resp.error)},function(){Alert.msg(tt("Error 10162: Server problem"))}):ProfileWarn.signedWarnIfBlock("/ctrl/userProfile",{action:"change_password",csrf_token:app.csrf_token,password1:$scope.new_password,password2:$scope.new_password_confirm,old_password:$scope.old_password},function(resp){1==resp.success?Alert.msg(tt("Profile settings saved, please login again"),function(){window.location.href="/"}):Alert.msg(resp.error)},function(){Alert.msg(tt("Error 10162: Server problem"))})}}).controller("ProfileAPICtrl",function($scope,User,$http,Alert,$element){$scope.User=User,$scope.q=$element.find("#qrcode");var clipboard=new Clipboard(".button_copy"),notifications=new Notifications;notifications.init($(".notifications"),{title:tt("Copied to clipboard")}),clipboard.on("success",function(){notifications.show()}),clipboard.on("error",function(e){$(e.trigger).attr("disabled",!0),$(e.trigger).text(tt("Use Control+C"))}),$scope.load=function(){$http.post("/ctrl/userProfile",{action:"api_get",csrf_token:app.csrf_token}).success(function(resp){if(1==resp.success){$scope.key=resp.data.api_key,$scope.secret=resp.data.api_secret;$scope.q.empty(),$scope.q.qrcode({width:169,height:169,text:"EXMO|"+resp.data.api_key+"|"+resp.data.api_secret+"|"})}else Alert.msg(resp.error)}).error(function(){Alert.msg(tt("Error 10167: Server problem"))})},$scope.load(),$scope.generate=function(){app.SignedRequest("/ctrl/userProfile",{action:"api_save",csrf_token:app.csrf_token,api_key:$scope.key},function(resp){1==resp.success?($scope.load(),console.log(tt("Profile settings saved"))):Alert.msg(resp.error)},function(){Alert.msg(tt("Error 10169: Server problem"))})}}).controller("TrustedIpCtrl",function($scope,User,$http,Alert,$element,ProfileWarn){$scope.elTrustedIp=$element.find("input[name=trusted_ip]"),$scope.User=User,$scope.ipList=[],$scope.use_trusted_ip=!1,$scope.use_trusted_api=!1,$scope.use_trusted_api_initial=null,$scope.ip="",1==User.trusted_ip_on&&($scope.use_trusted_ip=!0),$scope.$on("$destroy",function(){$scope.elTrustedIp=null}),$scope.useTrustedIpChange=function(){0==$scope.ipList.length&&(Alert.msg(tt("You need to add one or several IP addresses first")),$scope.use_trusted_ip=!1)},$scope.useTrustedApiChange=function(){0==$scope.ipList&&(Alert.msg(tt("You need to add one or several IP addresses first")),$scope.use_trusted_api=!1)},$scope.getTrustedIp=function(){$http.post("/ctrl/userProfile",{action:"get_trusted_ip",csrf_token:app.csrf_token}).success(function(resp){1==resp.success&&($element.find(".progress").hide(),$element.find(".no-information").toggle(0==resp.data.trusted_ip.length),$scope.ipList=resp.data.trusted_ip,$scope.use_trusted_api=1==resp.data.use_trusted_api,$scope.use_trusted_api_initial=$scope.use_trusted_api)}).error(function(){Alert.msg(tt("Error 10163: Server problem"))})},$scope.removeIp=function(e,ip){e.preventDefault();var index=$scope.ipList.indexOf(ip);$scope.ipList.splice(index,1),0==$scope.ipList.length&&($scope.use_trusted_ip=!1,$scope.use_trusted_api=!1),$element.find(".no-information").toggle(0==$scope.ipList.length)},$scope.addIp=function(){return $scope.ip&&""!=$scope.ip?$scope.validateIpAddress($scope.ip)||$scope.validateCidrAddress($scope.ip)?-1!=$scope.ipList.indexOf($scope.ip)?void Alert.msg(tt("Ip address already exists")):($scope.ipList.push($scope.ip),$scope.ip="",void $element.find(".no-information").toggle(0==$scope.ipList.length)):void Alert.msg(tt("This is not a valid IP address")):void Alert.msg(tt("Please, enter IP address")+" "+tt("or")+" "+tt("CIDR"))},$scope.save=function(){ProfileWarn.signedWarnIfBlock("/ctrl/userProfile",{action:"save_trusted_ip",csrf_token:app.csrf_token,use_trusted_ip:$scope.use_trusted_ip,use_trusted_api:$scope.use_trusted_api,ip_list:$scope.ipList},function(resp){if(1==resp.success){$scope.getTrustedIp(),$scope.use_trusted_ip=resp.data.use_trusted_ip,$scope.use_trusted_api=resp.data.use_trusted_api;var force_logoff=resp.data.force_logoff;Alert.msg(tt("Profile settings saved"),function(){1==force_logoff&&(window.location="/root")})}else Alert.msg(resp.error)},function(){Alert.msg(tt("Error 10163: Server problem"))})},$scope.validateIpAddress=function(ipaddress){return!!/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(ipaddress)},$scope.validateCidrAddress=function(cidr){return!!/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\/([0-9]|[1-2][0-9]|3[0-2]))$/.test(cidr)},$scope.getTrustedIp()}).controller("ProtectionCtrl",function($scope,User,$http,Alert,$element,ProfileWarn){$scope.q=$element.find("#totp-qrcode"),$scope.protectionTotp=!1,$scope.protectionSms=!1,$scope.protectionArea=null,$scope.dontProtectAddressbook=!1,$scope.phoneVerified=!0,$scope.totpVersion=0,$scope.User=User,$scope.phone=User.phone,1==User.auth_type?($scope.protectionTotp=!0,$scope.protectionSms=!1):2==User.auth_type&&($scope.protectionSms=!0,$scope.protectionTotp=!1),1==User.protect_type?$scope.protectionArea="logins":2==User.protect_type?$scope.protectionArea="full":3==User.protect_type&&($scope.protectionArea="full",$scope.dontProtectAddressbook=!0),$scope.getTOTPKey=function(){$scope.totp_secret="",$scope.q.empty(),$http.post("/ctrl/userProfile",{csrf_token:app.csrf_token,action:"generate_totp"}).success(function(resp){1==resp.success&&($scope.totp_secret=resp.data.secret,void 0!==resp.data.totp_version&&($scope.totpVersion=parseInt(resp.data.totp_version,10)+1),$scope.showQR())}).error(function(){Alert.msg(tt("Error 10163: Server problem"))})},$scope.showQR=function(){if($scope.totp_secret){var data,versionStr="";$scope.totpVersion>1&&(versionStr=""+$scope.totpVersion),data="otpauth://totp/EXMO.COM"+versionStr+"?secret="+$scope.totp_secret,$scope.q.qrcode({width:169,height:169,text:data})}},$scope.sendSms=function(){$http.post("/ctrl/userProfile",{csrf_token:app.csrf_token,phone:$scope.phone,action:"send_sms"}).success(function(resp){1==resp.success?Alert.msg(tt("Code has been sent to indicated phone number, please enter the code in the field below and click 'confirm'")):Alert.msg(resp.error)}).error(function(){Alert.msg(tt("Error 10164: Server problem"))})},$scope.phoneConfirm=function(){ProfileWarn.signedWarnIfBlock("/ctrl/userProfile",{csrf_token:app.csrf_token,phone:$scope.phone,confirm_code:$scope.sms_confirm,action:"confirm_phone"},function(resp){1==resp.success?Alert.msg(tt("Telephone number successfully confirmed")):Alert.msg(resp.error)},function(){Alert.msg(tt("Error 10165: Server problem"))})},$scope.switchAuthType=function(authType){$scope.protectionTotp=0==authType,$scope.protectionSms=1==authType},$scope.deactivate=function(){ProfileWarn.signedWarnIfBlock("/ctrl/userProfile",{action:"protection",csrf_token:app.csrf_token,totp_secret:$scope.totp_secret,use_sms:!1,use_totp:!1,protection_area:$scope.protectionArea,dont_protect_addressbook:$scope.dontProtectAddressbook},function(resp){1==resp.success?Alert.msg(tt("Profile settings saved, please login again"),function(){window.location.href="/"}):Alert.msg(resp.error)},function(){Alert.msg(tt("Error 10166: Server problem"))})},$scope.save=function(){ProfileWarn.signedWarnIfBlock("/ctrl/userProfile",{action:"protection",csrf_token:app.csrf_token,totp_secret:$scope.totp_secret,use_sms:$scope.protectionSms,use_totp:$scope.protectionTotp,protection_area:$scope.protectionArea,dont_protect_addressbook:$scope.dontProtectAddressbook},function(resp){1==resp.success?Alert.msg(tt("Profile settings saved, please login again"),function(){window.location.href="/"}):Alert.msg(resp.error)},function(){Alert.msg(tt("Error 10166: Server problem"))})}}).controller("LogonAttemptsCtrl",function($scope,User,$http,Alert,$element,$window){$scope.attemptsList=[],$scope.sessionsList=[],$scope.getLogonAttempts=function(){$http.post("/ctrl/userProfile",{action:"get_logon_attempts",csrf_token:app.csrf_token}).success(function(resp){1==resp.success&&($scope.attemptsList=resp.data.logon_attempts)}).error(function(){Alert.msg(tt("Error 10163: Server problem"))})},$scope.getSessions=function(){$http.post("/ctrl/userProfile",{action:"get_sessions",csrf_token:app.csrf_token}).success(function(resp){1==resp.success&&($scope.sessionsList=resp.data.sessions,$scope.trustedIpList=resp.data.trusted,$element.find(".progress").hide(),$element.find(".no-information").toggle(0==$scope.sessionsList.length),$element.find(".no-information-another").toggle(1==$scope.sessionsList.length))}).error(function(){Alert.msg(tt("Error 10163: Server problem"))})},$scope.removeSession=function(item){item.active?Alert.question(tt("This is your active session. Are you sure you want to close it?"),function(res){res&&($scope._removeSession(item),$window.location.reload())}):$scope._removeSession(item)},$scope.removeAllSession=function(){Alert.question(tt("Do you really want to delete all sessions, except the active one?"),function(res){res&&$scope.sessionsList.filter(function(session){return!session.active}).forEach(function(session){$scope._removeSession(session)})})},$scope._removeSession=function(item){$http.post("/ctrl/userProfile",{action:"remove_session",session_id:item.id,csrf_token:app.csrf_token}).success(function(resp){1==resp.success&&($scope.sessionsList.splice($scope.sessionsList.indexOf(item),1),$element.find(".no-information-another").toggle(1==$scope.sessionsList.length))}).error(function(){Alert.msg(tt("Error 10163: Server problem"))})},$scope.isAlreadyTrust=function(ip){return-1!=$scope.trustedIpList.indexOf(ip)},$scope.addToTrust=function(ip){app.SignedRequest("/ctrl/userProfile",{action:"add_trusted_ip",csrf_token:app.csrf_token,ip:ip},function(resp){console.log("success"),1==resp.success?$scope.trustedIpList.push(ip):Alert.msg(resp.error)},function(){Alert.msg(tt("Error 10646: Server problem"))})},$scope.getSessions(),$scope.getLogonAttempts()}),angular.module("FAQ",[]).controller("FAQListCtrl",function($scope,$element,$http,$compile,$filter,Settings){$scope.items={},$scope.elGroup=$element.find(".side_menu"),$scope.elList=$element.find(".topic_answers"),$scope.isShow=function(id){return void 0!=$scope.showed[id]&&(1==$scope.showed[id]&&void 0)},$scope.showAnswer=function(id){var $id=$("#question-"+id);if(0!==$id.length){var pos=$id.offset().top;$("body, html").animate({scrollTop:pos})}},$scope.showGroup=function(id){$scope.elList.children().remove();var items=Object.values($scope.items).filter(function(item){return item.group==id});if(null!=$scope.items&&null!=items[0]&&null!=items[0].html){var data=$compile(items[0].html)($scope);$scope.elList.append($('<div class="exmo_api"></div>').append(data))}}}).directive("faqDir",function($http){return initFirst=function(items){var id=null;return angular.forEach(Object.values(items),function(item){void 0!=item.group&&item.html.length>0&&!id&&(id=item.group)}),id},function(scope,element,attrs){$http.post("/ctrl/FAQList",{type:attrs.faqDir}).success(function(res){if(res.success){scope.items=res.data.faq;var hash=window.location.hash.replace("#/","").split("_"),active_tab=hash.length>0&&hash[0].length>0?hash[0]:initFirst(scope.items)
;for(var i in scope.items){var str='<li data-group-id="'+scope.items[i].group+'"><a href="#'+scope.items[i].group+'" class="'+(scope.items[i].group==active_tab?"active":"")+'" >'+scope.items[i].name+"</a></li>";scope.items[i].html.length>0&&element.append(str)}scope.tabs=element.find("li"),scope.prev=$(scope.tabs[0]),scope.tabs.bind("click",function(event,k){var id=parseInt($(event.currentTarget).attr("data-group-id")),el=$(event.currentTarget);scope.showGroup(id),void 0!=scope.prev&&scope.tabs.find("a").removeClass("active"),scope.prev=el,el.find("a").addClass("active")}),scope.showGroup(active_tab),hash.length>0&&void 0!==hash[1]&&scope.showAnswer(hash[1])}})}}),angular.module("Register",[]).controller("RegisterCtrl",function($scope,$rootScope,$element,$http,Alert,ExCaptcha){function hideLoginError(errorMsgSelector){$scope.elLogin.removeClass($scope.inputErrorClass),$(errorMsgSelector).addClass($scope.hideClass)}function showLoginError(errorMsgSelector){$scope.elLogin.addClass($scope.inputErrorClass),$(errorMsgSelector).removeClass($scope.hideClass)}$scope.elLogin=$element.find("[name=login]"),$scope.elEmail=$element.find("[name=email]"),$scope.elPassword1=$element.find("[name=password1]"),$scope.elPassword2=$element.find("[name=password2]"),$scope.elSubscribe=$element.find("#agree_email"),$scope.recaptcha_response=null,$scope.inputErrorClass="form_error_input",$scope.hideClass="hide",$scope.CreateCaptcha=function(){var element=$element.find(".captcha_block")[0],verifyCallback=function(response){$scope.recaptcha_response=response,$scope.checkFields()};ExCaptcha.render(element,verifyCallback)},$rootScope.$on("show_registration",function(){$scope.CreateCaptcha()}),$scope.CreateCaptcha(),$scope.validateEmailF=function(email){var re=/^[a-zA-Z0-9.!#$%&’*+\/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/,serverRule=/^[\d\w\-\.\_\s]+\@[\d\w\-\.\_\s]+$/;return re.test(email)&&serverRule.test(email)},$scope.simpleValidate=function(){var n=/^[a-zA-Z0-9]+$/,login=$scope.elLogin.val();if(-1==login.search(n))return!1;var pass1=$scope.elPassword1.val(),pass2=$scope.elPassword2.val();return!!(login.length>4&&login.length<=12&&$scope.elEmail.val().length>7&&$scope.validateEmailF($scope.elEmail.val())&&pass1.length==pass1.trim().length&&pass1.length>0&&pass2.length>0&&pass1.length==pass2.length&&pass1==pass2&&pass1.trim()==pass2.trim()&&1==$element.find("#agree_toc").prop("checked")&&null!=$scope.recaptcha_response&&$scope.recaptcha_response.length>0)},$scope.checkFields=function(){$scope.simpleValidate()},$scope.validateLogin=function(){var n=/^[a-zA-Z0-9]+$/,login=$scope.elLogin.val();login.length>4&&0==login.search(n)?hideLoginError("#login_error"):showLoginError("#login_error"),login.length>12?showLoginError("#login_to_long_error"):hideLoginError("#login_to_long_error")},$scope.elLogin.on("keyup",function(){$scope.validateLogin(),$scope.checkFields()}),$scope.validateEmail=function(){$scope.elEmail.val().length>4&&$scope.validateEmailF($scope.elEmail.val())?($scope.elEmail.removeClass($scope.inputErrorClass),$("#email_error").addClass($scope.hideClass)):($scope.elEmail.addClass($scope.inputErrorClass),$("#email_error").removeClass($scope.hideClass))},$scope.elEmail.on("keyup",function(){$scope.validateEmail(),$scope.checkFields()}),$scope.validatePassword1=function(){var pass1=$scope.elPassword1.val();pass1.trim().length>6&&pass1.length===pass1.trim().length?($scope.elPassword1.removeClass($scope.inputErrorClass),$("#password_error").addClass($scope.hideClass)):($scope.elPassword1.addClass($scope.inputErrorClass),$("#password_error").removeClass($scope.hideClass)),$scope.elPassword2.val().length>0&&$scope.validatePassword2()},$scope.elPassword1.on("keyup",function(){$scope.validatePassword1(),$scope.checkFields()}),$scope.validatePassword2=function(){var pass1=$scope.elPassword1.val(),pass2=$scope.elPassword2.val();pass1.length>6&&pass2==pass1?($scope.elPassword2.removeClass($scope.inputErrorClass),$("#password_error2").addClass($scope.hideClass)):($scope.elPassword2.addClass($scope.inputErrorClass),$("#password_error2").removeClass($scope.hideClass))},$scope.validateAgreement=function(){$element.find("#agree_toc").prop("checked")},$scope.elPassword2.on("keyup",function(){$scope.validatePassword2(),$scope.checkFields()}),$element.find(":checkbox").on("change",function(){$scope.validateAgreement(),$scope.checkFields()}),$scope.tryRegister=function($event){$event.preventDefault(),$scope.simpleValidate()?$http.post("/ctrl/userNew",{login:$scope.elLogin.val(),email:$scope.elEmail.val(),password:$scope.elPassword1.val(),subscribe:$scope.elSubscribe.prop("checked"),recaptcha_response_field:$scope.recaptcha_response}).success(function(data){if(1==data.success){if("referal_program"==$_GET.redirect&&(window.location.href="/referal_program"),$_GET.redirect)return void window.location.replace(window.location.origin+"/"+$_GET.redirect);window.location.href="/wallet/?register=success"}else{$scope.recaptcha_response="",$scope.checkFields();var err=data.error;console.log(err),ExCaptcha.isDefined()&&ExCaptcha.reset().then(function(){$scope.checkFields()}),Alert.msg(err)}}).error(function(data,status,headers,config){console.log(data,status),ExCaptcha.isDefined()&&($element.find(".reg_start_btn").addClass("btn_blue_disabled"),ExCaptcha.reset().then(function(){$scope.checkFields()})),Alert.msg(tt("Error 10170: Server problem"))}):($scope.validateLogin(),$scope.validateEmail(),$scope.validatePassword1(),$scope.validatePassword2(),$scope.validateAgreement(),$scope.checkFields())},$scope.goto=function(url){window.location.href=url},"undefined"!=typeof $_GET&&$_GET.email&&($scope.elEmail.val($_GET.email),$scope.validateEmail())}),angular.module("Login",[]).controller("LoginCtrl",function($scope,$element,$http,$window,Alert,ExCaptcha){$scope.elLogin=$element.find("[name=emailSignin]"),$scope.elPassword=$element.find("[name=passwordSignin]"),$scope.elTOTP=$element.find("[name=totpSignin]"),$scope.showError=!1,$scope.inputErrorClass="form_error_input",$scope.hideClass="hide",$("#login_form").on("keyup keypress",function(e){if(13===(e.keyCode||e.which))return e.preventDefault(),!1}),$scope.elLogin.on("keyup",function(e){$scope.validateEmail(),$scope.simpleValidate()&&13==e.which&&$scope.elPassword.focus()}),$scope.elPassword.on("keyup",function(e){$scope.simpleValidate()&&13==e.which&&$scope.tryLogin()}),$scope.elTOTP.on("keyup",function(e){$scope.simpleValidate()&&($scope.elTOTP.val()&&6==$scope.elTOTP.val().length?$scope.tryLogin():13==e.which&&$scope.tryLogin())}),$.each([$scope.elLogin,$scope.elPassword,$scope.elTOTP],function(){$(this).on("keyup click",function(e){13!=e.which&&$element.parent().parent().find(".err_mod").removeClass("err_mod")})}),$scope.sent=!1,$scope.recaptcha_response="";var elCaptcha=$element.find(".login-captcha");elCaptcha.parent().hide(),$scope.showCaptcha=function(errorMsg){elCaptcha.parent().show();var captcha=ExCaptcha.render(elCaptcha[0],function(response){$scope.recaptcha_response=response});null!=errorMsg&&captcha.then(function(me){me.setError(errorMsg)})},$scope.tryLogin=function(){return $element.parent().parent().children().removeClass("err_mod"),$http.post("/ctrl/userLogin",{login:$scope.elLogin.val(),password:$scope.elPassword.val(),totp:$scope.elTOTP.val(),recaptcha_response_field:$scope.recaptcha_response}).success(function(data){if($scope.recaptcha_response="",elCaptcha.parent().hide(),1!=data.success){if($element.parent().parent().children().addClass("err_mod"),(data.error.indexOf("10208")>-1||data.error.indexOf("10209")>-1||data.error.indexOf("SMS")>-1)&&!$scope.elTOTP.parent().parent().is(":visible"))return $scope.elTOTP.parent().parent().show(),$scope.elTOTP.focus(),$scope.error="",void($scope.showError=!1);if(data.error.indexOf("10267")>-1&&($scope.elLogin.val(""),$scope.elPassword.val(""),$scope.elLogin.focus()),data.error.indexOf("10130")>-1)return $scope.showCaptcha(tt("The CAPTCHA is invalid")),!1;if(data.error.indexOf("10852")>-1)return $scope.showCaptcha(),!1;(data.error.indexOf("10312")>-1||data.error.indexOf("10127")>-1)&&$scope.showCaptcha(),$element.find(".sign_up_form").addClass("error");var err=data.error;-1!=err.indexOf(":")&&(err=err.substr(err.indexOf(":")+1,err.length)),$scope.error=err,$scope.showError=!0}else{if($_GET.redirect)return void window.location.replace(window.location.origin+"/"+$_GET.redirect);window.location.href=data.data.http_refferer}}).error(function(data,status,headers,config){$scope.sent=!1,$scope.recaptcha_response="",Alert.msg(tt("Error 10160: Server problem"))}),!1},$scope.goto=function(url){window.location.href=url},$scope.simpleValidate=function(){var isLoginValid=$scope.elLogin.val().length>4&&$scope.checkEmail($scope.elLogin.val()),pas=$scope.elPassword.val(),isPasswordValid=pas.trim().length>0,isTotpValid=!$scope.elTOTP.parent().parent().is(":visible")||$scope.elTOTP.val().length>0,isRecaptchValid=!elCaptcha.parent().is(":visible")||$scope.recaptcha_response.length>0;return isLoginValid&&isPasswordValid&&isTotpValid&&isRecaptchValid},$scope.validateEmail=function(){$scope.elLogin.val().length>4&&$scope.checkEmail($scope.elLogin.val())?($scope.elLogin.removeClass($scope.inputErrorClass),$("#email_error").addClass($scope.hideClass)):($scope.elLogin.addClass($scope.inputErrorClass),$("#email_error").removeClass($scope.hideClass))},$scope.checkEmail=function(email){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(email)},$scope.showCaptcha()}).directive("unhideDir",function(){return function(scope,element,attrs){element.css("display","")}}),angular.module("Recovery",[]).controller("PasswordRecoverCtrl",function($scope,$http,Alert,$element,ExCaptcha){$scope.elEmail=$element.find("input[name=email]");var callback=function(response){$scope.captcha=response};ExCaptcha.render($(".recovery-captcha")[0],callback),$scope.showEmailSent=function(){$("#email-sent-form").fadeOut(600,function(){$("#email-sent-message").fadeIn(400)})},$scope.send=function(e){e.preventDefault(),$http.post("/ctrl/userRecoveryPassword",{email:$scope.elEmail.val(),captcha:$scope.captcha}).success(function(data){1==data.success?$scope.showEmailSent():Alert.msg(data.error),ExCaptcha.reset()}).error(function(){Alert.msg(tt("Error 10161: Server problem")),ExCaptcha.reset()})}}),angular.module("TopPanel",[]).service("TopPanel",function($rootScope,Settings,$location){var self=this;self.c1name="",self.c2name="",self.highlightPair=!1,$rootScope.$on("PAIR_CHANGED",function(){self.getCurrentCurrency()}),self.getCurrentCurrency=function(){var c1name,c2name;if(void 0!=$location.search().pair){var pair=$location.search().pair;void 0!=pair&&pair.length>0&&Validator.isValid("pair",pair)&&pair.indexOf("_")>-1&&(c1name=pair.substr(0,pair.indexOf("_")),c2name=pair.substr(pair.indexOf("_")+1,pair.length))}void 0!=c1name&&void 0!=c2name||("ru"==Settings.lang?(c1name="BTC",c2name="RUB"):(c1name="BTC",c2name="USD")),self.c1name=c1name,self.c2name=c2name},self.getCurrentCurrency()}).controller("TopPanelCtrl",function($scope,User,$element,$rootScope,UWallets,$location,TopPanel,Messages,$http,Alert,ngNotify,$window){$scope.UWallets=UWallets,$scope.TopPanel=TopPanel,$scope.Messages=Messages,$scope.$window=$window,app.auth&&((new NewsCounterConstructor).check(),UWallets.refresh(),Messages.checkUnread()),$scope.changePage=function(newUrl){return null!=newUrl&&($window.location.href=newUrl),!1},$scope.getBalance=function(){if(null==TopPanel.c1name)return"";return UWallets.getBalance(TopPanel.c1name,!0)+" "+TopPanel.c1name},$scope.highlightCurrency=function(cur){return 0!=TopPanel.highlightPair&&(cur==TopPanel.c1name||cur==TopPanel.c2name)},$scope.logout=function(){Alert.question(tt("Are you sure you want to log out?"),function(res){res&&$http.post("/ctrl/userLogout",{csrf_token:app.csrf_token}).success(function(resp){1==resp.success&&(window.location.href="https://exmo.com/")})})}}),angular.module("Carousel",[]).service("Carousel",function($http,$timeout,$rootScope,Rates){var self=this,saveTimer=null;self.sortColumn="",self.sortMode="",self.pairFilter="",self.currentMarket="Favorites",self.prevMarket="",self.currentPair=null,self.markets={},self.marketNames={},self.newPairs=[],self.init=function(newSettings){if(newSettings){if(newSettings.pairs){Rates.items=newSettings.pairs,self.newPairs.length=0;for(var name in Rates.items){Rates.items[name].new&&self.newPairs.push(name)}}if(newSettings.markets){self.markets={},self.marketNames={};for(var id in newSettings.markets){var market=newSettings.markets[id];self.marketNames[id]=market.name,self.markets[id]=market.pairs}}self.markets.Favorites||(self.markets.Favorites=["BTC_USD"])}},self.inFavorites=function(pair){var favorites=self.markets.Favorites;return!!favorites&&-1!==favorites.indexOf(pair)},self.addToFavorites=function(pairName){var favorites=self.markets.Favorites;return!(!favorites||-1!==favorites.indexOf(pairName))&&(favorites.push(pairName),!0)},self.removeFromFavorites=function(pairName){var favorites=self.markets.Favorites;if(!favorites)return!1;var index=favorites.indexOf(pairName);return-1===index||!(favorites.length<2)&&(favorites.splice(index,1),!0)},self.favoritesCount=function(){var favorites=self.markets.Favorites;return favorites?favorites.length:0};var saveSettings=function(){var settings={pairs:[]},favorites=self.markets.Favorites;favorites&&(settings.pairs=favorites),$http.post("/ctrl/ratesSettings/save",{csrf_token:app.csrf_token,settings:settings}).success(function(resp){if(1!=resp.success)return void Alert.msg(resp.error);var data=resp.data;if(null!=data&&null!=data.settings&&null!=data.settings.pairs){var pairs=data.settings.pairs,favorites=self.markets.Favorites;favorites.length=0;for(var i in pairs)favorites.push(pairs[i]);return void $rootScope.$emit("TRADE_PAGE_UPDATE_SETTINGS")}}).error(function(){Alert.msg(tt("Error 10643: Server problem"))})};self.saveSettingsAsync=function(){null!=saveTimer&&($timeout.cancel(saveTimer),saveTimer=null),saveTimer=$timeout(saveSettings,300)},self.isNew=function(pairName){return null!=pairName&&-1!==self.newPairs.indexOf(pairName)}}).controller("CarouselCtrl",function($scope,$element,Carousel,Rates,$location,TradePage,$rootScope,$timeout,Alert){var elMarkets=$element.find(".top_pairs_btns .top_pair_btn"),elMarketItems=$element.find(".market-items"),elMainStar=$element.find("#checkbox_all_pairs"),elPairFilterWrap=$element.find(".pairs_new_header"),elPairFilterInput=elPairFilterWrap.find(".pairs_new_header_search_input"),elSortTable=$element.find(".sort_table");$element.find("#top_settings_table").on("mousewheel",function(e){var event=e.originalEvent,d=event.wheelDelta||-event.detail;this.scrollTop+=30*(d<0?1:-1),e.preventDefault()}),$scope.Carousel=Carousel,$scope.highlight="";var renderItem=function(item,name){if(!item)return"";if(null==name&&(name=item.name),null==name)return"";var name2=String(name),newHtml="",checked="",isNew=Carousel.isNew(name);String(name).split("_");if($scope.highlight.length>0){var hl=$scope.highlight.replace("https://exmo.com/","_"),highlited='<span class="highlight">'+hl+"</span>";name2=name2.replace(hl,highlited)}name2=name2.replace("_","https://exmo.com/"),isNew&&(newHtml='<div class="anchor_new__in"><span class="anchor_new">'+tt("new")+"</span></div>"),Carousel.inFavorites(name)&&(checked='checked="checked" ');var priceChange=parseFloat(Rates.getPriceChange(name)),priceKlass="";isNaN(priceChange)&&(priceChange=0),0!==priceChange&&(priceKlass=priceChange<0?" arrow_down_before":" arrow_up_before"),priceChange=Math.abs(priceChange);var activeKlass="";name===$scope.getCurrentPair()&&(activeKlass=" active");var decimalLen=Rates.getDecimalLen(name),buyPrice=Utils.trimX(item.buy_price,decimalLen),sellPrice=Utils.trimX(item.sell_price,decimalLen);return buyPrice.length>12&&(buyPrice=Utils.limitFloatLength(buyPrice,12)),sellPrice.length>12&&(sellPrice=Utils.limitFloatLength(sellPrice,12)),'<tr class="table_body pair'+activeKlass+'" pair="'+name+'"><td class="scol_1"><div class="checkbox_star_wrap"><input type="checkbox" name="checkbox_'+name+'" id="checkbox_'+name+'" '+checked+'class="checkbox_star"><label for="checkbox_'+name+'" class="checkbox_star_label"></label></div></td><td class="scol_2">'+name2+newHtml+'</td><td class="scol_3 buy_price">'+buyPrice+'</td><td class="scol_4 sell_price">'+sellPrice+'</td><td class="scol_5"><div class="chprice'+priceKlass+'">'+Math.abs(priceChange)+"%</div></td></tr>"};$scope.changeMainStarState=function(){var newState=!0;elMarketItems.find(".checkbox_star:not(:checked)").length>0&&(newState=!1),elMainStar.prop("checked",newState)},$scope.renderMarket=function(market){null==market&&(market=Carousel.currentMarket);var marketItems=Carousel.markets[market];if(null==marketItems)return!1;var html="";return angular.forEach(marketItems,function(pairName){var pair=Rates.items[pairName];html+=renderItem(pair,pairName)}),elMarketItems.html(html),$scope.changeMainStarState(),$scope.sortCurrentMarket(),!0},$scope.switchMarket=function(newMarket){return null!=newMarket&&Carousel.currentMarket!==newMarket&&($scope.highlight="",!!$scope.renderMarket(newMarket)&&(elMarkets.each(function(i,market){$(market).data("market")===newMarket?$(market).addClass("btn_active"):$(market).removeClass("btn_active")}),Carousel.currentMarket=newMarket,$scope.removeFilter(),!0))},$scope.setActiveToCurrentMarketPair=function(pairName){elMarketItems.find(".pair.active").removeClass("active"),$scope.getPairElement(pairName).addClass("active")},$scope.changePair=function(pairName){return!!pairName&&(Rates.selected_pair=pairName,$scope.setActiveToCurrentMarketPair(pairName),$location.search("pair",pairName),TradePage.setPara(pairName),$rootScope.$broadcast("PAIR_CHANGED"),Rates.showStatistics(),Rates.updateTitle(),!0)};var isUserLoggedIn=function(){return!!window.User.id||(Alert.msg(tt("Error 10309: You need to log in")),!1)};$scope.toggleFavorite=function(pairName,newState){if(!pairName)return!1;if(!isUserLoggedIn())return!1;if(!1===newState){var favoritesChanged=Carousel.removeFromFavorites(pairName);if(!favoritesChanged)return!1;favoritesChanged&&"Favorites"===Carousel.currentMarket&&elMarketItems.find(".table_body[pair="+pairName+"]").remove()}return!0===newState&&Carousel.addToFavorites(pairName),Carousel.saveSettingsAsync(),$scope.changeMainStarState(),!0},$scope.updatePrices=function(){var pairs=Rates.items;for(var pairName in pairs){var pair=pairs[pairName],elPair=elMarketItems.find("[pair="+pairName+"]"),decimalLen=Rates.getDecimalLen(pairName),buyPrice=Utils.trimX(pair.buy_price,decimalLen),sellPrice=Utils.trimX(pair.sell_price,decimalLen);buyPrice.length>12&&(buyPrice=Utils.limitFloatLength(buyPrice,12)),sellPrice.length>12&&(sellPrice=Utils.limitFloatLength(sellPrice,12)),elPair.find(".buy_price").text(buyPrice),elPair.find(".sell_price").text(sellPrice),$scope.updatePriceChange(elPair,pairName)}},$scope.updatePriceChange=function(elPair,pairName){if(null!=elPair){var priceKlass="",priceChange=parseFloat(Rates.getPriceChange(pairName));0!==priceChange&&(priceKlass=priceChange<0?" arrow_down_before":" arrow_up_before"),priceChange=Math.abs(priceChange);var elPriceChange=elPair.find(".chprice");elPriceChange.removeClass("arrow_down_before").removeClass("arrow_up_before"),priceKlass.length>0&&elPriceChange.addClass(priceKlass),elPriceChange.text(priceChange+"%")}};var flashTimers={},flashOnePair=function(pairName,klass){null!=flashTimers[pairName]&&($timeout.cancel(flashTimers[pairName]),flashTimers[pairName]=null);var klassToRemove="bg_pairs_up";"bg_pairs_up"===klass&&(klassToRemove="bg_pairs_down");var elPair=$scope.getPairElement(pairName);elPair.removeClass(klassToRemove).addClass(klass),flashTimers[pairName]=$timeout(function(){null!=elPair&&elPair.removeClass("bg_pairs_up").removeClass("bg_pairs_down")},3e3)};$scope.flash=function(){var pairName,needFlash={};for(pairName in Rates.items){var newPrice=parseFloat(Rates.items[pairName].buy_price),oldPrice=parseFloat(Rates.flashItems[pairName]);oldPrice>newPrice&&(needFlash[pairName]="bg_pairs_down"),oldPrice<newPrice&&(needFlash[pairName]="bg_pairs_up"),Rates.flashItems[pairName]=newPrice}for(pairName in needFlash){var flashKlass=needFlash[pairName];flashOnePair(pairName,flashKlass),pairName===Rates.selected_pair&&("bg_pairs_up"===flashKlass?Rates.updateTitle(" ▲"):"bg_pairs_down"===flashKlass?Rates.updateTitle(" ▼"):Rates.updateTitle())}},$scope.getPairElement=function(pairName){return elMarketItems.find("tr[pair="+pairName+"]")},$scope.isPairInMarket=function(pairName,marketName){null==marketName&&(marketName=Carousel.currentMarket);var marketPairs=Carousel.markets[marketName];return!(!pairName||!marketPairs)&&-1!==marketPairs.indexOf(pairName)},$scope.getCurrentPair=function(){var selectedPair=Validator.getFromUrl("pair");return null!=selectedPair?selectedPair:""},$scope.getDefaultPair=function(){var defaultPair=elMarketItems.find("tr:first").attr("pair"),selectedPair=$scope.getCurrentPair();return""!==selectedPair&&(defaultPair=selectedPair),defaultPair||(defaultPair="BTC_USD"),defaultPair},$scope.setDefaultPair=function(){var defaultPair=$scope.getDefaultPair();$scope.changePair(defaultPair)},$scope.toggleFilter=function(){elPairFilterWrap.toggleClass("open"),elPairFilterWrap.hasClass("open")?elPairFilterInput.focus():$scope.removeFilter()},$scope.removeFilter=function(){elPairFilterWrap.removeClass("open"),Carousel.pairFilter="",$scope.applyPairFilter(""),$scope.backFromTempMarket()},$scope.switchToTempMarket=function(marketName){var tmpMarkets=["newPairs","search"];marketName&&-1!==tmpMarkets.indexOf(marketName)&&(-1===tmpMarkets.indexOf(Carousel.currentMarket)&&(Carousel.prevMarket=Carousel.currentMarket,Carousel.currentMarket=marketName,elMarkets.removeClass("btn_active")),$scope.renderMarket(marketName))},$scope.backFromTempMarket=function(){var prevMarket=Carousel.prevMarket;if(""!==prevMarket){Carousel.currentMarket=prevMarket,Carousel.prevMarket="",elMarkets.each(function(i,market){$(market).data("market")===prevMarket?$(market).addClass("btn_active"):$(market).removeClass("btn_active")}),$scope.renderMarket(prevMarket);var selectedPairName=$scope.getDefaultPair();$scope.setActiveToCurrentMarketPair(selectedPairName)}},$scope.applyPairFilter=function(val){if(null==val||val.length<1)return $scope.highlight="",void $scope.backFromTempMarket();$scope.highlight=val.toUpperCase(),val=val.toUpperCase().replace("https://exmo.com/","_").replace("\\","_");var markets=Carousel.markets,allPairs=Object.keys(Rates.items);markets.search=[];for(var i in allPairs){var pairName=allPairs[i];-1!==pairName.indexOf(val)&&markets.search.push(pairName)}$scope.switchToTempMarket("search")},$scope.toggleColumnSort=function($column){var columnName=$column.data("sortName");if(null!=columnName){if(columnName===Carousel.sortColumn){var sortModes=["","ASC","DESC"],index=sortModes.indexOf(Carousel.sortMode),newIndex=index+1;-1!==index&&null!=sortModes[newIndex]||(newIndex=0),Carousel.sortMode=sortModes[newIndex]}else Carousel.sortMode="ASC",Carousel.sortColumn=columnName;elSortTable.find(".sort_item").removeClass("filter_active").removeClass("arrow_down_after").removeClass("arrow_up_after");var sortKlass="",elColumnHead=elSortTable.find(".sort_item[data-sort-name="+columnName+"]");"ASC"===Carousel.sortMode&&(sortKlass="down"),"DESC"===Carousel.sortMode&&(sortKlass="up"),sortKlass.length>0&&(sortKlass="arrow_"+sortKlass+"_after",elColumnHead.addClass("filter_active").addClass(sortKlass)),$scope.sortCurrentMarket()}},$scope.sortCurrentMarket=function(){var items=elMarketItems.find(".pair"),sortColumn=Carousel.sortColumn,sortMode=Carousel.sortMode,sortCb=function(item1Node,item2Node){var a=null,b=null,pair1Name=$(item1Node).attr("pair"),pair2Name=$(item2Node).attr("pair"),item1=Rates.items[pair1Name],item2=Rates.items[pair2Name];if("price"===sortColumn&&(a=parseFloat(item1.buy_price),b=parseFloat(item2.buy_price)),"volume"===sortColumn&&(a=parseFloat(item1.vol),b=parseFloat(item2.vol)),"change"===sortColumn&&(a=parseFloat(Rates.getPriceChange(pair1Name)),b=parseFloat(Rates.getPriceChange(pair2Name))),""===sortColumn||""===sortMode||null==a||null==b){var pairsOrder=Object.keys(Rates.items);return pairsOrder.indexOf(pair1Name)-pairsOrder.indexOf(pair2Name)}return a===b?0:"DESC"===sortMode?a<b?1:-1:a>b?1:-1};TradePage.sortDomItems(items,elMarketItems,sortCb)},$scope.showNewMarket=function(e){e&&e.preventDefault(),Carousel.markets.newPairs=Carousel.newPairs,$scope.switchToTempMarket("newPairs")},$scope.init=function(){Carousel.init(carouselSettings),$scope.setDefaultPair(),$scope.changeMainStarState(),elMarkets.on("click touch",function(e){e.preventDefault();var newMarket=$(e.target).data("market");Carousel.prevMarket="",$scope.switchMarket(newMarket)}),elMarketItems.on("click touch",".scol_2,.scol_3,.scol_4,.scol_5",function(e){e.preventDefault();var pair=$(e.target).closest("tr").attr("pair");$scope.changePair(pair)}),elMarketItems.on("change",".checkbox_star",function(e){e.stopPropagation();var $pair=$(e.target).closest(".pair"),pairName=$pair.attr("pair"),newState=$(e.target).prop("checked");$scope.toggleFavorite(pairName,newState)||$(e.target).prop("checked",!newState),$scope.changeMainStarState()}),elMainStar.on("change",function(e){if(e.stopPropagation(),!isUserLoggedIn())return $scope.changeMainStarState(),!1;var newState=$(e.target).prop("checked");elMarketItems.find(".pair").each(function(i,item){var $pair=$(item),$checkbox=($(item).attr("pair"),$pair.find(".checkbox_star"));$checkbox.prop("checked",newState),$checkbox.trigger("change")})}),elPairFilterInput.on("keyup",function(e){e.stopPropagation();var queryStr=$(e.target).val();queryStr=queryStr.replace(/^\s+|\s+$/g,""),$scope.applyPairFilter(queryStr)}),elSortTable.on("click touch",".sort_item",function(e){e.stopPropagation(),$scope.toggleColumnSort($(e.currentTarget))}),$rootScope.$on("SOCKET_MESSAGE",function(e,args){var data=args.data,changed=!1,needFlash=!1;null!=data&&("ticker"===args.channel&&(Rates.items=data,changed=!0,needFlash=!0),"close_buy_price"===args.channel&&(console.log("update close prices",data),Rates.closePrices=data,changed=!0,needFlash=!1),changed&&$scope.updatePrices(),needFlash&&$scope.flash())})}}),angular.module("UWallets",[]).service("UWallets",function($rootScope,Settings,$http){var self=this;self.items=[],self.beuty_items=[],self.kredits=[],self.total="",$rootScope.$on("SOCKET_MESSAGE",function(e,args){"wallets"!=args.msg&&"REFRESH_MY_WALLETS"!=args.msg||self.refresh()}),self.refresh=function(){$http.post("/ctrl/walletsGet",{csrf_token:app.csrf_token}).success(function(resp){1==resp.success&&(self.items=resp.data.wallets,self.beuty_items=resp.data.beuty_items,self.kredits=resp.data.kredits,self.total=resp.data.total_str,$rootScope.$broadcast("WALLETS_UPDATED"))})},self.getBalance=function(curr,beuty){var items=self.items;void 0!=beuty&&1==beuty&&(items=self.beuty_items);for(var i in items){var w=items[i];if(void 0!==w&&w.typename==curr)return w.amount}return 0},self.getKredit=function(curr,par){for(var i in self.kredits){var w=self.kredits[i];if(w.curr==curr)return w[par]+"%"}return"kmlevel"==par?"100%":"kamount"==par?"0% "+curr:void 0}}),angular.module("LandingNew",[]).controller("LandingNewMainCtrl",function($scope,$rootScope,$element,$http,$timeout){$scope.items=[],$scope.flash_items={};var flashTimers={},fiatCurrencies=Object.keys(Settings.currencies).filter(function(currency){return Settings.currencies[currency].isFiat});$scope.register=function(){$http.post("/ctrl/registerEmail/register",{email:$scope.email}).success(function(response){1==response.success?window.location.href=response.data.url:window.location.href="/register"}).error(function(){window.location.href="/register"})},$scope.init=function(){$http.get("/ctrl/ticker").success(function(resp){1==resp.success&&($scope.items=resp.data.ticker,$scope.initFlashItems())})},$scope.init(),$rootScope.$on("SOCKET_MESSAGE",function(e,args){"ticker"==args.channel&&$scope.$apply(function(){$scope.updateData(args.data)})}),$scope.updateData=function(arData){$scope.items=arData;var elSection=$(".graph-carousel");if(elSection.length>0){var elP,sell,buy,decimalLen,pair;for(pair in arData)elP=elSection.find("[data-pair="+pair+"]"),decimalLen=getDecimalLen(pair,fiatCurrencies),sell=Utils.trimX(arData[pair].sell_price,decimalLen),buy=Utils.trimX(arData[pair].buy_price,decimalLen),sell.length>10&&(sell=Utils.limitFloatLength(sell,10)),buy.length>10&&(buy=Utils.limitFloatLength(buy,10)),elP.find(".sprice").text(sell),elP.find(".bprice").text(buy)}$timeout(function(){$scope.flash()},10)},$scope.initFlashItems=function(){var i;for(i in $scope.items){var r=$scope.items[i];$scope.flash_items[i]=parseFloat(r.buy_price)}},$scope.flash=function(){var i,needFlash={};for(i in $scope.items){var r=$scope.items[i];$scope.flash_items[i]>r.buy_price&&(needFlash[i]="pair_low"),$scope.flash_items[i]<r.buy_price&&(needFlash[i]="pair_high"),$scope.flash_items[i]=r.buy_price}for(var i in needFlash)flashOnePair(i,needFlash[i])};var flashOnePair=function(pair,klass){null!=flashTimers[pair]&&($timeout.cancel(flashTimers[pair]),flashTimers[pair]=null);var klassToRemove="pair_high";"pair_high"==klass&&(klassToRemove="pair_low");var elPair=$("[data-pair="+pair+"]");elPair.removeClass(klassToRemove).addClass(klass),flashTimers[pair]=$timeout(function(){void 0!==elPair&&null!=elPair&&elPair.removeClass("pair_high").removeClass("pair_low")},3e3)},getDecimalLen=function(pair,fiatCurrencies){var decimalLength=8;return null==pair||null==fiatCurrencies?decimalLength:(Settings.pair_decimal_length[pair]&&(decimalLength=Settings.pair_decimal_length[pair]),+decimalLength)}}).controller("LandNewChartCtrl",function($scope,$element,$http,Alert,Settings){$scope.chart=$(".block-chart"),$scope.title=$("#block-title"),$scope.currency="BTC",$scope.pair="BTC_USD",$scope.period="1y",$scope.descriptions={},$scope.load=function(period){$scope.period=period,$scope.chart.empty(),$scope.chart.append('<iframe src="/ctrl/getTemplate?name=chart_land_new&pair='+$scope.pair+"&period="+$scope.period+"&lang="+Settings.lang+"&release="+Settings.release+'" vspace="0px" scrolling="no" style="width: 1136px;" width="1136px;" height="368px;"></iframe>')},$scope.setPair=function(pair){$scope.pair=pair,$scope.load($scope.period)},$scope.setCurrency=function(currency){$scope.currency=currency,$scope.title.text(tt("[1] Price Charts",[$scope.descriptions[$scope.currency]])),$http.post("/ctrl/landing/pairs",{name:$scope.currency}).success(function(response){if(1==response.success){$scope.pair=response.data[0].id;(new ButtonGroups).init($("#button_group_pair"),{selected:$scope.pair,buttons:response.data,className:"graph-btn graph-currency",activeClassName:"active",onSelect:function(id){$scope.setPair(id)}}),$scope.setPair($scope.pair)}}).error(function(){})},$scope.init=function(){var buttons=[];Object.keys(Settings.currencies).map(function(key){var currency=Settings.currencies[key];null==currency.name||currency.isFiat||($scope.descriptions[currency.name]=currency.description,buttons.push({id:currency.name,title:currency.description}))}),(new ButtonGroups).init($("#button_group_crypt"),{selected:$scope.currency,buttons:buttons,className:"graph-btn graph-currency",activeClassName:"active",onSelect:function(currency){$scope.setCurrency(currency)}}),(new ButtonGroups).init($("#button_group_period"),{selected:$scope.period,buttons:[{title:tt("Day_1"),id:"1d"},{title:tt("Week_1"),id:"7d"},{title:tt("Month_1"),id:"1m"},{title:tt("Year_1"),id:"1y"}],className:"graph-btn graph-currency",activeClassName:"active",onSelect:function(period){$scope.load(period)}}),$scope.setCurrency($scope.currency)},$scope.init()}),angular.module("AuthPage",[]).controller("AuthPageCtrl",function($scope,$http,User,$element,Alert){$scope.User=User,$scope.elLogin=$element.find("#input_mail"),$scope.elPassword=$element.find("#input_pass"),
$scope.elTOTP=$element.find("#input_totp"),$scope.show_totp=!1,$scope.doLogin=function(){return $http.post("/ctrl/userLogin",{login:$scope.elLogin.val(),password:$scope.elPassword.val(),totp:$scope.elTOTP.val()}).success(function(data){1!=data.success?((data.error.indexOf("10208")>-1||data.error.indexOf("10209")>-1||data.error.indexOf("SMS")>-1)&&($scope.show_totp=!0),Alert.msg(data.error)):window.location.href="/"}).error(function(data,status,headers,config){Alert.msg(tt("Error 10160: Server problem"))}),!1}}),angular.module("Verification",[]).service("VerifyFiles",function($http){var self=this;self.files={},self.indexFiles=function(){return $http.post("/ctrl/verify/indexFiles",{csrf_token:app.csrf_token})},self.removeFile=function(id,currentTab){return $http.post("/ctrl/verify/removeFile",{csrf_token:app.csrf_token,id:id,tab:currentTab})},self.setFiles=function(newFiles){var defaultFiles={identity:{},address:{},agreement:{}};if(null==newFiles)return void(self.files=defaultFiles);null!=newFiles.identity&&(defaultFiles.identity=newFiles.identity),null!=newFiles.address&&(defaultFiles.address=newFiles.address),null!=newFiles.agreement&&(defaultFiles.agreement=newFiles.agreement),self.files=defaultFiles},self.setFiles(null)}).service("VerificationUi",function(){var self=this;self.countries={},self.passport_countries={},self.yearsInFuture=function(){var i,currentYear,years=[];for(currentYear=(new Date).getFullYear(),i=currentYear;i<currentYear+30;i++)years.push({value:i,title:i+""});return years},self.yearsInPast=function(){var i,currentYear,years=[];for(currentYear=(new Date).getFullYear(),i=currentYear;i>1929;i--)years.push({value:i,title:i+""});return years},self.days=function(){var i,days=[];for(i=1;i<=31;i++)days.push({value:i,title:i+""});return days},self.months=function(){var i,months=[];for(i=1;i<=12;i++)months.push({value:i,title:i+""});return months},self.getCountries=function(){var result=[];for(i in self.countries)result.push({value:i,title:self.countries[i]});return result},self.getPassportCountries=function(){var result=[];for(i in self.passport_countries)result.push({value:i,title:self.passport_countries[i]});return result}}).controller("VerificationCtrl",function($scope,$http,Alert,$element,VerifyFiles,VerificationUi){$scope.VerifyFiles=VerifyFiles,$scope.VerificationUi=VerificationUi,$scope.uiInitDone=!1,$scope.status_identity_text="",$scope.status_identity_descr="",$scope.status_identity=0,$scope.status_address_text="",$scope.status_address_descr="",$scope.status_address=0,$scope.status_agreement_text="",$scope.status_agreement_descr="",$scope.status_agreement=0,$scope.current_tab=10,$scope.buttonClicked=null,$scope.idFilename=null,$scope.billFilename=null,$scope.agreementFilename=null,$scope.agreement2Filename=null,$scope.agreement3Filename=null,$scope.birthDay=null,$scope.birthMonth=null,$scope.birthYear=null,$scope.expireDay=null,$scope.expireMonth=null,$scope.expireYear=null,$scope.addressDay=null,$scope.addressMonth=null,$scope.addressYear=null,$scope.country="",$scope.pcountry="",$scope.getClassByStatus=function(status){var className="status_cancel";return 1==status&&(className="status_wait"),2==status&&(className="status_ready"),className},$scope.identityClass=$scope.getClassByStatus($scope.status_identity),$scope.addressClass=$scope.getClassByStatus($scope.status_address),$scope.agreementClass=$scope.getClassByStatus($scope.status_agreement),$scope.print=function(){return 1==User.verify_address&&1==User.verify_identity?window.open("/ctrl/verifyPrint?csrf_token="+app.csrf_token):Alert.msg(tt("Please verify your identity and your address")),!1},$scope.download=function(){1==User.verify_address&&1==User.verify_identity?window.location.href="/ctrl/verifyPrint?csrf_token="+app.csrf_token+"&download=1":Alert.msg(tt("Please verify your identity and your address"))};var elAllForms=$element.find("form"),elName=$element.find("#ver_form_name1"),elLname=$element.find("#ver_form_name2"),elPname=$element.find("#ver_form_name3"),elIdNumber=$element.find("#ver_form_doc"),elAddress=$element.find("#ver_form_address"),elCity=$element.find("#ver_form_city"),elPostal=$element.find("#ver_form_post"),elIdCardFile=$element.find("#id_card_file"),elIdCardDropzone=$element.find("#id_card_dropzone"),elAddressFile=$element.find("#address_file"),elAddressDropzone=$element.find("#address_dropzone"),elAgreementFile=$element.find("#agreement_file"),elAgreementDropzone=$element.find("#agreement_dropzone");elAllForms.attr("action","/ctrl/verify/save/?csrf_token="+app.csrf_token),"ru"!=Settings.lang&&"uk"!=Settings.lang||$element.find("#ver_patronymic").show(),$scope.makeActive=function($sel){$element.find(".sidebar_menu_active").removeClass("sidebar_menu_active").addClass("sidebar_menu_inactive");var $selRoot=$sel.closest(".tab_btn"),currentTab=$selRoot.attr("tab-name");$selRoot.removeClass("sidebar_menu_inactive").addClass("sidebar_menu_active"),$element.find(".tab_content").hide(),null!=currentTab&&$element.find(".tab_content.tab_"+currentTab).show()},$scope.btnIdentifyTab=function(e){e.preventDefault(),$scope.current_tab=10,$scope.makeActive($(e.target))},$scope.btnAddressTab=function(e){e.preventDefault(),$scope.current_tab=11,$scope.makeActive($(e.target))},$scope.btnAgreementTab=function(e){e.preventDefault(),$scope.current_tab=12,$scope.makeActive($(e.target))},$scope.fileNameChanged=function(element){void 0!=typeof element.files&&element.files.length&&$(element).siblings(".file-name-holder").html(element.files[0].name)},$scope.saveButtonClick=function(e){if(e.preventDefault(),e.stopPropagation(),12==$scope.current_tab&&(1!=User.verify_address||1!=User.verify_identity))return Alert.msg(tt("Please verify your identity and your address")),!1;try{$(e.target).closest("form").submit()}catch(err){}},$element.on("click",".save_button",$scope.saveButtonClick),$scope.showDocumentRequirements=function(){$("#popup_required_container").show()},$element.find(".documents_required").on("click",$scope.showDocumentRequirements),$scope.btnInProgress=function(p){$(".save_button").html(tt("Sending")+" "+p+"%")},$scope.btnInReady=function(){$(".save_button").html(tt("Send for verification"))},$scope.initSelects=function(){var i,selects=[{selector:"birth_year",varName:"birthYear",items:VerificationUi.yearsInPast()},{selector:"birth_month",varName:"birthMonth",items:VerificationUi.months()},{selector:"birth_day",varName:"birthDay",items:VerificationUi.days()},{selector:"expire_year",varName:"expireYear",items:VerificationUi.yearsInFuture()},{selector:"expire_month",varName:"expireMonth",items:VerificationUi.months()},{selector:"expire_day",varName:"expireDay",items:VerificationUi.days()},{selector:"address_year",varName:"addressYear",items:VerificationUi.yearsInPast()},{selector:"address_month",varName:"addressMonth",items:VerificationUi.months()},{selector:"address_day",varName:"addressDay",items:VerificationUi.days()},{selector:"country",varName:"country",items:VerificationUi.getCountries()},{selector:"pcountry",varName:"pcountry",items:VerificationUi.getPassportCountries()}],selectCb=function(newValue){$('input[name="'+this.sel+'"]').val(newValue),this.scope[this.varName]=newValue};for(i in selects){var select=selects[i],title="",placeholder="",elHidden=$element.find('input[name="'+select.selector+'"]');placeholder=elHidden.prop("placeholder");var savedValue=$scope[select.varName];if(null!=savedValue){var newTitle,newValue;"object"==typeof savedValue&&null!=savedValue.text&&null!=savedValue.value?(newTitle=savedValue.text,newValue=savedValue.value):(newTitle=savedValue,newValue=savedValue),elHidden.val(newValue),title=newTitle}var cbOptions={sel:select.selector,scope:$scope,varName:select.varName};(new Select).init($element.find("#"+select.selector+"_select"),{placeholder:placeholder,title:title,onSelect:selectCb.bind(cbOptions),items:select.items})}},$scope.fillInVerificationForm=function(data){elName.val(data.name),elLname.val(data.lname),elPname.val(data.pname),elIdNumber.val(data.pnumber),elAddress.val(data.address),elCity.val(data.city),elPostal.val(data.postal),$scope.idFilename=data.passport_filename,$scope.billFilename=data.bill_filename,$scope.agreementFilename=data.agreement_filename,$scope.agreement2Filename=data.agreement2_filename,$scope.agreement3Filename=data.agreement3_filename,$scope.expireDay=data.dt_expire_day>0?data.dt_expire_day:null,$scope.expireMonth=data.dt_expire_month>0?data.dt_expire_month:null,$scope.expireYear=data.dt_expire_year>0?data.dt_expire_year:null,$scope.addressDay=data.dt_address_day>0?data.dt_address_day:null,$scope.addressMonth=data.dt_address_month>0?data.dt_address_month:null,$scope.addressYear=data.dt_address_year>0?data.dt_address_year:null,$scope.birthDay=data.dt_birth_day>0?data.dt_birth_day:null,$scope.birthMonth=data.dt_birth_month>0?data.dt_birth_month:null,$scope.birthYear=data.dt_birth_year>0?data.dt_birth_year:null,null!=data.country&&data.country.length>0&&($scope.country={value:data.country,text:tt(data.country)}),null!=data.pcountry&&data.pcountry.length>0&&($scope.pcountry={value:data.pcountry,text:VerificationUi.passport_countries[data.pcountry]}),0!=data.identity_status&&($scope.status_identity=data.identity_status,$scope.identityClass=$scope.getClassByStatus($scope.status_identity),$element.find(".identity_save").addClass("disabled_btn_save")),void 0!=data.identity_msg&&null!=data.identity_msg?$scope.status_identity_descr=data.identity_msg:$scope.status_identity_descr="",0!=data.address_status&&($scope.status_address=data.address_status,$scope.addressClass=$scope.getClassByStatus($scope.status_address),$element.find(".address_save").addClass("disabled_btn_save")),void 0!=data.address_msg&&null!=data.address_msg?$scope.status_address_descr=data.address_msg:$scope.status_address_descr="",0!=data.agreement_status&&($scope.status_agreement=data.agreement_status,$scope.agreementClass=$scope.getClassByStatus($scope.status_agreement),$element.find(".agreement_save").addClass("disabled_btn_save")),void 0!=data.agreement_msg&&null!=data.agreement_msg?$scope.status_agreement_descr=data.agreement_msg:$scope.status_agreement_descr="",$scope.initSelects()},$scope.load=function(){$http.post("/ctrl/verify/load",{csrf_token:app.csrf_token}).success(function(resp){if(1==resp.success){var data=resp.data;if(null==data)return;null!=data.countries&&(VerificationUi.countries=data.countries),null!=data.passport_countries&&(VerificationUi.passport_countries=data.passport_countries),null!=data.list&&$scope.fillInVerificationForm(data.list),null!=data.identity_status_text&&($scope.status_identity_text=data.identity_status_text),null!=data.address_status_text&&($scope.status_address_text=data.address_status_text),null!=data.agreement_status_text&&($scope.status_agreement_text=data.agreement_status_text)}}),$scope.loadVerifyFiles(),$scope.initVerifyUpload()},$scope.initVerifyUpload=function(){var uploaders=[{sel:elIdCardFile,zone:elIdCardDropzone,tab:10},{sel:elAddressFile,zone:elAddressDropzone,tab:11},{sel:elAgreementFile,zone:elAgreementDropzone,tab:12}];$(document).bind("drop dragover",function(e){e.preventDefault()}),$.each(uploaders,function(index,uploader){uploader.sel.fileupload({url:"/ctrl/verify/addFile/?csrf_token="+app.csrf_token,dataType:"json",singleFileUploads:!0,dropZone:uploader.zone,formData:{tab:uploader.tab},acceptFileTypes:/(\.|\/)(jpe?g|png)$/i,progressall:function(e,data){var progress=parseInt(data.loaded/data.total*100,10);$scope.btnInProgress(progress)},done:function(e,resp){var data=resp.result;return $scope.btnInReady(),null==data?void Alert.msg(tt("Error 10807: File upload error")):1==data.success?void(null!=data.data&&null!=data.data.files&&VerifyFiles.setFiles(data.data.files)):void $scope.showErrror(data,tt("Error 10807: File upload error")+" [2]")},fail:function(e,data){var err=data.jqXHR;if($scope.btnInReady(),console.log(err),413==err.status)return Alert.msg(tt("Error 10800: The file you are uploading is too big"));Alert.msg(tt("Error 10809: Server error")+" #"+err.status)}})})},$scope.showErrror=function(data,defaultMessage){console.log(data),null!=data&&null!=data.error&&data.error.length>0?Alert.msg(data.error):Alert.msg(defaultMessage)},$scope.loadVerifyFiles=function(){VerifyFiles.indexFiles().then(function(resp){var data=resp.data;1==data.success?(data=data.data,null!=data.files&&VerifyFiles.setFiles(data.files)):$scope.showErrror(data,tt("Error 10808: Impossible to get the files list"))},$scope.networkError)},$scope.load(),$scope.networkError=function(err){console.log(err),Alert.msg(tt("Error 10806: Error during data transfer"))},$scope.removeVerifyFile=function(id){VerifyFiles.removeFile(id,$scope.current_tab).then(function(resp){var data=resp.data;null!=data&&1==data.success?null!=data.data&&(data=data.data,null!=data.files&&VerifyFiles.setFiles(data.files)):$scope.showErrror(data,tt("Error 10805: Error during file elimination"))},$scope.networkError)},$scope.check=function(level){$http.post("/ctrl/verify/check",{csrf_token:app.csrf_token,level:level}).success(function(resp){1==resp.success?Alert.msg(tt("Documents for verification were sent successfully")):Alert.msg(resp.error),$scope.load()})},$("form").ajaxForm({beforeSend:function(){$scope.btnInProgress(0)},uploadProgress:function(event,position,total,percentComplete){$scope.btnInProgress(percentComplete)},success:function(resp){$scope.btnInReady();try{resp=$.parseJSON(resp)}catch(e){}$scope.$apply(function(){if(1==resp.success){var currentTab=$scope.current_tab;10==currentTab&&1==resp.data.identity_filled||11==currentTab&&1==resp.data.address_filled||12==currentTab&&1==resp.data.agreement_filled?Alert.question(tt("Please check that all fields at form were filled. Send it to verification?"),function(choice){!0===choice&&$scope.check(currentTab)}):Alert.msg(tt("Please check that all fields at form were filled")),$scope.load()}else Alert.msg(resp.error)})},complete:function(xhr){$scope.btnInReady();try{var r=$.parseJSON(xhr.responseText);null!=r&&null!=r.error&&r.error.length>0&&Alert.msg(r.error)}catch(err){}},error:function(err){if($scope.btnInReady(),null!=err)if(200==err.status)try{var r=$.parseJSON(err.responseText);null!=r&&null!=r.error&&r.error.length>0?Alert.msg(r.error):Alert.msg(tt("Error 10579"))}catch(e){}else 413==err.status?Alert.msg(tt("Error 10800: The file you are uploading is too big")):Alert.msg(tt("Error 10579: Server error")+" #"+err.status)}})}).controller("VerifyPopupCtrl",function($scope,$element){$scope.maction=function(){$element.hide()},$scope.init=function(){$(".popup_container, .popup_close, .btn_apply").on("click touch",function(e){e.preventDefault(),e.stopPropagation(),$scope.maction()}),$(".popup").on("click touch",function(e){e.stopPropagation()})}}),angular.module("Affiliate",[]).controller("AffiliateCtrl",function($scope,$http,Alert,$element,$rootScope){$scope.wallets=[],$scope.pairs=[],$scope.mode=void 0,$scope.banners={"250x250":{id:1},"300x250":{id:2},"468x60":{id:3},"728x90":{id:4}};var clipboard=new Clipboard(".button_copy");clipboard.on("success",function(){$scope.notifications.show()}),clipboard.on("error",function(e){}),$scope.init=function(ref_url){$scope.ref_url=ref_url,$scope.setBanner("250x250"),$scope.setMode("refferal"),$scope.load(),$scope.notifications=new Notifications,$scope.notifications.init($(".notifications"),{title:tt("Copied to clipboard")})},$scope.load=function(){$http.post("/ctrl/affiliateStat",{csrf_token:app.csrf_token}).success(function(resp){1==resp.success&&($scope.wallets=resp.data.wallets,$scope.pairs=resp.data.pairs)})},$scope.move=function(curr){Alert.question(tt("Transfer funds from affiliate program's wallet to your account's wallet?"),function(answ){1==answ&&$http.post("/ctrl/affiliateMove",{csrf_token:app.csrf_token,curr:curr}).success(function(resp){1==resp.success?(Alert.msg(tt("It has been transferred successfully")+" "+resp.data.msg),$scope.wallets=resp.data.wallets,$scope.pairs=resp.data.pairs):Alert.msg(resp.error)})})},$rootScope.$on("SOCKET_MESSAGE",function(e,args){"REFRESH_AFFILIATE"==args.msg&&$scope.load()}),$scope.setMode=function(mode){$scope.mode=mode},$scope.active=function(mode){return $scope.mode==mode?"btn_active":""},$scope.setBanner=function(banner){var langSaffix="ru"===Settings.lang?"_ru":"";$scope.banner=banner;var config=$scope.banners[banner];$scope.banner_id=config.id+langSaffix,$scope.banner_code='<a rel="nofollow" href="'+$scope.ref_url+'"\r\n target="_blank"\r\n style="display:block!important">\r\n<img src="https://exmo.com/static/img/affiliate/affiliate'+$scope.banner_id+'.png"\r\n alt="EXMO affiliate program"\r\n title="EXMO bitcon banner"\r\n border="0"\r\n style="display:block!important"/>\r\n</a>'},$scope.active2=function(banner){return $scope.banner==banner?"btn_active":""}}).filter("smartRound",function($filter){return function(number){if(number){isNaN(number)&&(number=0);var numberString=number.toString(),index=numberString.lastIndexOf(".");if(numberString.length>8&&-1!=index){var fractionSize=0;return-1==index?number:(8-index>0&&(fractionSize=8-index),$filter("number")(number,fractionSize))}return number}return 0}}),angular.module("Fees",[]).controller("FeesCtrl",function($scope,$http,Alert,$element){$scope.limits=[],$scope.fees=[];var elCurrencyFilter=$element.find("#currency_buttons_filter"),elViewFilter=$element.find("#groups_view_filter"),viewFilterChanged=function(selected){null!=selected&&("all"==selected?$(".show_hide_block").show():($(".show_hide_block").hide(),$(".show_hide_block."+selected).show()),"limits_block"==selected?elCurrencyFilter.hide():elCurrencyFilter.show())},currencyFilterChanged=function(selected){null!=selected&&(selected=selected.toLowerCase(),"all"==selected?$(".feegroup").show():($(".feegroup").hide(),$(".feegroup_"+selected).show()))};$scope.loadFeesAndLimits=function(){$http.post("/ctrl/feesAndLimits").success(function(resp){if(1!=resp.success)return void Alert.msg(resp.error);var data=resp.data;null!=data&&(null!=data.limits&&($scope.limits=data.limits),null!=data.fees&&($scope.fees=data.fees))}).error(function(){Alert.msg(tt("Error 10649: Server problem"))})},$scope.init=function(){(new Select).init(elViewFilter,{onSelect:viewFilterChanged,title:tt("Fees &amp; Limits"),items:[{value:"all",title:tt("Fees &amp; Limits")},{value:"comm_block",title:tt("Fees")},{value:"limits_block",title:tt("Limits")}]});var currencies=Settings.currencies,buttons=[{id:"all",title:tt("All Currencies")}];Object.keys(currencies).map(function(key,index){var currency=currencies[key];null!=currency.name&&currency.isFiat&&buttons.push({id:currency.name,title:currency.name})}),buttons.push({id:"crypto",title:tt("Cryptocurrency")}),(new ButtonGroups).init(elCurrencyFilter,{buttons:buttons,className:"btn btn_small_black",onSelect:currencyFilterChanged,selected:"all"}),$scope.loadFeesAndLimits()},$scope.init()}),angular.module("ApiPage",[]).controller("ApiPageCtrl",function($scope,$location,$anchorScroll,$timeout,Alert){$scope.$watch(function(){return $location.url()},function(params){$timeout(function(){var old=$location.hash();$location.hash(params.replace("https://exmo.com/","")),$anchorScroll(),$location.hash(old)},0)})}),angular.module("CashBack",[]).controller("CashBackCtrl",function($scope,$http,Alert,CashBackTabs,$location){$scope.tabToday={name:"today",urlHash:"tab-today",title:tt("Today"),h1:tt("Cashback"),isActive:!1,cashbackData:[],onInit:function(){$http.post("/ctrl/cashbackInfo",{csrf_token:app.csrf_token}).success(function(resp){if(1!=resp.success)return void Alert.msg(resp.error);$scope.tabToday.cashbackData=resp.data}).error(function(){Alert.msg(tt("Error 11000: Server problem"))})}},$scope.tabStat={name:"stat",urlHash:"tab-statistics",title:tt("Statistics_cb"),h1:tt("Cashback statistics"),isActive:!1,onInit:function(){$scope.statTabs.show("day"),$http.post("/ctrl/cashbackOldRefundHistory",{csrf_token:app.csrf_token}).success(function(resp){if(1!=resp.success)return void Alert.msg(resp.error);$scope.statTabOldCashback.cashbackHistory=resp.data}).error(function(){Alert.msg(tt("Error 11004: Server problem"))})}},$scope.headTabs=new CashBackTabs,$scope.headTabs.tabs=[$scope.tabToday,$scope.tabStat],$scope.headTabs.onActive=function(tab){$scope.h1=tab.h1,$location.hash()!==tab.urlHash&&$location.hash(tab.urlHash)};var initTabFromHash=function(){if($location.hash())for(var tabKey in $scope.headTabs.tabs){var tab=$scope.headTabs.tabs[tabKey];$location.hash()===tab.urlHash&&$scope.headTabs.show(tab.name)}};setTimeout(function(){initTabFromHash(),$.isEmptyObject($scope.headTabs.active)&&$scope.headTabs.show($scope.tabToday.name)});var currentDate=new Date,maxDate=new Date(currentDate.getTime()-864e5),makeDateString=function(date){return!!date&&date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate()};$scope.statTabDay={name:"day",title:tt("Per day"),isActive:!0,dateInput:null,dateStr:"",showClearFixBtn:!1,tradeHistory:[],setDefaultDate:function(){this.dateInput.data("datepicker").selectDate(maxDate),this.showClearFixBtn=!1},setDateStr:function(){this.dateStr=this.dateInput.val()},onInit:function(){var dateContainer=$("#stat-calendar_day");this.dateInput=dateContainer.find("input");var self=this;this.dateInput.datepicker({todayButton:!1,maxDate:maxDate,autoClose:!0,onSelect:function(formattedDate,date){self.dateInput.val()&&(self.showClearFixBtn=!0,self.setDateStr(),$http.post("/ctrl/cashbackInfoHistory",{csrf_token:app.csrf_token,date:makeDateString(date)}).success(function(resp){if(1!=resp.success)return void Alert.msg(resp.error);self.tradeHistory=resp.data}).error(function(){Alert.msg(tt("Error 11002: Server problem"))}))}}),dateContainer.on("click",function(){$(this).find("input[type=text]").trigger("focus")}),this.setDefaultDate(),this.setDateStr()}},$scope.statTabRange={name:"range",title:tt("For a period"),isActive:!1,dateInput:null,dateStr:"",showClearFixBtn:!1,tradeHistory:[],setDefaultDate:function(){this.dateInput.data("datepicker").selectDate([maxDate,new Date(maxDate.getTime()-2592e6)]),this.showClearFixBtn=!1},setDateStr:function(){this.dateStr=this.dateInput.val()},onInit:function(){var dateContainer=$("#stat-calendar_period");this.dateInput=dateContainer.find("input");var self=this;this.dateInput.datepicker({todayButton:!1,maxDate:maxDate,autoClose:!0,onSelect:function(formattedDate,date){2==date.length&&(self.showClearFixBtn=!0,self.setDateStr(),$http.post("/ctrl/cashbackTradeSummaryByPeriod",{csrf_token:app.csrf_token,date_begin:makeDateString(date[0]),date_end:makeDateString(date[1])}).success(function(resp){if(1!=resp.success)return void Alert.msg(resp.error);self.tradeHistory=resp.data}).error(function(){Alert.msg(tt("Error 11006: Server problem"))}))}}),dateContainer.on("click",function(){$(this).find("input[type=text]").trigger("focus")}),this.setDefaultDate(),this.setDateStr()}},$scope.statTabOldCashback={name:"old-cashback",title:tt("Cashback pays-off history"),isActive:!1,cashbackHistory:[]},$scope.statTabs=new CashBackTabs,$scope.statTabs.tabs=[$scope.statTabDay,$scope.statTabRange,$scope.statTabOldCashback]}).controller("CashBackRulesCtrl",function($scope,$http,Alert){$scope.cashbackInfo={},$http.post("/ctrl/cashbackInfo",{csrf_token:app.csrf_token}).success(function(resp){if(1!=resp.success)return void Alert.msg(resp.error);$scope.cashbackInfo=resp.data}).error(function(){Alert.msg(tt("Error 11000: Server problem"))})}).factory("CashBackTabs",function(){var Tabs=function(){};return Tabs.prototype.tabs=[],Tabs.prototype.active={},Tabs.prototype.onActive=function(){},Tabs.prototype.show=function(activeName){for(var tabKey in this.tabs){var tab=this.tabs[tabKey];tab.isActive=tab.name==activeName,tab.isActive&&(this.active=tab,void 0!==tab.isInit&&tab.isInit||(tab.isInit=!0,"function"==typeof tab.onInit&&tab.onInit(tab)),"function"==typeof tab.onActive&&tab.onActive(tab),this.onActive(tab))}},Tabs}),angular.module("Combobox",[]).directive("comboboxDir",function(){return{restrict:"A",scope:{active:"=comboboxDir"},link:function(scope,element,attrs){var elValue=element.find(".select_emul_selected"),elHidden=element.find("input[type=hidden]"),setValue=function(newValue){if(null==newValue||""==newValue){elHidden.val("");var placeholder=elHidden.attr("placeholder"),newText="";return null!=placeholder&&placeholder.length>0&&(newText=placeholder),elValue.text(newText),void elValue.addClass("placeholder_color")}if(elValue.removeClass("placeholder_color"),"object"==typeof newValue)return void(null!=newValue.text&&null!=newValue.value&&(elHidden.val(newValue.value),elValue.text(newValue.text).attr("value",newValue.value)));elHidden.val(newValue),elValue.text(newValue).attr("value",newValue)};setValue(scope.active),element.on("click",".select_emul_option",function(){var text=$(this).text(),value=$(this).attr("value");scope.active={text:text,value:value},elHidden.val(value),elValue.text(text).attr("value",value).trigger("change").trigger("mouseleave")}).on("mouseenter",function(){$(this).find(".select_emul_list").css("display","block"),element.addClass("active")}).on("mouseleave",function(){$(this).find(".select_emul_list").css("display","none"),element.removeClass("active")}),scope.$watch("active",function(){setValue(scope.active)})}}});var app=angular.module("App",["ExCaptcha","TopPanel","UWallets","Alert","Updater","User","Settings","Messages","Chart","Chat","FAQ","HistoryPage","NewsPage","OrdersActive","OrdersMy","ProfilePage","Rates","Recovery","Sdelki","TradePage","AuthPage","PageAddressBook","ngSanitize","Verification","Affiliate","IO","LandingNew","Fees","ApiPage","WalletPage","Sound","ArticlesPage","CashBack","Combobox","ngNotify","ngCookies","Register","Login","ExchangePage","Carousel","Utm","Referral"]);app.run(function(User,UWallets,HistoryPage,OrdersMy,Sdelki,OrdersActive,TradePage,Rates,Updater,IO,$http,$rootScope,Alert,Utm,Referral){$rootScope.goto=function(url){window.location.href=url},User.init(),Updater.init(),Utm.checkUtm(),TradePage.init(),Referral.checkReferral();var parsed=UrlParser.get(window.location.href);path=parsed.pathname,"exchange"==Utils.getCurrentSite()&&"/"==path&&(Rates.init(),app.auth&&OrdersMy.refresh(TradePage.pair),Sdelki.refresh(TradePage.pair)),app.SignedRequest=function(url,params,success_cb,error_cb,cancel_cb){$http.post(url,params).success(function(resp){"Error 10430"==resp.error?0==User.auth_type&&params.use_totp?Alert.totp(function(a,kod){if(!a)return void("function"==typeof cancel_cb&&cancel_cb());void 0!=kod&&null!=kod&&0!=kod.length&&(params.sign=kod,$http.post(url,params).success(function(resp){success_cb(resp)}).error(function(data,status,headers,config){error_cb(data,status,headers,config)}))}):0==User.auth_type?Alert.pwd(function(a,kod){if(!a)return void("function"==typeof cancel_cb&&cancel_cb());void 0!=kod&&null!=kod&&0!=kod.length&&(params.sign=kod,$http.post(url,params).success(function(resp){success_cb(resp,params)}).error(function(data,status,headers,config){error_cb(data,status,headers,config)}))}):(2==User.auth_type&&$http.post("/ctrl/sendSms",{csrf_token:app.csrf_token}),Alert.totp(function(a,kod){if(!a)return void("function"==typeof cancel_cb&&cancel_cb());void 0!=kod&&null!=kod&&0!=kod.length&&(params.sign=kod,$http.post(url,params).success(function(resp){success_cb(resp,params)}).error(function(data,status,headers,config){error_cb(data,status,headers,config)}))})):success_cb(resp)}).error(function(data,status,headers,config){error_cb(data,status,headers,config)})}});var pingPageFunc=function(){var counter=10,alert=!1,pingPageCallback=function(){var htmlString=$("body").html().toString();0==alert&&"function"==typeof htmlString.indexOf&&-1!=htmlString.indexOf("Для подтверждения входа")&&null!=User&&null!=User.token&&$.ajax({url:"/ctrl/ping",type:"POST",dataType:"json",data:JSON.stringify({csrf_token:User.token,pong:!0}),contentType:"application/json"}).done(function(){alert=!0}),counter>0&&0==alert&&(counter-=1,setTimeout(pingPageCallback,5e3))};pingPageCallback()};setTimeout(pingPageFunc,5e3),angular.module("WalletPage",[]).controller("WalletPageCtrl",function($scope,$element,Alert,$rootScope,IO,UWallets,$http){IO.init(),$scope.IO=IO;const MODES={wallet:"wallet",action:"action"},PROVIDER_TITLES={deposit:tt("Choose the method for refilling your account"),withdraw:tt("Choose the method for withdrawing funds"),"crypt-deposit":tt("Deposit method"),"crypt-withdraw":tt("Withdraw method"),"excode-deposit":tt("Deposit method"),"excode-withdraw":tt("Withdraw method")},DIRECTION_TITLES={};$scope.providers_element=$element.find(".exch_paysys_list"),$scope.selected_mode=MODES.wallet,$scope.selected_direction=null,$scope.selected_currency=null,$scope.selected_provider=null,$scope.zeebaUpdate=function(){var count=1;$element.find(".wallet_table_bills tr:not(.hidden)").each(function(){$(this).hasClass("no-information")||(count++%2==1?$(this).css("background-color","#fbfbfb"):$(this).css("background-color","white"))})},$scope.$on("WALLET_SETTINGS_INIT",function(){$element.find(".btn_wallet").removeAttr("disabled")}),$scope.$on("WALLET_SETTINGS_UPDATE",function(event,arg){$element.find("tr[data-curr="+arg.name+"]").toggleClass("hidden",!arg.val);var totalPair=$element.find("tr[data-curr]").length,tottalHiddenPair=$element.find("tr[data-curr].hidden").length;$element.find(".wallet_table_bills .no-information").toggleClass("hidden",totalPair-tottalHiddenPair>0),$scope.zeebaUpdate()}),$scope.$on("WALLET_SETTINGS_ZEEBA_UPDATE",function(){$scope.zeebaUpdate()}),$rootScope.$on("WALLET_DISABLE_PAYSYS_LIST",function(){$scope.providers_element.find(".exch_paysys_item").attr("disabled",!0)}),$rootScope.$on("WALLET_ENABLE_PAYSYS_LIST",function(){$scope.providers_element.find(".exch_paysys_item").attr("disabled",!1)}),$rootScope.$on("WALLETS_UPDATED",function(){for(var i in UWallets.items){var amount,deffered,item=UWallets.items[i],elAmount=$element.find("tr[data-curr="+item.typename+"]").find(".item_amount"),elDeffered=$element.find("tr[data-curr="+item.typename+"]").find(".item_deffered");amount=Utils.limitFloatLength(item.amount,12),deffered=Utils.limitFloatLength(item.deffered,12),elAmount.text(amount),elAmount.attr("title",item.amount),elDeffered.text(deffered),elDeffered.attr("title",item.deffered)}}),$scope.providers_element.on("click touch",".provider_radio",function(event){$scope.selectProvider(event)}),$scope.showForm=function(event){$scope.selected_currency=$(event.currentTarget).attr("data-currency"),$scope.selected_direction=$(event.currentTarget).attr("data-direction"),IO.generateProvidersList($scope.providers_element,$scope.selected_currency,$scope.selected_direction),$scope.selectFirst($scope.providers_element)},$scope.selectFirst=function(el){0==el.find(":radio[checked=true]").length&&angular.element($(el.find(":radio")[0])).trigger("click")},$scope.hideForms=function(){$("#deposit, #withdraw, #crypt-deposit, #crypt-withdraw, #excode-deposit, #excode-withdraw").hide()},$scope.detectCurrentBlockId=function(){return"EX-CODE"==$scope.selected_currency?"excode-"+$scope.selected_direction:IO.isCrypta($scope.selected_currency)?"crypt-"+$scope.selected_direction:$scope.selected_direction},$scope.checkAvailability=function(){return!IO.isCrypta($scope.selected_currency)||"deposit"!==$scope.selected_direction||void 0==$scope.selected_provider.crypt_available||$scope.selected_provider.crypt_available},$scope.selectProvider=function(event){var info_panel=$element.find("#info"),verify_panel=$element.find("#verify"),verify_card_panel=$element.find("#verify-card"),providerId=$(event.currentTarget).val();if($scope.selected_provider=IO.getProvider($scope.selected_currency,$scope.selected_direction,providerId),!$scope.checkAvailability())return void Alert.msg(ttt("Deposit are temporarily not available. Please, try again later."));$scope.hideForms(),info_panel.empty(),$scope.blockId=$scope.detectCurrentBlockId(),$scope.title=PROVIDER_TITLES[$scope.blockId],$scope.selected_mode=MODES.action;var loadProviderForm=function(){
verify_panel.hide(),verify_card_panel.hide(),IO.updateProviderInfoPanel(info_panel,$scope.selected_provider,DIRECTION_TITLES[$scope.blockId]||"");var view=$element.find("#"+$scope.blockId);view.show(),IO.createForm($scope.selected_provider,$scope.selected_direction,view),$rootScope.$broadcast("SHOW_FORM_"+$scope.blockId.toUpperCase(),{provider:$scope.selected_provider})};return User.verify_status<$scope.selected_provider.need_ident?void verify_panel.show():$scope.selected_provider.need_verify_card?void $http.post("/ctrl/verifiedCardsList",{csrf_token:app.csrf_token}).success(function(resp){if(1==resp.success){if(!resp.data.cards.length)return void verify_card_panel.show();$scope.selected_provider.verified_cards=resp.data.cards,loadProviderForm()}else Alert.msg(resp.error)}):void loadProviderForm()},$scope.mode=function(mode){$scope.selected_mode=mode,$scope.blockId&&$rootScope.$broadcast("HIDE_FORM_"+$scope.blockId.toUpperCase())},$scope.goto=function(url){window.location.href=url};try{~location.search.indexOf("register=success")&&(fbq("track","CompleteRegistration"),qp("track","Generic"))}catch(e){}}).controller("WalletHistoryCtrl",function($scope,$element,Alert,$http,$rootScope){$scope.items=[],$scope.page=parseInt($_GET.page,10),isNaN($scope.page)&&($scope.page=1),$scope.loadHistory=function(page){return new Promise(function(resolve,reject){$http.post("/ctrl/wallet_history",{csrf_token:app.csrf_token,format:"html",page:page}).success(function(resp){$element.find(".progress").hide(),1==resp.success?($element.find(".no-information").toggle(0==resp.data.items.length),$scope.items=resp.data.items,$scope.total!=resp.data.total&&($scope.total=resp.data.total,$scope.paginator.updateTotal($scope.total))):$element.find(".unavailable").toggle(!0),resolve()})})},$scope.init=function(){$scope.paginator=new Paginator,$scope.paginator.init($element.find("#paginator"),0,{perPage:15,onSelect:function(page){$scope.page=page,$scope.loadHistory($scope.page)}}),$scope.loadHistory($scope.page)},$rootScope.$on("SOCKET_MESSAGE",function(e,args){"REFRESH_MY_WALLETS"==args.msg&&$scope.loadHistory($scope.page)}),$element.on("click",function(e){if($(e.target).hasClass("cell_resend")&&$(e.target).parent().find(".cell_task_id").length>0){var id=$($(e.target).parent().find(".cell_task_id")[0]).text();$scope.resendConfirmMail(id)}}),$scope.resendConfirmMail=function(id){$http.post("/ctrl/withdrawResend",{csrf_token:app.csrf_token,id:id}).success(function(resp){1==resp.success?Alert.msg(tt("e-mail repeatedly sent")):Alert.msg(resp.error)}).error(function(){Alert.msg(tt("Error 10341: Server problem"))})},$scope.init()}).directive("compile",function($compile,$parse){return{restrict:"A",link:function(scope,element,attr){scope.$watch(attr.content,function(){element.html($parse(attr.content)(scope)),$compile(element.contents())(scope)},!0)}}}).controller("WalletSettingsCtrl",function($rootScope,$scope,$http){$scope.settings=[],$scope.load=function(){$http.post("/ctrl/wallet_settings",{csrf_token:app.csrf_token}).success(function(resp){$scope.settings=resp.data.list,$rootScope.$broadcast("WALLET_SETTINGS_ZEEBA_UPDATE")})},$scope.load(),$scope.save=function(name,val){return $http.post("/ctrl/wallet_settings",{csrf_token:app.csrf_token,action:"save",name:name,val:val}).success(function(){$rootScope.$broadcast("WALLET_SETTINGS_UPDATE",{name:name,val:val})}),!1}}).controller("WalletPageTotalCtrl",function($scope,$element,$http,$rootScope,Alert,UWallets){var elTotal=$element.find(".walet_total_sum"),currencySelector=$element.find(".select-currency");$scope.activeCurrency=currencySelector.attr("data-currency"),$scope.allCurrencies=[{title:"BTC",value:"BTC"},{title:"USD",value:"USD"}],(new Select).init(currencySelector,{scrollable:!1,title:$scope.activeCurrency,onSelect:function(currency){$scope.activeCurrency!=currency&&($scope.activeCurrency=currency,$scope.recalcTotal())},items:$scope.allCurrencies}),$scope.recalcTotal=function(){$http.post("/ctrl/wallet_convert",{csrf_token:app.csrf_token,currency:$scope.activeCurrency}).then(function(resp){var data=resp.data;1==data.success&&null!=data.data?(data=data.data,data.currency==$scope.activeCurrency&&null!=data.total&&(elTotal.text(data.total),UWallets.total=data.total+" "+data.currency)):null!=data.error?Alert.msg(data.error):(console.log(resp),Alert.msg(tt("Error 201: Server error")))},function(err){console.log(err),Alert.msg(tt("Error 201: Server error"))})},$scope.init=function(){$scope.recalcTotal(),$rootScope.$on("SOCKET_MESSAGE",function(e,args){"REFRESH_MY_WALLETS"==args.msg&&$scope.recalcTotal()})},$scope.init()}).controller("WalletUnconfirmedCtrl",function($scope,$element,$http,$rootScope,$window){var elRoot=$element;$scope.transactions=[],$scope.unconfirmedCnt=$scope.transactions.length,$scope.loadTransactions=function(){$http.post("/ctrl/wallet_unconfirmed",{csrf_token:app.csrf_token}).then(function(resp){var data=resp.data;if(null!=data&&1==data.success&&null!=data.data){if(data=data.data,null!=data.transactions)return $scope.transactions=data.transactions,$scope.unconfirmedCnt=data.transactions.length,void elRoot.show()}else console.log("unconfirmed transactions load error",resp);elRoot.hide()},function(err){console.log(err)})},$scope.loadTransactions(),$scope.openLink=function(addr,e){null!=e&&e.preventDefault(),"string"==typeof addr&&addr.length>0&&$window.open(addr,"_blank")},$rootScope.$on("SOCKET_MESSAGE",function(e,args){"REFRESH_MY_WALLETS"==args.msg&&$scope.loadTransactions()})}),angular.module("PageAddressBook",[]).controller("PageAddressBookCtrl",function($scope,$element,$http,IO,Settings,Alert){IO.init(),$scope.IO=IO,$scope.items=[];const MODES={accounts:"accounts",edit:"edit",create:"create"};$scope.providers_element=$element.find(".exch_paysys_list"),$scope.currency_selector=$element.find(".currency_select"),$scope.account_name=$element.find("[name=ab_account_name]"),$scope.selected_mode=MODES.accounts,$scope.selected_currency="ru"==Settings.lang?"RUB":"USD",$scope.providers_element.on("click touch",".provider_radio",function(event){$scope.selectProvider(event)}),$scope.selectProvider=function(event){var providerId=$(event.currentTarget).val();$scope.selected_provider=IO.getProvider($scope.selected_currency,"withdraw",providerId),IO.createForm($scope.selected_provider,"withdraw",$element)},$scope.init=function(){$http.post("/ctrl/wallet_address_book",{csrf_token:app.csrf_token,action:"init"}).success(function(resp){$scope.items=resp.data.items,$scope.providers=resp.data.providers,$scope.forms=resp.data.forms,$element.find(".progress").hide(),$element.find(".no-information").toggle(0==$scope.items.length),$scope.currencies=resp.data.curr_items.map(function(key){return{value:key,title:key+IO.getCurrDesc(key)}}),$scope.currency_selector.each(function(){$scope.select=new Select,$scope.select.init($(this),{title:$scope.selected_currency+IO.getCurrDesc($scope.selected_currency),onSelect:function(id){$scope.selected_currency=id,IO.generateProvidersList($scope.providers_element,$scope.selected_currency,"withdraw"),$scope.selectFirst($scope.providers_element)},items:$scope.currencies})})})},$scope.mode=function(mode){$scope.selected_mode=mode,$element.find(".no-information").toggle(0==$scope.items.length)},$scope.validate=function(){return""!==$scope.account_name.val().trim()},$scope.save=function(){$scope.in_progress=!0;var fields={};$element.find("input").each(function(){fields[$(this).attr("name")]=$(this).val()});var main=$scope.forms[$scope.selected_currency][$scope.selected_provider.name].main_field;$http.post("/ctrl/wallet_address_book",{csrf_token:app.csrf_token,action:"save",curr:$scope.selected_currency,provider:$scope.selected_provider.name,name:fields.ab_account_name,key:fields[main],fields:fields,id:$scope.edited_id}).success(function(resp){1==resp.success?(IO.init(),$scope.items=resp.data.items,Alert.msg(tt("Requisite saved successfully"))):Alert.msg(resp.error),$scope.in_progress=!1})},$scope.delete=function(id){Alert.question(tt("Do you really want to delete it?"),function(answer){answer&&$http.post("/ctrl/wallet_address_book",{csrf_token:app.csrf_token,action:"del",id:id}).success(function(resp){1==resp.success&&($scope.items=resp.data.items,$element.find(".no-information").toggle(0==$scope.items.length))})})},$scope.edit=function(id){$scope.edited_id=id,$scope.mode(MODES.edit),$scope.select.enabled(!1);var account=IO.getAccountsById(id);$scope.selected_provider=IO.getWithdrawProviderByName(account.provider),$scope.selected_currency=$scope.selected_provider.curr,$scope.account_currency=$scope.selected_provider.curr+IO.getCurrDesc($scope.selected_provider.curr),$scope.select.setSelected({title:$scope.account_currency+IO.getCurrDesc($scope.account_currency),value:$scope.account_currency},!0),IO.generateProvidersList($scope.providers_element,$scope.selected_provider.curr,"withdraw",!0),$($scope.providers_element.find(":radio[value="+$scope.selected_provider.id+"]")).prop("checked",!0),IO.createForm($scope.selected_provider,"withdraw",$element);for(var el,inputs=$element.find("input"),i=0;i<inputs.length;i++)el=$(inputs[i]),account.fields[el.attr("name")]&&el.val(account.fields[el.attr("name")]);$scope.account_name.val(account.name)},$scope.add=function(){$scope.edited_id=null,$scope.mode(MODES.create),$scope.select.enabled(!0),$scope.select.setSelected($scope.currencies[0]),IO.generateProvidersList($scope.providers_element,$scope.selected_currency,"withdraw"),$scope.selectFirst($scope.providers_element),$scope.account_name.val("")},$scope.selectFirst=function(el){0==el.find(":radio[checked=true]").length&&angular.element($(el.find(":radio")[0])).trigger("click")},$scope.init()}),angular.module("Sound",[]).factory("SoundService",function(){var library={dingdong:{url:"/static/sounds/dingdong.mp3",sound:null}};return{playSound:function(soundName){library[soundName]&&(library[soundName].sound||(library[soundName].sound=new Howl({src:[library[soundName].url],html5:!0,onplayerror:function(){library[soundName].sound.once("unlock",function(){library[soundName].sound.play()})}})),library[soundName].sound.play())}}}),function(exports){"use strict";var NewsCounterConstructor=function(){var self=this;return self.url="/ctrl/newsCheck",self.cnt=0,self.widgetClass="user_block_news",self.counterClass="user_block_news_title",self.cb=function(resp){null!=resp&&null!=resp.data&&null!=resp.data.cnt&&parseInt(resp.data.cnt)>=0&&(self.cnt=Math.abs(parseInt(resp.data.cnt))),self.updateView()},self.updateView=function(k){null!=k&&(self.cnt=Math.abs(parseInt(k))),-1!==window.location.href.indexOf("/news")&&(self.cnt=0);var $elCounter=$("."+self.counterClass),$elWidget=$("."+self.widgetClass);$elCounter.text(self.cnt),self.cnt>0?$elWidget.show():$elWidget.hide(),self.cnt>1?$elCounter.show():$elCounter.hide()},self.check=function(){var csrf_token="";void 0!==app&&void 0!=app.csrf_token&&(csrf_token=app.csrf_token),$.ajax({type:"POST",url:self.url,data:JSON.stringify({csrf_token:csrf_token}),success:function(resp){try{self.cb(resp)}catch(e){self.cb()}}})},self};exports.NewsCounterConstructor=NewsCounterConstructor}(this),function(exports){"use strict";var NewsListConstructor=function(){var self=this;return self.url="/ctrl/newsList/list",self.class_name="news_box",self.year=null,self.page=1,self.total_pages=0,self.updateViewHandler=null,self.loadPage=function(page){void 0==page&&(page=1),self.page=page;var year,month;"undefined"!=typeof $_GET&&void 0!=$_GET.year&&(year=parseInt($_GET.year,10)),"undefined"!=typeof $_GET&&void 0!=$_GET.month&&(month=parseInt($_GET.month,10));var uid=void 0;"undefined"!=typeof User&&void 0!=User.id&&(uid=User.id);var csrf_token=void 0;void 0!==app&&void 0!=app.csrf_token&&(csrf_token=app.csrf_token),self.request(page,csrf_token,year,month,uid,self.updateView)},self.updateView=function(resp){void 0!==resp&&void 0!==resp.data&&(resp=resp.data,self.total_pages=resp.pages,void 0!=resp.list&&$("."+self.class_name).append(resp.list),"function"==typeof self.updateViewHandler&&self.updateViewHandler())},self.request=function(page,csrf_token,year,month,uid,cb){$.ajax({type:"POST",url:self.url,data:JSON.stringify({csrf_token:csrf_token,page:page,uid:uid,year:year,month:month,format:"html"}),success:function(resp){try{"function"==typeof cb&&cb(resp)}catch(e){cb()}}})},self.initCalendar=function($element){var year=self.year,menu=$($element).find(".menu_wiki");menu.empty();var tpl="",monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];$.ajax({type:"POST",url:"/ctrl/newsList/calendar",data:JSON.stringify({csrf_token:app.csrf_token,year:year}),success:function(resp){if(1==resp.success){var months=resp.data.months.map(function(item){return parseInt(item)});monthNames.forEach(function(month,index){if(-1!=months.indexOf(index+1)){var isActive=void 0!=$_GET.year&&$_GET.year==year&&void 0!=$_GET.month&&$_GET.month==index+1;tpl=li('<a href="/news?year='+year+"&month="+(index+1)+'" class="'+(isActive?"menu_wiki_active":"")+'">'+tt(month)+"</a>")+tpl}}),menu.append(tpl)}}})},self.initImage=function($element){$($element).find(".news_text > img").each(function(){var src=$(this).attr("src");$(this).replaceWith('<a class="img-mfp" href="'+src+'">                <img src="'+src+'" alt="" class="img-responsive"/>                </a>')}),$($element).find(".img-mfp").magnificPopup({type:"image",mainClass:"mfp-with-zoom",zoom:{enabled:!0,duration:300,easing:"ease-in-out",opener:function(openerElement){return openerElement.is("img")?openerElement:openerElement.find("img")}}})},self.init=function($element){for(var current_year=($element.find(".month_select"),(new Date).getFullYear()),list=[],i=current_year;i>current_year-4;i--)list.push({title:i,value:i});"undefined"!=typeof $_GET&&void 0!=$_GET.year?self.year=parseInt($_GET.year,10):self.year=(new Date).getFullYear(),(new Select).init($(".month_select"),{title:self.year,onSelect:function(value){self.year=value,self.initCalendar($element)},items:list})},self};exports.NewsListConstructor=NewsListConstructor}(this),angular.module("ExchangePage",[]).controller("ExchangeCtrl",function($scope,$http,$element,$timeout,UWallets,$rootScope,Alert,IO,TradePage){if($scope.IO=IO,$scope.arCurr=[],$scope.arCurr2=[],$scope.active_curr1="BTC",$scope.active_curr2="USD",$scope.bestPrice=void 0,$scope.pair={},$scope.receiveInput=$element.find("[name=receive]"),$scope.giveInput=$element.find("[name=give]"),$scope.exchangeButton=$("#exchange_btn"),$scope.currency1Select=$element.find(".currency1_select"),$scope.currency2Select=$element.find(".currency2_select"),$scope.error=$element.find(".error"),$scope.giveValidationMsg=$element.find("#give_error"),$scope.receiveValidationMsg=$element.find("#receive_error"),$scope.hideClass="hide",$scope.lastDirection="basedOnGive",void 0!=$_GET&&void 0!=$_GET.pair&&Validator.isValid("pair",$_GET.pair)){var par=Utils.explode("_",$_GET.pair);void 0!=par&&void 0!=par[0]&&($scope.active_curr1=par[0],$scope.active_curr2=par[1])}$.each([$scope.receiveInput,$scope.giveInput],function(){$(this).on("click",function(){"0"==$(this).val()&&$(this).val("")}).on("blur",function(){""==$(this).val()&&$(this).val("0")})}),$rootScope.$on("WALLETS_UPDATED",function(){var amount=parseFloat($scope.strReplaceZap($scope.giveInput.val()))||0,quantity=parseFloat($scope.strReplaceZap($scope.receiveInput.val()))||0;if(0==amount&&0==quantity)return $scope.request(0,0);$scope.calculateApproximately(null,$scope.lastDirection)}),$scope.getBalance=function(name){return 0==app.auth?0:UWallets.getBalance(name)},$scope.getBalanceB=function(name){return Utils.formatProbels(UWallets.getBalance(name))},$scope.calculateApproximately=function(event,direction){event&&9==event.keyCode||($timeout.cancel($scope.wait),$scope.checkGaveValidationError(),$scope.checkReceiveValidationError(),$scope.validate()||($scope.wait=$timeout(function(){$scope.lastDirection=direction;var amount=parseFloat($scope.strReplaceZap($scope.giveInput.val()))||0,quantity=parseFloat($scope.strReplaceZap($scope.receiveInput.val()))||0;$scope.request(amount.toFixed(8),quantity.toFixed(8),direction)},200)))},$scope.request=function(amount,quantity,direction){$http.post("/ctrl/calculateOffer/approximately",{csrf_token:app.csrf_token,currencyGive:$scope.active_curr1,currencyReceive:$scope.active_curr2,direction:direction,amount:amount,quantity:quantity,balance:$scope.getBalance($scope.active_curr1),balance2:$scope.getBalance($scope.active_curr2)}).success(function(resp){1==resp.success?("basedOnGive"==direction&&""!=$scope.receiveInput.val()&&$scope.receiveInput.val(resp.data.prefix+resp.data.quantity),"basedOnReceive"==direction&&""!=$scope.giveInput.val()&&$scope.giveInput.val(resp.data.prefix+resp.data.amount),$scope.bestPrice=resp.data.best,$scope.availableBalance=resp.data.availableBalance,$scope.newBalance=resp.data.newBalance,$scope.pair=resp.data.pair,resp.data.error.length>0&&0!=app.auth?($scope.error.show(),$scope.error.html(resp.data.error),$scope.exchangeButton.hide()):($scope.error.hide(),$scope.error.html(""),$scope.exchangeButton.show())):/Error\s\d+:/.test(resp.error)?Alert.msg(tt(resp.error)):Alert.msg(tt("Error 10172: Server problem"))})},$scope.init=function(){$http.post("/ctrl/exchangeSettings",{csrf_token:app.csrf_token}).success(function(resp){if(1==resp.success){$scope.arCurr=resp.data.arCurr,$scope.arCurr2=resp.data.list2,$scope.generateList2($scope.active_curr1),$scope.currencies=resp.data.arCurr.map(function(currency){return{title:currency+IO.getCurrDesc(currency),value:currency}});(new Select).init($scope.currency1Select,{title:$scope.active_curr1+IO.getCurrDesc($scope.active_curr1),onSelect:function(currency){$scope.changeCurr1(currency)},items:$scope.currencies,scrollHeight:300,alwaysShowScrollbar:1,autoHideScrollbar:!1}),$scope.changeCurr1($scope.active_curr1),0!=app.auth&&$element.find(".only_auth").show()}}),0!=app.auth&&$scope.loadHistory(10,0).success(function(resp){if(1==resp.success){$element.find(".progress").hide(),$element.find(".no-information").toggle(0==resp.data.history.length),$scope.history=resp.data.history;(new Paginator).init($element.find("#paginator"),resp.data.total,{perPage:10,onSelect:function(page){$scope.loadHistory(10,10*(page-1)).success(function(resp){$scope.history=resp.data.history})}})}})},$scope.loadHistory=function(limit,start){return $http.post("/ctrl/exchangeHistory/find",{csrf_token:app.csrf_token,start:start,records:limit})},$scope.init(),$scope.changeCurr1=function(name){$scope.active_curr1=name,$scope.generateList2(name),$scope.currencies2=$scope.arCurr2[$scope.active_curr1].map(function(currency){return{title:currency+IO.getCurrDesc(currency),value:currency}}),$scope.active_curr2=$scope.arCurr2[$scope.active_curr1][0],$scope.currency2Select.empty(),(new Select).init($scope.currency2Select,{title:$scope.active_curr2+IO.getCurrDesc($scope.active_curr2),onSelect:function(currency){$scope.changeCurr2(currency)},items:$scope.currencies2,scrollHeight:300,alwaysShowScrollbar:1,autoHideScrollbar:!1}),$scope.changeCurr2($scope.active_curr2)},$scope.changeCurr2=function(name){$scope.active_curr2=name,$scope.onCurrSelect()},$scope.onCurrSelect=function(){$scope.clear(),$scope.request(0,0)},$scope.generateList2=function(name,notReplaceCurr2){var list2items=[];void 0!=name&&void 0!=$scope.arCurr2[name]&&(list2items=$scope.arCurr2[name],""==$scope.active_curr2?$scope.active_curr2="BTC":-1==$.inArray($scope.active_curr2,list2items)&&void 0==notReplaceCurr2&&($scope.active_curr2="",void 0!=list2items[0]&&($scope.active_curr2=list2items[0])))},$scope.createOrder=function(event){if(0==app.auth)return void $scope.goto($(event.currentTarget).attr("data-login"));if(1!=$scope.in_progress){$scope.in_progress=!0;var amount=$scope.strReplaceZap($scope.giveInput.val());$scope.createComplexOrder({pair:$scope.pair.name,type:$scope.pair.type,quantity:amount,price:0},$scope,$scope.clear)}},$scope.createComplexOrder=function(data,$scope,successf,errorf){void 0==data||void 0==data.pair||void 0==data.type||void 0==data.quantity||void 0==data.price?Alert.msg(tt("Parameters error")):$http.post("/ctrl/orderCreate",{csrf_token:app.csrf_token,pair:data.pair,type:data.type,quantity:data.quantity,price:data.price,src:1}).success(function(resp){1==resp.success?(Alert.msg(tt("Request for currency exchange created successfully")),void 0!=successf&&successf.call($scope)):(Alert.msg(resp.error),void 0!=errorf&&errorf.call($scope)),$scope.in_progress=!1}).error(function(){$scope.in_progress=!1,Alert.msg(tt("Error 10172: Server problem"))})},$scope.strReplaceZap=function(str){return str.indexOf(",")>-1&&(str=str.indexOf(".")>-1?str.replace(",",""):str.replace(",",".")),str=str.replace(">",""),str=str.replace("~",""),str=str.replace(" ","")},$scope.validate=function(){var amount=parseFloat($scope.strReplaceZap($scope.giveInput.val()))||0,quantity=parseFloat($scope.strReplaceZap($scope.receiveInput.val()))||0;return amount<=0&&quantity<=0},$scope.checkGaveValidationError=function(){(parseFloat($scope.strReplaceZap($scope.giveInput.val()))||0)>=0?$scope.giveValidationMsg.addClass($scope.hideClass):$scope.giveValidationMsg.removeClass($scope.hideClass)},$scope.checkReceiveValidationError=function(){(parseFloat($scope.strReplaceZap($scope.receiveInput.val()))||0)>=0?$scope.receiveValidationMsg.addClass($scope.hideClass):$scope.receiveValidationMsg.removeClass($scope.hideClass)},$scope.clear=function(){$scope.receiveInput.val(0),$scope.giveInput.val(0)}}),function(exports){"use strict";exports.Paginator=function(){function extend(specific,general){var obj={};for(var key in general)obj[key]=key in specific?specific[key]:general[key];return obj}function first(){update(1)}function last(){update(state.total_pages)}function next(){state.has_next_page&&update(state.next_page)}function prev(){state.has_previous_page&&update(state.previous_page)}function goto(event){update($(event.currentTarget).attr("data-target"))}function update(page,is_select_ignore){state=build(total,page),el.empty(),state.total_pages>1&&el.append(render(state)),is_select_ignore||opt.onSelect(page)}function render(state){var list=[];opt.showEdgesButtons&&list.push(createElement(tt("First"),function(){return state.has_previous_page?"":"disabled"},"click touch",first)),list.push(createElement("&#8592;",function(){return state.has_previous_page?"":"disabled"},"click touch",prev));for(var number=state.first_page;number<=state.last_page;number++){var li=$('<li data-target="'+number+'"><a href="" class="'+(state.current_page==number?opt.activeStyle:"")+'">'+number+"</a></li>");li.on("click touch",goto),list.push(li)}list.push(createElement("&#8594;",function(){return state.has_next_page?"":"disabled"},"click touch",next)),opt.showEdgesButtons&&list.push(createElement(tt("Last"),function(){return state.has_next_page?"":"disabled"},"click touch",last));var ul=$('<ul class="no_text_selection '+(opt.listStyle||"")+'"></ul>');return ul.append(list),ul}function createElement(content,attr,events,callback){var element=$("<li "+attr()+'><a href="">'+content+"</a></li>");return element.on(events,function(){callback()}),element}function build(total_results,current_page){var total_pages=Math.ceil(total_results/opt.perPage);total_results=parseInt(total_results,10),current_page=parseInt(current_page,10)||1,current_page<1&&(current_page=1),current_page>total_pages&&(current_page=total_pages);var first_page=Math.max(1,current_page-Math.floor(opt.length/2)),last_page=Math.min(total_pages,current_page+Math.floor(opt.length/2));last_page-first_page+1<opt.length&&(current_page<total_pages/2?last_page=Math.min(total_pages,last_page+(opt.length-(last_page-first_page))):first_page=Math.max(1,first_page-(opt.length-(last_page-first_page)))),last_page-first_page+1>opt.length&&(current_page>total_pages/2?first_page++:last_page--);var first_result=opt.perPage*(current_page-1);first_result<0&&(first_result=0);var last_result=opt.perPage*current_page-1;return last_result<0&&(last_result=0),last_result>Math.max(total_results-1,0)&&(last_result=Math.max(total_results-1,0)),{total_pages:total_pages,pages:Math.min(last_page-first_page+1,total_pages),current_page:current_page,first_page:first_page,last_page:last_page,previous_page:current_page-1,next_page:current_page+1,has_previous_page:current_page>1,has_next_page:current_page<total_pages,total_results:total_results,results:Math.min(last_result-first_result+1,total_results),first_result:first_result,last_result:last_result}}var el,state,total,self=this,opt={perPage:15,length:9,listStyle:"pages_list",activeStyle:"btn_active",onSelect:function(){},showEdgesButtons:!0};return self.init=function(element,totalItems,options){el=element,opt=extend(options||{},opt),total=totalItems,state=build(total,1),state.total_pages>1&&el.append(render(state))},self.updateTotal=function(totalItems){total=totalItems,update(state.current_page,!0)},self.setPage=function(page){state.current_page=Math.min(Math.max(page,1),state.total_pages),update(state.current_page,!0)},self}}(this),function(exports){"use strict";exports.Select=function(){function extend(specific,general){var obj={};for(var key in general)obj[key]=key in specific?specific[key]:general[key];return obj}function build(){return{items:opt.items}}function showItems(event){event&&(event.stopPropagation(),opt.onClick(event)),$(".select_emul").not($(this)).each(function(){this.component.toggle(!1)}),isScroll||(isListShow=!isListShow,update())}function onSelect(event){event.stopPropagation(),title=$(event.currentTarget).text();var itemValue=$(event.currentTarget).attr("data-value");itemValue||(itemValue=$(event.currentTarget).attr("value")),opt.onSelect(itemValue),isListShow=!1,isScroll=!1,update()}function update(){state=build(),el.empty(),el.append(render(state)),scroll()}function scroll(){return opt.scrollable?opt.items.length<opt.minElementForScroll?void el.addClass("none_scroll_select"):(el.removeClass("none_scroll_select"),void $("#"+scrollElementId).mCustomScrollbar({theme:opt.scrollTheme,setHeight:opt.scrollHeight,alwaysShowScrollbar:opt.alwaysShowScrollbar,autoHideScrollbar:opt.autoHideScrollbar,callbacks:{onScroll:function(){isScroll=!1},whileScrolling:function(){isScroll=!0}}})):void el.addClass("none_scroll_select")}function render(state){var div=$('<div class="select_emul" '+(enabled?"":"disabled")+"></div>"),selectedKlass=["select_emul_selected"],selectedTitle=title;if(title.length<1&&(selectedTitle=opt.placeholder,selectedKlass.push("placeholder_color")),isListShow&&selectedKlass.push("active"),div.on("click touch",showItems),div.append('<div class="'+selectedKlass.join(" ")+'">'+selectedTitle+"</div>"),isListShow){var ul=$('<ul class="select_emul_list" style="display:block;" id="'+scrollElementId+'"></ul>'),list=state.items.map(function(item){var li=$('<li class="select_emul_option" data-value="'+item.value+'" value="'+item.value+'">'+item.title+"</li>");return li.on("click touch",onSelect),li});ul.append(list),div.append(ul)}return div[0].component=self,div}var el,state,isListShow,enabled,title,self=this,opt={title:"",placeholder:"",items:[],onSelect:function(){},onClick:function(e){},scrollable:!0,scrollTheme:"minimal-dark",nonScrollClass:"none_scroll_select",minElementForScroll:5,scrollHeight:166,alwaysShowScrollbar:0,autoHideScrollbar:!0},scrollElementId=function(length){return Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,length)}(8),isScroll=!1;return self.init=function(element,options){el=element,opt=extend(options||{},opt),isListShow=!1,enabled=!0,title=opt.title,state=build(),state.items.length>0&&(el.empty(),el.append(render(state)),scroll()),$(document).click(function(){$(".select_emul").each(function(){this.component.toggle(!1)})})},self.enabled=function(flag){enabled=flag,update()},self.items=function(items){title=opt.title,opt.items=items,update()},self.setSelected=function(item,is_select_ignore){title=item.title,is_select_ignore||opt.onSelect(item.value),update()},self.toggle=function(flag){isListShow=flag,update()},self}}(this),function(exports){"use strict";exports.ProgressButton=function(){function extend(specific,general){var obj={};for(var key in general)obj[key]=key in specific?specific[key]:general[key];return obj}function getInitialState(){return{buttonState:""}}function handleClick(event){event.stopPropagation(),state={buttonState:"loading"},update(),opt.handleClick().then(function(){state=getInitialState(),update()},function(){state=getInitialState(),update()})}function update(){el.empty(),el.append(render(state))}function render(state){switch(state.buttonState){case"loading":return $('<div class="cssload-loader" style="display: block;">                            <div></div>                            <div></div>                            <div></div>                            <div></div>                            <div></div>');default:var div=$('<button class="btn '+(opt.className||"")+'" '+(enabled?"":"disabled")+">"+title+"</button>");return div.on("click touch",handleClick),div}}var el,state,enabled,title,self=this,opt={title:"",handleClick:function(){},className:""};return self.init=function(element,options){el=element,opt=extend(options||{},opt),enabled=!0,title=opt.title,state=getInitialState(),el.empty(),el.append(render(state))},self.enabled=function(flag){enabled=flag,update()},self}}(this),function(exports){"use strict";exports.ButtonGroups=function(){function extend(specific,general){var obj={};for(var key in general)obj[key]=key in specific?specific[key]:general[key];return obj}function build(){return{buttons:opt.buttons,selected:opt.selected}}function onSelect(event){event.stopPropagation(),state.selected=$(event.currentTarget).attr("data-id"),opt.onSelect(state.selected),update()}function update(){el.empty(),el.append(render(state))}function render(state){return state.buttons.map(function(button){var element=$('<button data-id="'+button.id+'" class="'+(opt.className||"")+" "+(state.selected==button.id?opt.activeClassName:"")+'" >'+button.title+"</button>");return element.on("click touch",onSelect),element})}var el,state,buttons,self=this,opt={buttons:[],className:"btn",onSelect:function(){},activeClassName:"btn_active",selected:""};return self.init=function(element,options){el=element,opt=extend(options||{},opt),buttons=opt.buttons,state=build(),el.empty(),el.append(render(state))},self}}(this),function(exports){"use strict";exports.Dropdown=function(){function extend(specific,general){var obj={};for(var key in general)obj[key]=key in specific?specific[key]:general[key];return obj}function build(){return{items:opt.items}}function showItems(event){event&&event.stopPropagation(),isListShow=!isListShow,update()}function onSelect(event){event.preventDefault(),event.stopPropagation(),opt.onSelect($(event.currentTarget).attr("value")),isListShow=!1,update()}function update(){state=build(),el.empty(),el.append(render(state))}function render(state){var wrapperKlass=["dropdown_wrap"];isListShow&&wrapperKlass.push("open"),enabled||wrapperKlass.push("inactive_item");var div=$('<div class="'+wrapperKlass.join(" ")+'" '+(enabled?"":"disabled")+"></div>");div.on("click touch",showItems),div.append('<button class="dropdown_all_items">'+opt.title+"</button>");var ul=$('<ul class="dropdown_menu"></ul>'),list=state.items.map(function(item){var li=$("<li></li>"),a=$('<a href="" class="dropdown_menu_link settings_check" value="'+item.value+'">'+item.title+"</a>");return a.on("click touch",onSelect),li.append(a),li});ul.append(list);var ulWrap=$('<div class="dropdown_menu_block"></div>');return ulWrap.append(ul),div.append(ulWrap),div[0].component=self,div}var el,state,isListShow,enabled,title,self=this,opt={title:"",items:[],enabled:!0,onSelect:function(){}};return self.init=function(element,options){el=element,opt=extend(options||{},opt),isListShow=!1,enabled=opt.enabled,title=opt.title,state=build(),
state.items.length>0&&(el.empty(),el.append(render(state))),el.on("mouseenter",function(e){e.stopPropagation(),enabled&&!isListShow&&showItems()}),el.on("mouseleave",function(e){e.stopPropagation(),isListShow&&showItems()})},self.enabled=function(flag){enabled=flag,update()},self.items=function(items){title=opt.title,opt.items=items,update()},self.toggle=function(flag){isListShow=flag,update()},self}}(this);
//# sourceMappingURL=script.land.min.js.map
